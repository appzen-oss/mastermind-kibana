(window["visTypeVega_bundle_jsonpfunction"]=window["visTypeVega_bundle_jsonpfunction"]||[]).push([[6],{82:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"VegaMapView",(function(){return vega_map_view_VegaMapView}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var vega=__webpack_require__(33);var vega_base_view=__webpack_require__(35);var public_=__webpack_require__(29);class vega_map_layer_VegaMapLayer extends public_["KibanaMapLayer"]{constructor(spec,options,leaflet){super();this._attribution=options.attribution;delete options.attribution;this._leafletLayer=leaflet.vega(spec,options)}getVegaView(){return this._leafletLayer._view}getVegaSpec(){return this._leafletLayer._spec}}var services=__webpack_require__(3);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}class vega_map_view_VegaMapView extends vega_base_view["a"]{constructor(opts){super(opts)}_initViewCustomizations(){var _this=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee(){var mapConfig,baseMapOpts,limitMinZ,limitMaxZ,tmsServices,emsTileLayerId,mapStyle,isDarkMode,validate,minZoom,maxZoom,_ref,zoom,modules,vegaMapLayer,vegaView;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:mapConfig=_this._parser.mapConfig;limitMinZ=0;limitMaxZ=25;if(!(mapConfig.mapStyle!==false)){_context.next=20;break}_context.next=6;return _this._serviceSettings.getTMSServices();case 6:tmsServices=_context.sent;if(_this._$container){_context.next=9;break}return _context.abrupt("return");case 9:emsTileLayerId=Object(services["b"])();mapStyle=mapConfig.mapStyle==="default"?emsTileLayerId.bright:mapConfig.mapStyle;isDarkMode=Object(services["g"])().get("theme:darkMode");baseMapOpts=tmsServices.find(s=>s.id===mapStyle);_context.t0=_objectSpread;_context.t1=_objectSpread({},baseMapOpts);_context.next=17;return _this._serviceSettings.getAttributesForTMSLayer(baseMapOpts,true,isDarkMode);case 17:_context.t2=_context.sent;baseMapOpts=(0,_context.t0)(_context.t1,_context.t2);if(!baseMapOpts){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.mapStyleNotFoundWarningMessage",{defaultMessage:"{mapStyleParam} was not found",values:{mapStyleParam:'"mapStyle": '.concat(JSON.stringify(mapStyle))}}))}else{limitMinZ=baseMapOpts.minZoom;limitMaxZ=baseMapOpts.maxZoom}case 20:validate=(name,value,dflt,min,max)=>{if(value===undefined){value=dflt}else if(value<min){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.resettingPropertyToMinValueWarningMessage",{defaultMessage:"Resetting {name} to {min}",values:{name:'"'.concat(name,'"'),min:min}}));value=min}else if(value>max){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.resettingPropertyToMaxValueWarningMessage",{defaultMessage:"Resetting {name} to {max}",values:{name:'"'.concat(name,'"'),max:max}}));value=max}return value};minZoom=validate("minZoom",mapConfig.minZoom,limitMinZ,limitMinZ,limitMaxZ);maxZoom=validate("maxZoom",mapConfig.maxZoom,limitMaxZ,limitMinZ,limitMaxZ);if(minZoom>maxZoom){_this.onWarn(external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeVega.mapView.minZoomAndMaxZoomHaveBeenSwappedWarningMessage",{defaultMessage:"{minZoomPropertyName} and {maxZoomPropertyName} have been swapped",values:{minZoomPropertyName:'"minZoom"',maxZoomPropertyName:'"maxZoom"'}}));_ref=[maxZoom,minZoom];minZoom=_ref[0];maxZoom=_ref[1]}zoom=validate("zoom",mapConfig.zoom,2,minZoom,maxZoom);_context.next=27;return Object(public_["lazyLoadMapsLegacyModules"])();case 27:modules=_context.sent;_this._kibanaMap=new modules.KibanaMap(_this._$container.get(0),{zoom:zoom,minZoom:minZoom,maxZoom:maxZoom,center:[mapConfig.latitude,mapConfig.longitude],zoomControl:mapConfig.zoomControl,scrollWheelZoom:mapConfig.scrollWheelZoom});if(baseMapOpts){_this._kibanaMap.setBaseLayer({baseLayerType:"tms",options:baseMapOpts})}vegaMapLayer=new vega_map_layer_VegaMapLayer(_this._parser.spec,{vega:vega["a"],bindingsContainer:_this._$controls.get(0),delayRepaint:mapConfig.delayRepaint,viewConfig:_this._vegaViewConfig,onWarning:_this.onWarn.bind(_this),onError:_this.onError.bind(_this)},modules.L);_this._kibanaMap.addLayer(vegaMapLayer);_this._addDestroyHandler(()=>{_this._kibanaMap.removeLayer(vegaMapLayer);if(baseMapOpts){_this._kibanaMap.setBaseLayer(null)}_this._kibanaMap.destroy()});vegaView=vegaMapLayer.getVegaView();_context.next=36;return _this.setView(vegaView);case 36:_this.setDebugValues(vegaView,_this._parser.spec,_this._parser.vlspec);case 37:case"end":return _context.stop()}}),_callee)})))()}}}}]);