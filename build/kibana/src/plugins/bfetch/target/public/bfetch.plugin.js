(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=10)})([function(module,__webpack_exports__,__webpack_require__){"use strict";var _util__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);__webpack_require__.d(__webpack_exports__,"normalizeError",(function(){return _util__WEBPACK_IMPORTED_MODULE_0__["a"]}));__webpack_require__.d(__webpack_exports__,"removeLeadingSlash",(function(){return _util__WEBPACK_IMPORTED_MODULE_0__["b"]}));var _streaming__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);if(__webpack_require__.o(_streaming__WEBPACK_IMPORTED_MODULE_1__,"createBatchedFunction"))__webpack_require__.d(__webpack_exports__,"createBatchedFunction",(function(){return _streaming__WEBPACK_IMPORTED_MODULE_1__["createBatchedFunction"]}));var _buffer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7);__webpack_require__.d(__webpack_exports__,"createBatchedFunction",(function(){return _buffer__WEBPACK_IMPORTED_MODULE_2__["a"]}));var _batch__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5);var _batch__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_batch__WEBPACK_IMPORTED_MODULE_3__)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.Rxjs},function(module,__webpack_exports__,__webpack_require__){"use strict";var _types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);var _types__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_types__WEBPACK_IMPORTED_MODULE_0__);if(__webpack_require__.o(_types__WEBPACK_IMPORTED_MODULE_0__,"createBatchedFunction"))__webpack_require__.d(__webpack_exports__,"createBatchedFunction",(function(){return _types__WEBPACK_IMPORTED_MODULE_0__["createBatchedFunction"]}))},function(module,exports){},function(module,exports){},function(module,exports){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return createBatchedFunction}));function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class ItemBuffer{constructor(params){this.params=params;_defineProperty(this,"list",[])}get length(){return this.list.length}write(item){this.list.push(item);const flushOnMaxItems=this.params.flushOnMaxItems;if(flushOnMaxItems){if(this.list.length>=flushOnMaxItems){this.flush()}}}clear(){this.list=[]}flush(){let list;var _ref=[this.list,[]];list=_ref[0];this.list=_ref[1];this.params.onFlush(list)}}function timed_item_buffer_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class timed_item_buffer_TimedItemBuffer extends ItemBuffer{constructor(params){super(params);this.params=params;timed_item_buffer_defineProperty(this,"timer",void 0);timed_item_buffer_defineProperty(this,"onTimeout",()=>{this.flush()})}write(item){super.write(item);if(this.params.maxItemAge&&this.length===1){this.timer=setTimeout(this.onTimeout,this.params.maxItemAge)}}clear(){clearTimeout(this.timer);super.clear()}flush(){clearTimeout(this.timer);super.flush()}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const createBatchedFunction=params=>{const onCall=params.onCall,onBatch=params.onBatch,_params$maxItemAge=params.maxItemAge,maxItemAge=_params$maxItemAge===void 0?10:_params$maxItemAge,_params$flushOnMaxIte=params.flushOnMaxItems,flushOnMaxItems=_params$flushOnMaxIte===void 0?25:_params$flushOnMaxIte;const buffer=new timed_item_buffer_TimedItemBuffer({onFlush:onBatch,maxItemAge:maxItemAge,flushOnMaxItems:flushOnMaxItems});const fn=(...args)=>{const _onCall=onCall(...args),_onCall2=_slicedToArray(_onCall,2),result=_onCall2[0],batchEntry=_onCall2[1];buffer.write(batchEntry);return result};return[fn,buffer]}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return normalizeError}));__webpack_require__.d(__webpack_exports__,"b",(function(){return removeLeadingSlash}));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const normalizeError=err=>{if(!err){return{message:"Unknown error."}}if(err instanceof Error){return{message:err.message}}if(typeof err==="object"){return _objectSpread(_objectSpread({},err),{},{message:err.message||"Unknown error."})}return{message:String(err)}};const removeLeadingSlash=text=>text[0]==="/"?text.substr(1):text},function(module,exports){module.exports=__kbnSharedDeps__.RxjsOperators},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_bfetch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(11);var _node_modules_val_loader_dist_cjs_js_key_bfetch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_bfetch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/bfetch/public",__webpack_require__,12)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["bfetch"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"BfetchPublicSetup",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"BfetchPublicStart",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"BfetchPublicContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"split",(function(){return split}));__webpack_require__.d(__webpack_exports__,"BatchedFunc",(function(){return types["BatchedFunc"]}));__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var external_kbnSharedDeps_Rxjs_=__webpack_require__(2);var external_kbnSharedDeps_RxjsOperators_=__webpack_require__(9);const split=(delimiter="\n")=>in$=>{const out$=new external_kbnSharedDeps_Rxjs_["Subject"];let startingText="";in$.subscribe(chunk=>{const messages=(startingText+chunk).split(delimiter);messages.slice(0,-1).forEach(out$.next.bind(out$));startingText=messages.length?messages[messages.length-1]:""},out$.error.bind(out$),()=>{out$.next(startingText);out$.complete()});return out$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["filter"])(Boolean))};const fromStreamingXhr=(xhr,signal)=>{const subject=new external_kbnSharedDeps_Rxjs_["Subject"];let index=0;let aborted=false;const processBatch=()=>{if(aborted)return;const responseText=xhr.responseText;if(index>=responseText.length)return;subject.next(responseText.substr(index));index=responseText.length};xhr.onprogress=processBatch;const onBatchAbort=()=>{if(xhr.readyState!==4){aborted=true;xhr.abort();subject.complete();if(signal)signal.removeEventListener("abort",onBatchAbort)}};if(signal)signal.addEventListener("abort",onBatchAbort);xhr.onreadystatechange=()=>{if(aborted)return;processBatch();if(xhr.readyState===4){if(signal)signal.removeEventListener("abort",onBatchAbort);if(xhr.status===0||xhr.status>=400){subject.error(new Error("Batch request failed with status ".concat(xhr.status)))}else{subject.complete()}}};return subject};function fetch_streaming_fetchStreaming({url:url,headers:headers={},method:method="POST",body:body="",signal:signal}){const xhr=new window.XMLHttpRequest;xhr.open(method,url);xhr.withCredentials=true;Object.entries(headers).forEach(([k,v])=>xhr.setRequestHeader(k,v));const stream=fromStreamingXhr(xhr,signal);xhr.send(body);return{xhr:xhr,stream:stream}}var common=__webpack_require__(0);var public_=__webpack_require__(1);function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function(_e2){function e(_x2){return _e2.apply(this,arguments)}e.toString=function(){return _e2.toString()};return e}((function(e){throw e})),f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function(_e3){function e(_x3){return _e3.apply(this,arguments)}e.toString=function(){return _e3.toString()};return e}((function(e){didErr=true;err=e})),f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const createStreamingBatchedFunction=params=>{const url=params.url,_params$fetchStreamin=params.fetchStreaming,fetchStreamingInjected=_params$fetchStreamin===void 0?fetch_streaming_fetchStreaming:_params$fetchStreamin,_params$flushOnMaxIte=params.flushOnMaxItems,flushOnMaxItems=_params$flushOnMaxIte===void 0?25:_params$flushOnMaxIte,_params$maxItemAge=params.maxItemAge,maxItemAge=_params$maxItemAge===void 0?10:_params$maxItemAge;const _createBatchedFunctio=Object(common["createBatchedFunction"])({onCall:(payload,signal)=>{const future=Object(public_["defer"])();const entry={payload:payload,future:future,signal:signal};return[future.promise,entry]},onBatch:function(){var _onBatch=_asyncToGenerator(regeneratorRuntime.mark((function _callee(items){var donePromises,abortController,isBatchDone,batch,_fetchStreamingInject,stream,handleStreamError,_iterator3,_step3,item;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;items=items.filter(item=>{var _item$signal,_item$signal2;if((_item$signal=item.signal)===null||_item$signal===void 0?void 0:_item$signal.aborted)item.future.reject(new public_["AbortError"]);return!((_item$signal2=item.signal)===null||_item$signal2===void 0?void 0:_item$signal2.aborted)});donePromises=items.map(item=>new Promise(resolve=>{const _ref=item.signal?Object(public_["abortSignalToPromise"])(item.signal):{promise:undefined,cleanup:()=>{}},abortPromise=_ref.promise,cleanup=_ref.cleanup;const onDone=()=>{resolve();cleanup()};if(abortPromise)abortPromise.catch(()=>{item.future.reject(new public_["AbortError"]);onDone()});item.future.promise.then(onDone,onDone)}));abortController=new AbortController;isBatchDone=false;Promise.all(donePromises).then(()=>{isBatchDone=true;abortController.abort()});batch=items.map(item=>item.payload);_fetchStreamingInject=fetchStreamingInjected({url:url,body:JSON.stringify({batch:batch}),method:"POST",signal:abortController.signal}),stream=_fetchStreamingInject.stream;handleStreamError=error=>{const normalizedError=Object(common["normalizeError"])(error);normalizedError.code="STREAM";var _iterator=_createForOfIteratorHelper(items),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){const future=_step.value.future;future.reject(normalizedError)}}catch(err){_iterator.e(err)}finally{_iterator.f()}};stream.pipe(split("\n")).subscribe({next:json=>{try{const response=JSON.parse(json);if(response.error){items[response.id].future.reject(response.error)}else if(response.result!==undefined){items[response.id].future.resolve(response.result)}}catch(e){handleStreamError(e)}},error:handleStreamError,complete:()=>{if(!isBatchDone){const error={message:"Connection terminated prematurely.",code:"CONNECTION"};var _iterator2=_createForOfIteratorHelper(items),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){const future=_step2.value.future;future.reject(error)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}});_context.next=12;return stream.toPromise();case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context["catch"](0);_iterator3=_createForOfIteratorHelper(items);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){item=_step3.value;item.future.reject(_context.t0)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}case 18:case"end":return _context.stop()}}),_callee,null,[[0,14]])})));function onBatch(_x){return _onBatch.apply(this,arguments)}return onBatch}(),flushOnMaxItems:flushOnMaxItems,maxItemAge:maxItemAge}),_createBatchedFunctio2=_slicedToArray(_createBatchedFunctio,1),fn=_createBatchedFunctio2[0];return fn};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_BfetchPublicPlugin{constructor(initializerContext){this.initializerContext=initializerContext;_defineProperty(this,"contract",void 0);_defineProperty(this,"fetchStreaming",(version,basePath)=>params=>fetch_streaming_fetchStreaming(_objectSpread(_objectSpread({},params),{},{url:"".concat(basePath,"/").concat(Object(common["removeLeadingSlash"])(params.url)),headers:_objectSpread({"Content-Type":"application/json","kbn-version":version},params.headers||{})})));_defineProperty(this,"batchedFunction",fetchStreaming=>params=>createStreamingBatchedFunction(_objectSpread(_objectSpread({},params),{},{fetchStreaming:params.fetchStreaming||fetchStreaming})))}setup(core,plugins){const version=this.initializerContext.env.packageInfo.version;const basePath=core.http.basePath.get();const fetchStreaming=this.fetchStreaming(version,basePath);const batchedFunction=this.batchedFunction(fetchStreaming);this.contract={fetchStreaming:fetchStreaming,batchedFunction:batchedFunction};return this.contract}start(core,plugins){return this.contract}stop(){}}var types=__webpack_require__(6);function public_plugin(initializerContext){return new plugin_BfetchPublicPlugin(initializerContext)}}]);