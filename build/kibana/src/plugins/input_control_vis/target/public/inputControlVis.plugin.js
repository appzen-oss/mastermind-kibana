(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=11)})([function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/data/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports,__webpack_require__){"use strict";var isOldIE=function isOldIE(){var memo;return function memorize(){if(typeof memo==="undefined"){memo=Boolean(window&&document&&document.all&&!window.atob)}return memo}}();var getTarget=function getTarget(){var memo={};return function memorize(target){if(typeof memo[target]==="undefined"){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement){try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}}memo[target]=styleTarget}return memo[target]}}();var stylesInDom=[];function getIndexByIdentifier(identifier){var result=-1;for(var i=0;i<stylesInDom.length;i++){if(stylesInDom[i].identifier===identifier){result=i;break}}return result}function modulesToDom(list,options){var idCountMap={};var identifiers=[];for(var i=0;i<list.length;i++){var item=list[i];var id=options.base?item[0]+options.base:item[0];var count=idCountMap[id]||0;var identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var index=getIndexByIdentifier(identifier);var obj={css:item[1],media:item[2],sourceMap:item[3]};if(index!==-1){stylesInDom[index].references++;stylesInDom[index].updater(obj)}else{stylesInDom.push({identifier:identifier,updater:addStyle(obj,options),references:1})}identifiers.push(identifier)}return identifiers}function insertStyleElement(options){var style=document.createElement("style");var attributes=options.attributes||{};if(typeof attributes.nonce==="undefined"){var nonce=true?__webpack_require__.nc:undefined;if(nonce){attributes.nonce=nonce}}Object.keys(attributes).forEach((function(key){style.setAttribute(key,attributes[key])}));if(typeof options.insert==="function"){options.insert(style)}else{var target=getTarget(options.insert||"head");if(!target){throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.")}target.appendChild(style)}return style}function removeStyleElement(style){if(style.parentNode===null){return false}style.parentNode.removeChild(style)}var replaceText=function replaceText(){var textStore=[];return function replace(index,replacement){textStore[index]=replacement;return textStore.filter(Boolean).join("\n")}}();function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.media?"@media ".concat(obj.media," {").concat(obj.css,"}"):obj.css;if(style.styleSheet){style.styleSheet.cssText=replaceText(index,css)}else{var cssNode=document.createTextNode(css);var childNodes=style.childNodes;if(childNodes[index]){style.removeChild(childNodes[index])}if(childNodes.length){style.insertBefore(cssNode,childNodes[index])}else{style.appendChild(cssNode)}}}function applyToTag(style,options,obj){var css=obj.css;var media=obj.media;var sourceMap=obj.sourceMap;if(media){style.setAttribute("media",media)}else{style.removeAttribute("media")}if(sourceMap&&btoa){css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")}if(style.styleSheet){style.styleSheet.cssText=css}else{while(style.firstChild){style.removeChild(style.firstChild)}style.appendChild(document.createTextNode(css))}}var singleton=null;var singletonCounter=0;function addStyle(obj,options){var style;var update;var remove;if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=insertStyleElement(options));update=applyToSingletonTag.bind(null,style,styleIndex,false);remove=applyToSingletonTag.bind(null,style,styleIndex,true)}else{style=insertStyleElement(options);update=applyToTag.bind(null,style,options);remove=function remove(){removeStyleElement(style)}}update(obj);return function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap){return}update(obj=newObj)}else{remove()}}}module.exports=function(list,options){options=options||{};if(!options.singleton&&typeof options.singleton!=="boolean"){options.singleton=isOldIE()}list=list||[];var lastIdentifiers=modulesToDom(list,options);return function update(newList){newList=newList||[];if(Object.prototype.toString.call(newList)!=="[object Array]"){return}for(var i=0;i<lastIdentifiers.length;i++){var identifier=lastIdentifiers[i];var index=getIndexByIdentifier(identifier);stylesInDom[index].references--}var newLastIdentifiers=modulesToDom(newList,options);for(var _i=0;_i<lastIdentifiers.length;_i++){var _identifier=lastIdentifiers[_i];var _index=getIndexByIdentifier(_identifier);if(stylesInDom[_index].references===0){stylesInDom[_index].updater();stylesInDom.splice(_index,1)}}lastIdentifiers=newLastIdentifiers}}},function(module,exports,__webpack_require__){"use strict";module.exports=function(useSourceMap){var list=[];list.toString=function toString(){return this.map((function(item){var content=cssWithMappingToString(item,useSourceMap);if(item[2]){return"@media ".concat(item[2]," {").concat(content,"}")}return content})).join("")};list.i=function(modules,mediaQuery,dedupe){if(typeof modules==="string"){modules=[[null,modules,""]]}var alreadyImportedModules={};if(dedupe){for(var i=0;i<this.length;i++){var id=this[i][0];if(id!=null){alreadyImportedModules[id]=true}}}for(var _i=0;_i<modules.length;_i++){var item=[].concat(modules[_i]);if(dedupe&&alreadyImportedModules[item[0]]){continue}if(mediaQuery){if(!item[2]){item[2]=mediaQuery}else{item[2]="".concat(mediaQuery," and ").concat(item[2])}}list.push(item)}};return list};function cssWithMappingToString(item,useSourceMap){var content=item[1]||"";var cssMapping=item[3];if(!cssMapping){return content}if(useSourceMap&&typeof btoa==="function"){var sourceMapping=toComment(cssMapping);var sourceURLs=cssMapping.sources.map((function(source){return"/*# sourceURL=".concat(cssMapping.sourceRoot||"").concat(source," */")}));return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}return[content].join("\n")}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));var data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64);return"/*# ".concat(data," */")}},function(module,exports){module.exports=__kbnSharedDeps__.ReactDom},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/visualizations/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_inputControlVis_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _node_modules_val_loader_dist_cjs_js_key_inputControlVis_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_inputControlVis_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/inputControlVis/public",__webpack_require__,22)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["inputControlVis"]},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(14);case"v7light":return __webpack_require__(16);case"v8dark":return __webpack_require__(18);case"v8light":return __webpack_require__(20)}},function(module,exports,__webpack_require__){var api=__webpack_require__(6);var content=__webpack_require__(15);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(7);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".icvControlEditor__panel {\n  z-index: 1;\n  margin-bottom: 16px; }\n\n.icvContainer {\n  width: 100%;\n  margin: 0 4px;\n  padding: 8px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(6);var content=__webpack_require__(17);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(7);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".icvControlEditor__panel {\n  z-index: 1;\n  margin-bottom: 16px; }\n\n.icvContainer {\n  width: 100%;\n  margin: 0 4px;\n  padding: 8px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(6);var content=__webpack_require__(19);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(7);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".icvControlEditor__panel {\n  z-index: 1;\n  margin-bottom: 16px; }\n\n.icvContainer {\n  width: 100%;\n  margin: 0 4px;\n  padding: 8px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(6);var content=__webpack_require__(21);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(7);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".icvControlEditor__panel {\n  z-index: 1;\n  margin-bottom: 16px; }\n\n.icvContainer {\n  width: 100%;\n  margin: 0 4px;\n  padding: 8px; }\n",""]);module.exports=exports},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var public_0=__webpack_require__(13);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(4);const createInputControlVisFn=()=>({name:"input_control_vis",type:"render",inputTypes:[],help:external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.function.help",{defaultMessage:"Input control visualization"}),args:{visConfig:{types:["string"],default:'"{}"',help:""}},fn(input,args){const params=JSON.parse(args.visConfig);return{type:"render",as:"visualization",value:{visType:"input_control_vis",visConfig:params}}}});var public_=__webpack_require__(10);var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_Lodash_=__webpack_require__(2);var external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(8);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(1);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(3);const CONTROL_TYPES={LIST:"list",RANGE:"range"};const setControl=(controls,controlIndex,control)=>[...controls.slice(0,controlIndex),control,...controls.slice(controlIndex+1)];const addControl=(controls,control)=>[...controls,control];const moveControl=(controls,controlIndex,direction)=>{let newIndex;if(direction>=0){newIndex=controlIndex+1}else{newIndex=controlIndex-1}if(newIndex<0){return[...controls.slice(1),controls[0]]}else if(newIndex>=controls.length){const lastItemIndex=controls.length-1;return[controls[lastItemIndex],...controls.slice(0,lastItemIndex)]}else{const swapped=controls.slice();const temp=swapped[newIndex];swapped[newIndex]=swapped[controlIndex];swapped[controlIndex]=temp;return swapped}};const removeControl=(controls,controlIndex)=>[...controls.slice(0,controlIndex),...controls.slice(controlIndex+1)];const getDefaultOptions=type=>{const defaultOptions={};switch(type){case CONTROL_TYPES.RANGE:defaultOptions.decimalPlaces=0;defaultOptions.step=1;break;case CONTROL_TYPES.LIST:defaultOptions.type="terms";defaultOptions.multiselect=true;defaultOptions.dynamicOptions=true;defaultOptions.size=5;defaultOptions.order="desc";break}return defaultOptions};const newControl=type=>({id:(new Date).getTime().toString(),indexPattern:"",fieldName:"",parent:"",label:"",type:type,options:getDefaultOptions(type)});const getTitle=(controlParams,controlIndex)=>{let title="".concat(controlParams.type,": ").concat(controlIndex);if(controlParams.label){title="".concat(controlParams.label)}else if(controlParams.fieldName){title="".concat(controlParams.fieldName)}return title};function FormRow(props){let control=props.children;if(props.disableMsg){control=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:props.disableMsg,anchorClassName:"eui-displayBlock"},control)}const label=props.warningMsg?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:props.warningMsg},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"alert"})),props.label):props.label;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:label,id:props.id,"data-test-subj":"inputControl"+props.controlIndex},control)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class list_control_ListControlUi extends external_kbnSharedDeps_React_["PureComponent"]{constructor(props){var _this;super(props);_this=this;_defineProperty(this,"isMounted",false);_defineProperty(this,"state",{isLoading:false});_defineProperty(this,"textInput",void 0);_defineProperty(this,"componentDidMount",()=>{if(this.textInput){this.textInput.setAttribute("focusable","false")}this.isMounted=true});_defineProperty(this,"componentWillUnmount",()=>{this.isMounted=false});_defineProperty(this,"setTextInputRef",ref=>{this.textInput=ref});_defineProperty(this,"handleOnChange",selectedOptions=>{const selectedValues=selectedOptions.map(({value:value})=>value);this.props.stageFilter(this.props.controlIndex,selectedValues)});_defineProperty(this,"debouncedFetch",external_kbnSharedDeps_Lodash_default.a.debounce(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(searchValue){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!_this.props.fetchOptions){_context.next=3;break}_context.next=3;return _this.props.fetchOptions(searchValue);case 3:if(_this.isMounted){_this.setState({isLoading:false})}case 4:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}(),300));_defineProperty(this,"onSearchChange",searchValue=>{this.setState({isLoading:true},this.debouncedFetch.bind(null,searchValue))});this.textInput=null}renderControl(){var _this$props$options;const intl=this.props.intl;if(this.props.disableMsg){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{"aria-label":intl.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),placeholder:intl.formatMessage({id:"inputControl.vis.listControl.selectTextPlaceholder",defaultMessage:"Select..."}),disabled:true})}const options=(_this$props$options=this.props.options)===null||_this$props$options===void 0?void 0:_this$props$options.map(option=>({label:this.props.formatOptionLabel(option).toString(),value:option,["data-test-subj"]:"option_".concat(option.toString().replace(" ","_"))})).sort((a,b)=>a.label.toLowerCase().localeCompare(b.label.toLowerCase()));const selectedOptions=this.props.selectedOptions.map(selectedOption=>({label:this.props.formatOptionLabel(selectedOption).toString(),value:selectedOption}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:intl.formatMessage({id:"inputControl.vis.listControl.selectPlaceholder",defaultMessage:"Select..."}),options:options,isLoading:this.state.isLoading,async:this.props.dynamicOptions,onSearchChange:this.props.dynamicOptions?this.onSearchChange:undefined,selectedOptions:selectedOptions,onChange:this.handleOnChange,singleSelection:!this.props.multiselect,"data-test-subj":"listControlSelect".concat(this.props.controlIndex),inputRef:this.setTextInputRef})}render(){const partialResultsWarningMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.vis.listControl.partialResultsWarningMessage",{defaultMessage:"Terms list might be incomplete because the request is taking too long. "+"Adjust the autocomplete settings in kibana.yml for complete results."});return external_kbnSharedDeps_React_default.a.createElement(FormRow,{id:this.props.id,label:this.props.label,warningMsg:this.props.partialResults?partialResultsWarningMessage:undefined,controlIndex:this.props.controlIndex,disableMsg:this.props.disableMsg},this.renderControl())}}_defineProperty(list_control_ListControlUi,"defaultProps",{dynamicOptions:false,multiselect:true,selectedOptions:[],options:[]});const list_control_ListControl=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(list_control_ListControlUi);var kibanaReact_public_=__webpack_require__(9);function range_control_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function roundWithPrecision(value,decimalPlaces,roundFunction){if(decimalPlaces<=0){return roundFunction(value)}let results=value;results=results*Math.pow(10,decimalPlaces);results=roundFunction(results);results=results/Math.pow(10,decimalPlaces);return results}function ceilWithPrecision(value,decimalPlaces){return roundWithPrecision(value,decimalPlaces,Math.ceil)}function floorWithPrecision(value,decimalPlaces){return roundWithPrecision(value,decimalPlaces,Math.floor)}class range_control_RangeControl extends external_kbnSharedDeps_React_["PureComponent"]{constructor(...args){super(...args);range_control_defineProperty(this,"state",{});range_control_defineProperty(this,"onChangeComplete",external_kbnSharedDeps_Lodash_default.a.debounce(value=>{const controlValue={min:value[0],max:value[1]};this.props.stageFilter(this.props.controlIndex,controlValue)},200))}static getDerivedStateFromProps(nextProps,prevState){const nextValue=nextProps.control.hasValue()?[nextProps.control.value.min,nextProps.control.value.max]:["",""];if(nextProps.control.hasValue()&&nextProps.control.value.min==null){nextValue[0]=""}if(nextProps.control.hasValue()&&nextProps.control.value.max==null){nextValue[1]=""}if(nextValue!==prevState.prevValue){return{value:nextValue,prevValue:nextValue}}return null}renderControl(){if(!this.props.control.isEnabled()){return external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_["ValidatedDualRange"],{disabled:true,showInput:true})}const decimalPlaces=external_kbnSharedDeps_Lodash_default.a.get(this.props,"control.options.decimalPlaces",0);const min=floorWithPrecision(this.props.control.min,decimalPlaces);const max=ceilWithPrecision(this.props.control.max,decimalPlaces);const ticks=[{value:min,label:min},{value:max,label:max}];return external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_["ValidatedDualRange"],{id:this.props.control.id,min:min,max:max,value:this.state.value,onChange:this.onChangeComplete,showInput:true,showRange:true,showTicks:true,ticks:ticks})}render(){return external_kbnSharedDeps_React_default.a.createElement(FormRow,{id:this.props.control.id,label:this.props.control.label,controlIndex:this.props.controlIndex,disableMsg:this.props.control.isEnabled()?undefined:this.props.control.disabledReason},this.renderControl())}}function isListControl(control){return control.type===CONTROL_TYPES.LIST}function isRangeControl(control){return control.type===CONTROL_TYPES.RANGE}class input_control_vis_InputControlVis extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.handleSubmit=this.handleSubmit.bind(this);this.handleReset=this.handleReset.bind(this);this.handleClearAll=this.handleClearAll.bind(this)}handleSubmit(){this.props.submitFilters()}handleReset(){this.props.resetControls()}handleClearAll(){this.props.clearControls()}renderControls(){return this.props.controls.map((control,index)=>{let controlComponent=null;if(isListControl(control)){controlComponent=external_kbnSharedDeps_React_default.a.createElement(list_control_ListControl,{id:control.id,label:control.label,options:control.selectOptions,selectedOptions:control.value,formatOptionLabel:control.format,disableMsg:control.isEnabled()?undefined:control.disabledReason,multiselect:control.options.multiselect,partialResults:control.partialResults,dynamicOptions:control.options.dynamicOptions,controlIndex:index,stageFilter:this.props.stageFilter,fetchOptions:query=>{this.props.refreshControl(index,query)}})}else if(isRangeControl(control)){controlComponent=external_kbnSharedDeps_React_default.a.createElement(range_control_RangeControl,{control:control,controlIndex:index,stageFilter:this.props.stageFilter})}else{throw new Error("Unhandled control type ".concat(control.type))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:control.id,style:{minWidth:"250px"},"data-test-subj":"inputControlItem"},controlComponent)})}renderStagingButtons(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,onClick:this.handleSubmit,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlSubmitBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.vis.inputControlVis.applyChangesButtonLabel",defaultMessage:"Apply changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:this.handleReset,disabled:!this.props.hasChanges(),"data-test-subj":"inputControlCancelBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.vis.inputControlVis.cancelChangesButtonLabel",defaultMessage:"Cancel changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:this.handleClearAll,disabled:!this.props.hasValues(),"data-test-subj":"inputControlClearBtn"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.vis.inputControlVis.clearFormButtonLabel",defaultMessage:"Clear form"}))))}render(){let stagingButtons;if(this.props.controls.length>0&&!this.props.updateFiltersOnChange){stagingButtons=this.renderStagingButtons()}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"icvContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true},this.renderControls()),stagingButtons)}}function control_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function noValuesDisableMsg(fieldName,indexPatternName){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.control.noValuesDisableTooltip",{defaultMessage:'Filtering occurs on the "{fieldName}" field, which doesn\'t exist on any documents in the "{indexPatternName}" index pattern. Choose a different field or index documents that contain values for this field.',values:{fieldName:fieldName,indexPatternName:indexPatternName}})}function noIndexPatternMsg(indexPatternId){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.control.noIndexPatternTooltip",{defaultMessage:"Could not locate index-pattern id: {indexPatternId}.",values:{indexPatternId:indexPatternId}})}class control_Control{constructor(controlParams,filterManager,useTimeFilter){this.controlParams=controlParams;this.filterManager=filterManager;this.useTimeFilter=useTimeFilter;control_defineProperty(this,"kbnFilter",null);control_defineProperty(this,"enable",false);control_defineProperty(this,"disabledReason","");control_defineProperty(this,"value",void 0);control_defineProperty(this,"id",void 0);control_defineProperty(this,"options",void 0);control_defineProperty(this,"type",void 0);control_defineProperty(this,"label",void 0);control_defineProperty(this,"ancestors",[]);control_defineProperty(this,"format",value=>{const indexPattern=this.filterManager.getIndexPattern();const field=this.filterManager.getField();if(field&&indexPattern){return indexPattern.getFormatterForField(field).convert(value)}return value});this.id=controlParams.id;this.controlParams=controlParams;this.options=controlParams.options;this.type=controlParams.type;this.label=controlParams.label?controlParams.label:controlParams.fieldName;this.reset();this.disable(external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.control.notInitializedTooltip",{defaultMessage:"Control has not been initialized"}))}setAncestors(ancestors){this.ancestors=ancestors}hasAncestors(){return this.ancestors&&this.ancestors.length>0}hasUnsetAncestor(){return this.ancestors.reduce((accumulator,ancestor)=>accumulator||!ancestor.hasValue(),false)}getAncestorValues(){return this.ancestors.map(ancestor=>ancestor.value)}getAncestorFilters(){return this.ancestors.map(ancestor=>ancestor.filterManager.createFilter(ancestor.value))}isEnabled(){return this.enable}disable(reason){this.enable=false;this.disabledReason=reason}set(newValue){this.value=newValue;if(this.hasValue()){this.kbnFilter=this.filterManager.createFilter(this.value)}else{this.kbnFilter=null}}reset(){this.kbnFilter=null;this.value=this.filterManager.getValueFromFilterBar()}clear(){this.value=undefined}hasChanged(){return!external_kbnSharedDeps_Lodash_default.a.isEqual(this.value,this.filterManager.getValueFromFilterBar())}hasKbnFilter(){if(this.kbnFilter){return true}return false}getKbnFilter(){return this.kbnFilter}hasValue(){return this.value!==undefined}}function filter_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function filter_manager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){filter_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){filter_manager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function filter_manager_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class filter_manager_FilterManager{constructor(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter){this.controlId=controlId;this.fieldName=fieldName;this.indexPatternId=indexPatternId;this.indexPatternsService=indexPatternsService;this.queryFilter=queryFilter;filter_manager_defineProperty(this,"indexPattern",void 0)}init(){var _this=this;return filter_manager_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;if(_this.indexPattern){_context.next=5;break}_context.next=4;return _this.indexPatternsService.get(_this.indexPatternId);case 4:_this.indexPattern=_context.sent;case 5:_context.next=9;break;case 7:_context.prev=7;_context.t0=_context["catch"](0);case 9:case"end":return _context.stop()}}),_callee,null,[[0,7]])})))()}getIndexPattern(){return this.indexPattern}getField(){var _this$indexPattern;return(_this$indexPattern=this.indexPattern)===null||_this$indexPattern===void 0?void 0:_this$indexPattern.fields.getByName(this.fieldName)}findFilters(){const kbnFilters=external_kbnSharedDeps_Lodash_default.a.flatten([this.queryFilter.getAppFilters(),this.queryFilter.getGlobalFilters()]);return kbnFilters.filter(kbnFilter=>external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"meta.controlledBy")===this.controlId)}}var data_public_=__webpack_require__(5);function toRange(sliderValue){return{gte:sliderValue.min,lte:sliderValue.max}}function fromRange(range){const sliderValue={};if(external_kbnSharedDeps_Lodash_default.a.has(range,"gte")){sliderValue.min=external_kbnSharedDeps_Lodash_default.a.get(range,"gte")}if(external_kbnSharedDeps_Lodash_default.a.has(range,"gt")){sliderValue.min=external_kbnSharedDeps_Lodash_default.a.get(range,"gt")}if(external_kbnSharedDeps_Lodash_default.a.has(range,"lte")){sliderValue.max=external_kbnSharedDeps_Lodash_default.a.get(range,"lte")}if(external_kbnSharedDeps_Lodash_default.a.has(range,"lt")){sliderValue.max=external_kbnSharedDeps_Lodash_default.a.get(range,"lt")}return sliderValue}class range_filter_manager_RangeFilterManager extends filter_manager_FilterManager{createFilter(value){const indexPattern=this.getIndexPattern();const newFilter=data_public_["esFilters"].buildRangeFilter(indexPattern.fields.getByName(this.fieldName),toRange(value),indexPattern);newFilter.meta.key=this.fieldName;newFilter.meta.controlledBy=this.controlId;return newFilter}getValueFromFilterBar(){const kbnFilters=this.findFilters();if(kbnFilters.length===0){return}let range;if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilters[0],"script")){range=external_kbnSharedDeps_Lodash_default.a.get(kbnFilters[0],"script.script.params")}else{range=external_kbnSharedDeps_Lodash_default.a.get(kbnFilters[0],["range",this.fieldName])}if(!range){return}return fromRange(range)}}function create_search_source_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function create_search_source_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){create_search_source_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){create_search_source_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function createSearchSource(_x,_x2,_x3,_x4,_x5){return _createSearchSource.apply(this,arguments)}function _createSearchSource(){_createSearchSource=create_search_source_asyncToGenerator(regeneratorRuntime.mark((function _callee({create:create},initialState,indexPattern,aggs,useTimeFilter,filters=[],timefilter){var searchSource;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return create(initialState||{});case 2:searchSource=_context.sent;searchSource.setParent(undefined);searchSource.setField("filter",()=>{const activeFilters=[...filters];if(useTimeFilter){const filter=timefilter.createFilter(indexPattern);if(filter){activeFilters.push(filter)}}return activeFilters});searchSource.setField("size",0);searchSource.setField("index",indexPattern);searchSource.setField("aggs",aggs);return _context.abrupt("return",searchSource);case 9:case"end":return _context.stop()}}),_callee)})));return _createSearchSource.apply(this,arguments)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function range_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function range_control_factory_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){range_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){range_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function range_control_factory_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const minMaxAgg=field=>{const aggBody={};if(field){if(field.scripted){aggBody.script={source:field.script,lang:field.lang}}else{aggBody.field=field.name}}return{maxAgg:{max:aggBody},minAgg:{min:aggBody}}};class range_control_factory_RangeControl extends control_Control{constructor(controlParams,filterManager,useTimeFilter,searchSource,deps){super(controlParams,filterManager,useTimeFilter);range_control_factory_defineProperty(this,"searchSource",void 0);range_control_factory_defineProperty(this,"timefilter",void 0);range_control_factory_defineProperty(this,"abortController",void 0);range_control_factory_defineProperty(this,"min",void 0);range_control_factory_defineProperty(this,"max",void 0);this.timefilter=deps.data.query.timefilter.timefilter;this.searchSource=searchSource}fetch(){var _this=this;return range_control_factory_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var indexPattern,fieldName,aggs,searchSource,abortSignal,resp,min,max;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this.abortController){_this.abortController.abort()}_this.abortController=new AbortController;indexPattern=_this.filterManager.getIndexPattern();if(indexPattern){_context.next=6;break}_this.disable(noIndexPatternMsg(_this.controlParams.indexPattern));return _context.abrupt("return");case 6:fieldName=_this.filterManager.fieldName;aggs=minMaxAgg(indexPattern.fields.getByName(fieldName));_context.next=10;return createSearchSource(_this.searchSource,null,indexPattern,aggs,_this.useTimeFilter,[],_this.timefilter);case 10:searchSource=_context.sent;abortSignal=_this.abortController.signal;_context.prev=12;_context.next=15;return searchSource.fetch({abortSignal:abortSignal});case 15:resp=_context.sent;_context.next=24;break;case 18:_context.prev=18;_context.t0=_context["catch"](12);if(!(_context.t0.name==="AbortError")){_context.next=22;break}return _context.abrupt("return");case 22:_this.disable(external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.rangeControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch range min and max, error: {errorMessage}",values:{errorMessage:_context.t0.message}}));return _context.abrupt("return");case 24:min=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.minAgg.value",null);max=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.maxAgg.value",null);if(!(min===null||max===null)){_context.next=29;break}_this.disable(noValuesDisableMsg(fieldName,indexPattern.title));return _context.abrupt("return");case 29:_this.min=min;_this.max=max;_this.enable=true;case 32:case"end":return _context.stop()}}),_callee,null,[[12,18]])})))()}destroy(){if(this.abortController)this.abortController.abort()}}function rangeControlFactory(_x,_x2,_x3){return _rangeControlFactory.apply(this,arguments)}function _rangeControlFactory(){_rangeControlFactory=range_control_factory_asyncToGenerator(regeneratorRuntime.mark((function _callee2(controlParams,useTimeFilter,deps){var _yield$deps$core$getS,_yield$deps$core$getS2,dataPluginStart,rangeControl;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deps.core.getStartServices();case 2:_yield$deps$core$getS=_context2.sent;_yield$deps$core$getS2=_slicedToArray(_yield$deps$core$getS,2);dataPluginStart=_yield$deps$core$getS2[1].data;rangeControl=new range_control_factory_RangeControl(controlParams,new range_filter_manager_RangeFilterManager(controlParams.id,controlParams.fieldName,controlParams.indexPattern,dataPluginStart.indexPatterns,deps.data.query.filterManager),useTimeFilter,dataPluginStart.search.searchSource,deps);_context2.next=8;return rangeControl.filterManager.init();case 8:return _context2.abrupt("return",rangeControl);case 9:case"end":return _context2.stop()}}),_callee2)})));return _rangeControlFactory.apply(this,arguments)}class phrase_filter_manager_PhraseFilterManager extends filter_manager_FilterManager{constructor(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter){super(controlId,fieldName,indexPatternId,indexPatternsService,queryFilter)}createFilter(phrases){const indexPattern=this.getIndexPattern();let newFilter;const value=indexPattern.fields.getByName(this.fieldName);if(!value){throw new Error("Unable to find field with name: ".concat(this.fieldName," on indexPattern"))}if(phrases.length===1){newFilter=data_public_["esFilters"].buildPhraseFilter(value,phrases[0],indexPattern)}else{newFilter=data_public_["esFilters"].buildPhrasesFilter(value,phrases,indexPattern)}newFilter.meta.key=this.fieldName;newFilter.meta.controlledBy=this.controlId;return newFilter}getValueFromFilterBar(){const kbnFilters=this.findFilters();if(kbnFilters.length===0){return}const values=kbnFilters.map(kbnFilter=>this.getValueFromFilter(kbnFilter)).filter(value=>value!=null);if(values.length===0){return}return values.reduce((accumulator,currentValue)=>accumulator.concat(currentValue),[])}getValueFromFilter(kbnFilter){if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,"query.bool.should")){return external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"query.bool.should").map(kbnQueryFilter=>this.getValueFromFilter(kbnQueryFilter)).filter(value=>{if(value){return true}return false})}if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,"script")){return external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,"script.script.params.value")}if(data_public_["esFilters"].isPhraseFilter(kbnFilter)){if(data_public_["esFilters"].getPhraseFilterField(kbnFilter)!==this.fieldName){return}return data_public_["esFilters"].getPhraseFilterValue(kbnFilter)}if(external_kbnSharedDeps_Lodash_default.a.has(kbnFilter,["match_phrase",this.fieldName])){return external_kbnSharedDeps_Lodash_default.a.get(kbnFilter,["match_phrase",this.fieldName])}}}function list_control_factory_slicedToArray(arr,i){return list_control_factory_arrayWithHoles(arr)||list_control_factory_iterableToArrayLimit(arr,i)||list_control_factory_unsupportedIterableToArray(arr,i)||list_control_factory_nonIterableRest()}function list_control_factory_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function list_control_factory_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return list_control_factory_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return list_control_factory_arrayLikeToArray(o,minLen)}function list_control_factory_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function list_control_factory_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function list_control_factory_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function list_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function list_control_factory_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){list_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){list_control_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function list_control_factory_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getEscapedQuery(query=""){return query.replace(/[.?+*|{}[\]()"\\#@&<>~]/g,match=>"\\".concat(match))}const termsAgg=({field:field,size:size,direction:direction,query:query})=>{const terms={order:{_count:direction}};if(size){terms.size=size<1?1:size}if(field===null||field===void 0?void 0:field.scripted){terms.script={source:field.script,lang:field.lang};terms.value_type=field.type==="number"?"float":field.type}else{terms.field=field===null||field===void 0?void 0:field.name}if(query){terms.include=".*".concat(getEscapedQuery(query),".*")}return{termsAgg:{terms:terms}}};class list_control_factory_ListControl extends control_Control{constructor(controlParams,filterManager,useTimeFilter,_searchSource,deps){var _this;super(controlParams,filterManager,useTimeFilter);_this=this;list_control_factory_defineProperty(this,"getSettings",void 0);list_control_factory_defineProperty(this,"timefilter",void 0);list_control_factory_defineProperty(this,"searchSource",void 0);list_control_factory_defineProperty(this,"abortController",void 0);list_control_factory_defineProperty(this,"lastAncestorValues",void 0);list_control_factory_defineProperty(this,"lastQuery",void 0);list_control_factory_defineProperty(this,"partialResults",void 0);list_control_factory_defineProperty(this,"selectOptions",void 0);list_control_factory_defineProperty(this,"fetch",function(){var _ref=list_control_factory_asyncToGenerator(regeneratorRuntime.mark((function _callee(query){var indexPattern,ancestorFilters,ancestorValues,fieldName,settings,initialSearchSourceState,field,aggs,searchSource,abortSignal,resp,selectOptions;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this.abortController){_this.abortController.abort()}_this.abortController=new AbortController;indexPattern=_this.filterManager.getIndexPattern();if(indexPattern){_context.next=6;break}_this.disable(noIndexPatternMsg(_this.controlParams.indexPattern));return _context.abrupt("return");case 6:if(!_this.hasAncestors()){_context.next=17;break}if(!_this.hasUnsetAncestor()){_context.next=11;break}_this.disable(external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.listControl.disableTooltip",{defaultMessage:"Disabled until '{label}' is set.",values:{label:_this.ancestors[0].label}}));_this.lastAncestorValues=undefined;return _context.abrupt("return");case 11:ancestorValues=_this.getAncestorValues();if(!(external_kbnSharedDeps_Lodash_default.a.isEqual(ancestorValues,_this.lastAncestorValues)&&external_kbnSharedDeps_Lodash_default.a.isEqual(query,_this.lastQuery))){_context.next=14;break}return _context.abrupt("return");case 14:_this.lastAncestorValues=ancestorValues;_this.lastQuery=query;ancestorFilters=_this.getAncestorFilters();case 17:fieldName=_this.filterManager.fieldName;_context.next=20;return _this.getSettings();case 20:settings=_context.sent;initialSearchSourceState={timeout:"".concat(settings.autocompleteTimeout,"ms"),terminate_after:Number(settings.autocompleteTerminateAfter)};field=indexPattern===null||indexPattern===void 0?void 0:indexPattern.fields.getAll().find(({name:name})=>name===_this.controlParams.fieldName);if(field&&field.type!=="string"){_this.options.dynamicOptions=false}aggs=termsAgg({field:indexPattern.fields.getByName(fieldName),size:_this.options.dynamicOptions?null:external_kbnSharedDeps_Lodash_default.a.get(_this.options,"size",5),direction:"desc",query:query});_context.next=27;return createSearchSource(_this.searchSource,initialSearchSourceState,indexPattern,aggs,_this.useTimeFilter,ancestorFilters,_this.timefilter);case 27:searchSource=_context.sent;abortSignal=_this.abortController.signal;_this.lastQuery=query;_context.prev=30;_context.next=33;return searchSource.fetch({abortSignal:abortSignal});case 33:resp=_context.sent;_context.next=42;break;case 36:_context.prev=36;_context.t0=_context["catch"](30);if(!(_context.t0.name==="AbortError")){_context.next=40;break}return _context.abrupt("return");case 40:_this.disable(external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.listControl.unableToFetchTooltip",{defaultMessage:"Unable to fetch terms, error: {errorMessage}",values:{errorMessage:_context.t0.message}}));return _context.abrupt("return");case 42:if(!(query&&_this.lastQuery!==query)){_context.next=44;break}return _context.abrupt("return");case 44:selectOptions=external_kbnSharedDeps_Lodash_default.a.get(resp,"aggregations.termsAgg.buckets",[]).map(bucket=>bucket===null||bucket===void 0?void 0:bucket.key);if(!(selectOptions.length===0&&!query)){_context.next=48;break}_this.disable(noValuesDisableMsg(fieldName,indexPattern.title));return _context.abrupt("return");case 48:_this.partialResults=resp.terminated_early||resp.timed_out;_this.selectOptions=selectOptions;_this.enable=true;_this.disabledReason="";case 52:case"end":return _context.stop()}}),_callee,null,[[30,36]])})));return function(_x){return _ref.apply(this,arguments)}}());this.getSettings=deps.getSettings;this.timefilter=deps.data.query.timefilter.timefilter;this.searchSource=_searchSource}destroy(){if(this.abortController)this.abortController.abort()}hasValue(){return typeof this.value!=="undefined"&&this.value.length>0}}function listControlFactory(_x2,_x3,_x4){return _listControlFactory.apply(this,arguments)}function _listControlFactory(){_listControlFactory=list_control_factory_asyncToGenerator(regeneratorRuntime.mark((function _callee2(controlParams,useTimeFilter,deps){var _yield$deps$core$getS,_yield$deps$core$getS2,dataPluginStart,listControl;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return deps.core.getStartServices();case 2:_yield$deps$core$getS=_context2.sent;_yield$deps$core$getS2=list_control_factory_slicedToArray(_yield$deps$core$getS,2);dataPluginStart=_yield$deps$core$getS2[1].data;listControl=new list_control_factory_ListControl(controlParams,new phrase_filter_manager_PhraseFilterManager(controlParams.id,controlParams.fieldName,controlParams.indexPattern,dataPluginStart.indexPatterns,deps.data.query.filterManager),useTimeFilter,dataPluginStart.search.searchSource,deps);_context2.next=8;return listControl.filterManager.init();case 8:return _context2.abrupt("return",listControl);case 9:case"end":return _context2.stop()}}),_callee2)})));return _listControlFactory.apply(this,arguments)}function getControlFactory(controlParams){let factory=null;switch(controlParams.type){case CONTROL_TYPES.RANGE:factory=rangeControlFactory;break;case CONTROL_TYPES.LIST:factory=listControlFactory;break;default:throw new Error("Unhandled control type ".concat(controlParams.type))}return factory}function getLineageMap(controlParamsList){function getControlParamsById(controlId){return controlParamsList.find(controlParams=>controlParams.id===controlId)}const lineageMap=new Map;controlParamsList.forEach(rootControlParams=>{const lineage=[rootControlParams.id];const getLineage=controlParams=>{if(external_kbnSharedDeps_Lodash_default.a.has(controlParams,"parent")&&controlParams.parent!==""&&!lineage.includes(controlParams.parent)){lineage.push(controlParams.parent);const parent=getControlParamsById(controlParams.parent);if(parent){getLineage(parent)}}};getLineage(rootControlParams);lineageMap.set(rootControlParams.id,lineage)});return lineageMap}function getParentCandidates(controlParamsList,controlId,lineageMap){return controlParamsList.filter(controlParams=>{if(!controlParams.indexPattern||!controlParams.fieldName){return false}const lineage=lineageMap.get(controlParams.id);if(lineage===null||lineage===void 0?void 0:lineage.includes(controlId)){return false}return true}).map((controlParams,controlIndex)=>({value:controlParams.id,text:getTitle(controlParams,controlIndex)}))}function vis_controller_slicedToArray(arr,i){return vis_controller_arrayWithHoles(arr)||vis_controller_iterableToArrayLimit(arr,i)||vis_controller_unsupportedIterableToArray(arr,i)||vis_controller_nonIterableRest()}function vis_controller_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function vis_controller_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return vis_controller_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vis_controller_arrayLikeToArray(o,minLen)}function vis_controller_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function vis_controller_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function vis_controller_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function vis_controller_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function vis_controller_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){vis_controller_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){vis_controller_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function vis_controller_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const createInputControlVisController=deps=>{var _temp;return _temp=class InputControlVisController{constructor(el,vis){var _this=this;this.el=el;this.vis=vis;vis_controller_defineProperty(this,"I18nContext",void 0);vis_controller_defineProperty(this,"_isLoaded",false);vis_controller_defineProperty(this,"controls",void 0);vis_controller_defineProperty(this,"queryBarUpdateHandler",void 0);vis_controller_defineProperty(this,"filterManager",void 0);vis_controller_defineProperty(this,"updateSubsciption",void 0);vis_controller_defineProperty(this,"timeFilterSubscription",void 0);vis_controller_defineProperty(this,"visParams",void 0);vis_controller_defineProperty(this,"drawVis",()=>{var _this$visParams;if(!this.I18nContext){throw new Error("no i18n context found")}Object(external_kbnSharedDeps_ReactDom_["render"])(external_kbnSharedDeps_React_default.a.createElement(this.I18nContext,null,external_kbnSharedDeps_React_default.a.createElement(input_control_vis_InputControlVis,{updateFiltersOnChange:(_this$visParams=this.visParams)===null||_this$visParams===void 0?void 0:_this$visParams.updateFiltersOnChange,controls:this.controls,stageFilter:this.stageFilter,submitFilters:this.submitFilters,resetControls:this.updateControlsFromKbn,clearControls:this.clearControls,hasChanges:this.hasChanges,hasValues:this.hasValues,refreshControl:this.refreshControl})),this.el)});vis_controller_defineProperty(this,"stageFilter",function(){var _ref=vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee(controlIndex,newValue){var _this$visParams2;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_this.controls[controlIndex].set(newValue);if(!((_this$visParams2=_this.visParams)===null||_this$visParams2===void 0?void 0:_this$visParams2.updateFiltersOnChange)){_context.next=5;break}_this.submitFilters();_context.next=8;break;case 5:_context.next=7;return _this.updateNestedControls();case 7:_this.drawVis();case 8:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}());vis_controller_defineProperty(this,"submitFilters",()=>{var _this$visParams3;const stagedControls=this.controls.filter(control=>control.hasChanged());const newFilters=stagedControls.map(control=>control.getKbnFilter()).filter(filter=>filter!==null);stagedControls.forEach(control=>{control.filterManager.findFilters().forEach(existingFilter=>{this.filterManager.removeFilter(existingFilter)})});this.controls.map(control=>{if(control.hasAncestors()&&control.hasUnsetAncestor()){control.filterManager.findFilters().forEach(existingFilter=>{this.filterManager.removeFilter(existingFilter)})}});this.filterManager.addFilters(newFilters,(_this$visParams3=this.visParams)===null||_this$visParams3===void 0?void 0:_this$visParams3.pinFilters)});vis_controller_defineProperty(this,"clearControls",vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_this.controls.forEach(control=>{control.clear()});_context2.next=3;return _this.updateNestedControls();case 3:_this.drawVis();case 4:case"end":return _context2.stop()}}),_callee2)}))));vis_controller_defineProperty(this,"updateControlsFromKbn",vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_this.controls.forEach(control=>{control.reset()});_context3.next=3;return _this.updateNestedControls();case 3:_this.drawVis();case 4:case"end":return _context3.stop()}}),_callee3)}))));vis_controller_defineProperty(this,"hasChanges",()=>this.controls.map(control=>control.hasChanged()).some(control=>control));vis_controller_defineProperty(this,"hasValues",()=>this.controls.map(control=>control.hasValue()).reduce((a,b)=>a||b));vis_controller_defineProperty(this,"refreshControl",function(){var _ref4=vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee4(controlIndex,query){return regeneratorRuntime.wrap((function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _this.controls[controlIndex].fetch(query);case 2:_this.drawVis();case 3:case"end":return _context4.stop()}}),_callee4)})));return function(_x3,_x4){return _ref4.apply(this,arguments)}}());this.controls=[];this.queryBarUpdateHandler=this.updateControlsFromKbn.bind(this);this.filterManager=deps.data.query.filterManager;this.updateSubsciption=this.filterManager.getUpdates$().subscribe(this.queryBarUpdateHandler);this.timeFilterSubscription=deps.data.query.timefilter.timefilter.getTimeUpdate$().subscribe(()=>{var _this$visParams4;if((_this$visParams4=this.visParams)===null||_this$visParams4===void 0?void 0:_this$visParams4.useTimeFilter){this._isLoaded=false}})}render(visData,visParams){var _this2=this;return vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var _yield$deps$core$getS,_yield$deps$core$getS2,i18n;return regeneratorRuntime.wrap((function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:if(_this2.I18nContext){_context5.next=7;break}_context5.next=3;return deps.core.getStartServices();case 3:_yield$deps$core$getS=_context5.sent;_yield$deps$core$getS2=vis_controller_slicedToArray(_yield$deps$core$getS,1);i18n=_yield$deps$core$getS2[0].i18n;_this2.I18nContext=i18n.Context;case 7:if(!(!_this2._isLoaded||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(visParams,_this2.visParams))){_context5.next=14;break}_this2.visParams=visParams;_this2.controls=[];_context5.next=12;return _this2.initControls();case 12:_this2.controls=_context5.sent;_this2._isLoaded=true;case 14:_this2.drawVis();case 15:case"end":return _context5.stop()}}),_callee5)})))()}destroy(){this.updateSubsciption.unsubscribe();this.timeFilterSubscription.unsubscribe();Object(external_kbnSharedDeps_ReactDom_["unmountComponentAtNode"])(this.el);this.controls.forEach(control=>control.destroy())}initControls(){var _this3=this;return vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee6(){var _this3$visParams,_this3$visParams$cont;var controlParamsList,controlFactoryPromises,controls,getControl,controlInitPromises;return regeneratorRuntime.wrap((function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:controlParamsList=(_this3$visParams=_this3.visParams)===null||_this3$visParams===void 0?void 0:(_this3$visParams$cont=_this3$visParams.controls)===null||_this3$visParams$cont===void 0?void 0:_this3$visParams$cont.filter(controlParams=>controlParams.indexPattern&&controlParams.fieldName);controlFactoryPromises=controlParamsList.map(controlParams=>{var _this3$visParams2;const factory=getControlFactory(controlParams);return factory(controlParams,(_this3$visParams2=_this3.visParams)===null||_this3$visParams2===void 0?void 0:_this3$visParams2.useTimeFilter,deps)});_context6.next=4;return Promise.all(controlFactoryPromises);case 4:controls=_context6.sent;getControl=controlId=>controls.find(({id:id})=>id===controlId);controlInitPromises=[];getLineageMap(controlParamsList).forEach((lineage,controlId)=>{lineage.shift();const ancestors=[];lineage.forEach(ancestorId=>{const control=getControl(ancestorId);if(control){ancestors.push(control)}});const control=getControl(controlId);if(control){control.setAncestors(ancestors);controlInitPromises.push(control.fetch())}});_context6.next=10;return Promise.all(controlInitPromises);case 10:return _context6.abrupt("return",controls);case 11:case"end":return _context6.stop()}}),_callee6)})))()}updateNestedControls(){var _this4=this;return vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee8(){var fetchPromises;return regeneratorRuntime.wrap((function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:fetchPromises=_this4.controls.map(function(){var _ref5=vis_controller_asyncToGenerator(regeneratorRuntime.mark((function _callee7(control){return regeneratorRuntime.wrap((function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:if(!control.hasAncestors()){_context7.next=3;break}_context7.next=3;return control.fetch();case 3:case"end":return _context7.stop()}}),_callee7)})));return function(_x5){return _ref5.apply(this,arguments)}}());_context8.next=3;return Promise.all(fetchPromises);case 3:return _context8.abrupt("return",_context8.sent);case 4:case"end":return _context8.stop()}}),_callee8)})))()}},_temp};function IndexPatternSelectFormRowUi(props){const controlIndex=props.controlIndex,indexPatternId=props.indexPatternId,intl=props.intl,onChange=props.onChange;const selectId="indexPatternSelect-".concat(controlIndex);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:selectId,label:intl.formatMessage({id:"inputControl.editor.indexPatternSelect.patternLabel",defaultMessage:"Index Pattern"})},external_kbnSharedDeps_React_default.a.createElement(props.IndexPatternSelect,{placeholder:intl.formatMessage({id:"inputControl.editor.indexPatternSelect.patternPlaceholder",defaultMessage:"Select index pattern..."}),indexPatternId:indexPatternId,onChange:onChange,"data-test-subj":selectId}))}const IndexPatternSelectFormRow=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(IndexPatternSelectFormRowUi);function field_select_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function field_select_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){field_select_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){field_select_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function field_select_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class field_select_FieldSelectUi extends external_kbnSharedDeps_React_["Component"]{constructor(props){var _this;super(props);_this=this;field_select_defineProperty(this,"hasUnmounted",void 0);field_select_defineProperty(this,"loadFields",indexPatternId=>{this.setState({isLoading:true,fields:[],indexPatternId:indexPatternId},this.debouncedLoad.bind(null,indexPatternId))});field_select_defineProperty(this,"debouncedLoad",external_kbnSharedDeps_Lodash_default.a.debounce(function(){var _ref=field_select_asyncToGenerator(regeneratorRuntime.mark((function _callee(indexPatternId){var _this$props$filterFie;var indexPattern,fieldsByTypeMap,fields;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(!indexPatternId||indexPatternId.length===0)){_context.next=2;break}return _context.abrupt("return");case 2:_context.prev=2;_context.next=5;return _this.props.getIndexPattern(indexPatternId);case 5:indexPattern=_context.sent;_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](2);return _context.abrupt("return");case 11:if(!_this.hasUnmounted){_context.next=13;break}return _context.abrupt("return");case 13:if(!(indexPattern.id!==_this.state.indexPatternId)){_context.next=15;break}return _context.abrupt("return");case 15:fieldsByTypeMap=new Map;fields=[];indexPattern.fields.filter((_this$props$filterFie=_this.props.filterField)!==null&&_this$props$filterFie!==void 0?_this$props$filterFie:()=>true).forEach(field=>{var _fieldsByTypeMap$get;const fieldsList=(_fieldsByTypeMap$get=fieldsByTypeMap.get(field.type))!==null&&_fieldsByTypeMap$get!==void 0?_fieldsByTypeMap$get:[];fieldsList.push(field.name);fieldsByTypeMap.set(field.type,fieldsList)});fieldsByTypeMap.forEach((fieldsList,fieldType)=>{fields.push({label:fieldType,options:fieldsList.sort().map(fieldName=>({value:fieldName,label:fieldName}))})});fields.sort((a,b)=>{if(a.label<b.label)return-1;if(a.label>b.label)return 1;return 0});_this.setState({isLoading:false,fields:fields});case 21:case"end":return _context.stop()}}),_callee,null,[[2,8]])})));return function(_x){return _ref.apply(this,arguments)}}(),300));field_select_defineProperty(this,"onChange",selectedOptions=>{this.props.onChange(external_kbnSharedDeps_Lodash_default.a.get(selectedOptions,"0.value"))});this.hasUnmounted=false;this.state={isLoading:false,fields:[],indexPatternId:props.indexPatternId}}componentWillUnmount(){this.hasUnmounted=true}componentDidMount(){this.loadFields(this.state.indexPatternId)}UNSAFE_componentWillReceiveProps(nextProps){if(this.props.indexPatternId!==nextProps.indexPatternId){var _nextProps$indexPatte;this.loadFields((_nextProps$indexPatte=nextProps.indexPatternId)!==null&&_nextProps$indexPatte!==void 0?_nextProps$indexPatte:"")}}render(){if(!this.props.indexPatternId||this.props.indexPatternId.trim().length===0){return null}const selectId="fieldSelect-".concat(this.props.controlIndex);const selectedOptions=[];const intl=this.props.intl;if(this.props.fieldName){selectedOptions.push({value:this.props.fieldName,label:this.props.fieldName})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:selectId,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.fieldSelect.fieldLabel",defaultMessage:"Field"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:intl.formatMessage({id:"inputControl.editor.fieldSelect.selectFieldPlaceholder",defaultMessage:"Select field..."}),singleSelection:true,isLoading:this.state.isLoading,options:this.state.fields,selectedOptions:selectedOptions,onChange:this.onChange,"data-test-subj":selectId}))}}const FieldSelect=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(field_select_FieldSelectUi);function range_control_editor_slicedToArray(arr,i){return range_control_editor_arrayWithHoles(arr)||range_control_editor_iterableToArrayLimit(arr,i)||range_control_editor_unsupportedIterableToArray(arr,i)||range_control_editor_nonIterableRest()}function range_control_editor_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function range_control_editor_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return range_control_editor_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return range_control_editor_arrayLikeToArray(o,minLen)}function range_control_editor_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function range_control_editor_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function range_control_editor_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function range_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function range_control_editor_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){range_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){range_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function range_control_editor_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function filterField(field){return field.type==="number"}class range_control_editor_RangeControlEditor extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);range_control_editor_defineProperty(this,"state",{IndexPatternSelect:null})}componentDidMount(){this.getIndexPatternSelect()}getIndexPatternSelect(){var _this=this;return range_control_editor_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _yield$_this$props$de,_yield$_this$props$de2,data;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return _this.props.deps.core.getStartServices();case 2:_yield$_this$props$de=_context.sent;_yield$_this$props$de2=range_control_editor_slicedToArray(_yield$_this$props$de,2);data=_yield$_this$props$de2[1].data;_this.setState({IndexPatternSelect:data.ui.IndexPatternSelect});case 6:case"end":return _context.stop()}}),_callee)})))()}render(){const stepSizeId="stepSize-".concat(this.props.controlIndex);const decimalPlacesId="decimalPlaces-".concat(this.props.controlIndex);if(this.state.IndexPatternSelect===null){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(IndexPatternSelectFormRow,{indexPatternId:this.props.controlParams.indexPattern,onChange:this.props.handleIndexPatternChange,controlIndex:this.props.controlIndex,IndexPatternSelect:this.state.IndexPatternSelect}),external_kbnSharedDeps_React_default.a.createElement(FieldSelect,{fieldName:this.props.controlParams.fieldName,indexPatternId:this.props.controlParams.indexPattern,filterField:filterField,onChange:this.props.handleFieldNameChange,getIndexPattern:this.props.getIndexPattern,controlIndex:this.props.controlIndex}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:stepSizeId,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.rangeControl.stepSizeLabel",defaultMessage:"Step Size"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{value:this.props.controlParams.options.step,onChange:event=>{this.props.handleOptionsChange(this.props.controlIndex,"step",event.target.valueAsNumber)},"data-test-subj":"rangeControlSizeInput".concat(this.props.controlIndex)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:decimalPlacesId,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.rangeControl.decimalPlacesLabel",defaultMessage:"Decimal Places"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{min:0,value:this.props.controlParams.options.decimalPlaces,onChange:event=>{this.props.handleOptionsChange(this.props.controlIndex,"decimalPlaces",event.target.valueAsNumber)},"data-test-subj":"rangeControlDecimalPlacesInput".concat(this.props.controlIndex)})))}}function list_control_editor_slicedToArray(arr,i){return list_control_editor_arrayWithHoles(arr)||list_control_editor_iterableToArrayLimit(arr,i)||list_control_editor_unsupportedIterableToArray(arr,i)||list_control_editor_nonIterableRest()}function list_control_editor_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function list_control_editor_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return list_control_editor_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return list_control_editor_arrayLikeToArray(o,minLen)}function list_control_editor_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function list_control_editor_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function list_control_editor_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function list_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function list_control_editor_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){list_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){list_control_editor_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function list_control_editor_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function list_control_editor_filterField(field){return Boolean(field.aggregatable)&&["number","boolean","date","ip","string"].includes(field.type)}class list_control_editor_ListControlEditor extends external_kbnSharedDeps_React_["PureComponent"]{constructor(...args){var _this;super(...args);_this=this;list_control_editor_defineProperty(this,"isMounted",false);list_control_editor_defineProperty(this,"state",{isLoadingFieldType:true,isStringField:false,prevFieldName:this.props.controlParams.fieldName,IndexPatternSelect:null});list_control_editor_defineProperty(this,"componentDidUpdate",()=>{if(this.state.isLoadingFieldType){this.loadIsStringField()}});list_control_editor_defineProperty(this,"loadIsStringField",list_control_editor_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var indexPattern,field;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(!_this.props.controlParams.indexPattern||!_this.props.controlParams.fieldName)){_context.next=3;break}_this.setState({isLoadingFieldType:false});return _context.abrupt("return");case 3:_context.prev=3;_context.next=6;return _this.props.getIndexPattern(_this.props.controlParams.indexPattern);case 6:indexPattern=_context.sent;_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](3);return _context.abrupt("return");case 12:if(_this.isMounted){_context.next=14;break}return _context.abrupt("return");case 14:field=indexPattern.fields.find(({name:name})=>name===_this.props.controlParams.fieldName);if(field){_context.next=17;break}return _context.abrupt("return");case 17:_this.setState({isLoadingFieldType:false,isStringField:field.type==="string"});case 18:case"end":return _context.stop()}}),_callee,null,[[3,9]])}))));list_control_editor_defineProperty(this,"renderOptions",()=>{var _this$props$controlPa,_this$props$controlPa2;if(this.state.isLoadingFieldType||!this.props.controlParams.fieldName){return}const options=[];if(this.props.parentCandidates&&this.props.parentCandidates.length>0){const parentCandidatesOptions=[{value:"",text:""},...this.props.parentCandidates];options.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"parentSelect-".concat(this.props.controlIndex),label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.parentLabel",defaultMessage:"Parent control"}),helpText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.parentDescription",defaultMessage:"Options are based on the value of parent control. Disabled if parent is not set."}),key:"parentSelect"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:parentCandidatesOptions,value:this.props.controlParams.parent,onChange:event=>{this.props.handleParentChange(this.props.controlIndex,event.target.value)}})))}options.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"multiselect-".concat(this.props.controlIndex),key:"multiselect",helpText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.multiselectDescription",defaultMessage:"Allow multiple selection"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.multiselectLabel",defaultMessage:"Multiselect"}),checked:(_this$props$controlPa=this.props.controlParams.options.multiselect)!==null&&_this$props$controlPa!==void 0?_this$props$controlPa:true,onChange:event=>{this.props.handleOptionsChange(this.props.controlIndex,"multiselect",event.target.checked)},"data-test-subj":"listControlMultiselectInput"})));const dynamicOptionsHelpText=this.state.isStringField?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.dynamicOptions.updateDescription",defaultMessage:"Update options in response to user input"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.dynamicOptions.stringFieldDescription",defaultMessage:'Only available for "string" fields'});options.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"dynamicOptions-".concat(this.props.controlIndex),key:"dynamicOptions",helpText:dynamicOptionsHelpText},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.dynamicOptionsLabel",defaultMessage:"Dynamic Options"}),checked:(_this$props$controlPa2=this.props.controlParams.options.dynamicOptions)!==null&&_this$props$controlPa2!==void 0?_this$props$controlPa2:false,onChange:event=>{this.props.handleOptionsChange(this.props.controlIndex,"dynamicOptions",event.target.checked)},disabled:this.state.isStringField?false:true,"data-test-subj":"listControlDynamicOptionsSwitch"})));if(!this.props.controlParams.options.dynamicOptions||!this.state.isStringField){options.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"size-".concat(this.props.controlIndex),label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.sizeLabel",defaultMessage:"Size"}),key:"size",helpText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.listControl.sizeDescription",defaultMessage:"Number of options"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{min:1,value:this.props.controlParams.options.size,onChange:event=>{this.props.handleOptionsChange(this.props.controlIndex,"size",event.target.valueAsNumber)},"data-test-subj":"listControlSizeInput"})))}return options})}componentDidMount(){this.isMounted=true;this.loadIsStringField();this.getIndexPatternSelect()}componentWillUnmount(){this.isMounted=false}getIndexPatternSelect(){var _this2=this;return list_control_editor_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var _yield$_this2$props$d,_yield$_this2$props$d2,data;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _this2.props.deps.core.getStartServices();case 2:_yield$_this2$props$d=_context2.sent;_yield$_this2$props$d2=list_control_editor_slicedToArray(_yield$_this2$props$d,2);data=_yield$_this2$props$d2[1].data;_this2.setState({IndexPatternSelect:data.ui.IndexPatternSelect});case 6:case"end":return _context2.stop()}}),_callee2)})))()}render(){if(this.state.IndexPatternSelect===null){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(IndexPatternSelectFormRow,{indexPatternId:this.props.controlParams.indexPattern,onChange:this.props.handleIndexPatternChange,controlIndex:this.props.controlIndex,IndexPatternSelect:this.state.IndexPatternSelect}),external_kbnSharedDeps_React_default.a.createElement(FieldSelect,{fieldName:this.props.controlParams.fieldName,indexPatternId:this.props.controlParams.indexPattern,filterField:list_control_editor_filterField,onChange:this.props.handleFieldNameChange,getIndexPattern:this.props.getIndexPattern,controlIndex:this.props.controlIndex}),this.renderOptions())}}list_control_editor_defineProperty(list_control_editor_ListControlEditor,"getDerivedStateFromProps",(nextProps,prevState)=>{const isNewFieldName=prevState.prevFieldName!==nextProps.controlParams.fieldName;if(!prevState.isLoadingFieldType&&isNewFieldName){return{prevFieldName:nextProps.controlParams.fieldName,isLoadingFieldType:true}}return null});function control_editor_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class control_editor_ControlEditorUi extends external_kbnSharedDeps_React_["PureComponent"]{constructor(...args){super(...args);control_editor_defineProperty(this,"changeLabel",event=>{this.props.handleLabelChange(this.props.controlIndex,event.target.value)});control_editor_defineProperty(this,"removeControl",()=>{this.props.handleRemoveControl(this.props.controlIndex)});control_editor_defineProperty(this,"moveUpControl",()=>{this.props.moveControl(this.props.controlIndex,-1)});control_editor_defineProperty(this,"moveDownControl",()=>{this.props.moveControl(this.props.controlIndex,1)});control_editor_defineProperty(this,"changeIndexPattern",indexPatternId=>{this.props.handleIndexPatternChange(this.props.controlIndex,indexPatternId)});control_editor_defineProperty(this,"changeFieldName",fieldName=>{this.props.handleFieldNameChange(this.props.controlIndex,fieldName)})}renderEditor(){let controlEditor=null;switch(this.props.controlParams.type){case CONTROL_TYPES.LIST:controlEditor=external_kbnSharedDeps_React_default.a.createElement(list_control_editor_ListControlEditor,{controlIndex:this.props.controlIndex,controlParams:this.props.controlParams,handleIndexPatternChange:this.changeIndexPattern,handleFieldNameChange:this.changeFieldName,getIndexPattern:this.props.getIndexPattern,handleOptionsChange:this.props.handleOptionsChange,parentCandidates:this.props.parentCandidates,handleParentChange:this.props.handleParentChange,deps:this.props.deps});break;case CONTROL_TYPES.RANGE:controlEditor=external_kbnSharedDeps_React_default.a.createElement(range_control_editor_RangeControlEditor,{controlIndex:this.props.controlIndex,controlParams:this.props.controlParams,handleIndexPatternChange:this.changeIndexPattern,handleFieldNameChange:this.changeFieldName,getIndexPattern:this.props.getIndexPattern,handleOptionsChange:this.props.handleOptionsChange,deps:this.props.deps});break;default:throw new Error("Unhandled control editor type ".concat(this.props.controlParams.type))}const labelId="controlLabel".concat(this.props.controlIndex);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:labelId,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.controlEditor.controlLabel",defaultMessage:"Control Label"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:this.props.controlParams.label,onChange:this.changeLabel})),controlEditor)}renderEditorButtons(){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":this.props.intl.formatMessage({id:"inputControl.editor.controlEditor.moveControlUpAriaLabel",defaultMessage:"Move control up"}),color:"primary",onClick:this.moveUpControl,iconType:"sortUp","data-test-subj":"inputControlEditorMoveUpControl".concat(this.props.controlIndex)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":this.props.intl.formatMessage({id:"inputControl.editor.controlEditor.moveControlDownAriaLabel",defaultMessage:"Move control down"}),color:"primary",onClick:this.moveDownControl,iconType:"sortDown","data-test-subj":"inputControlEditorMoveDownControl".concat(this.props.controlIndex)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":this.props.intl.formatMessage({id:"inputControl.editor.controlEditor.removeControlAriaLabel",defaultMessage:"Remove control"}),color:"danger",onClick:this.removeControl,iconType:"cross","data-test-subj":"inputControlEditorRemoveControl".concat(this.props.controlIndex)}))}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false,className:"icvControlEditor__panel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"controlEditorAccordion",buttonContent:getTitle(this.props.controlParams,this.props.controlIndex),extraAction:this.renderEditorButtons(),initialIsOpen:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),this.renderEditor()))}}const ControlEditor=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(control_editor_ControlEditorUi);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){controls_tab_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function controls_tab_slicedToArray(arr,i){return controls_tab_arrayWithHoles(arr)||controls_tab_iterableToArrayLimit(arr,i)||controls_tab_unsupportedIterableToArray(arr,i)||controls_tab_nonIterableRest()}function controls_tab_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function controls_tab_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return controls_tab_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return controls_tab_arrayLikeToArray(o,minLen)}function controls_tab_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function controls_tab_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function controls_tab_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function controls_tab_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function controls_tab_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){controls_tab_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){controls_tab_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function controls_tab_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class controls_tab_ControlsTabUi extends external_kbnSharedDeps_React_["PureComponent"]{constructor(...args){var _this;super(...args);_this=this;controls_tab_defineProperty(this,"state",{type:CONTROL_TYPES.LIST});controls_tab_defineProperty(this,"getIndexPattern",function(){var _ref=controls_tab_asyncToGenerator(regeneratorRuntime.mark((function _callee(indexPatternId){var _yield$_this$props$de,_yield$_this$props$de2,startDeps;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return _this.props.deps.core.getStartServices();case 2:_yield$_this$props$de=_context.sent;_yield$_this$props$de2=controls_tab_slicedToArray(_yield$_this$props$de,2);startDeps=_yield$_this$props$de2[1];_context.next=7;return startDeps.data.indexPatterns.get(indexPatternId);case 7:return _context.abrupt("return",_context.sent);case 8:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}());controls_tab_defineProperty(this,"onChange",value=>this.props.setValue("controls",value));controls_tab_defineProperty(this,"handleLabelChange",(controlIndex,label)=>{const updatedControl=_objectSpread(_objectSpread({},this.props.stateParams.controls[controlIndex]),{},{label:label});this.onChange(setControl(this.props.stateParams.controls,controlIndex,updatedControl))});controls_tab_defineProperty(this,"handleIndexPatternChange",(controlIndex,indexPattern)=>{const updatedControl=_objectSpread(_objectSpread({},this.props.stateParams.controls[controlIndex]),{},{indexPattern:indexPattern,fieldName:""});this.onChange(setControl(this.props.stateParams.controls,controlIndex,updatedControl))});controls_tab_defineProperty(this,"handleFieldNameChange",(controlIndex,fieldName)=>{const updatedControl=_objectSpread(_objectSpread({},this.props.stateParams.controls[controlIndex]),{},{fieldName:fieldName});this.onChange(setControl(this.props.stateParams.controls,controlIndex,updatedControl))});controls_tab_defineProperty(this,"handleOptionsChange",(controlIndex,optionName,value)=>{const control=this.props.stateParams.controls[controlIndex];const updatedControl=_objectSpread(_objectSpread({},control),{},{options:_objectSpread(_objectSpread({},control.options),{},{[optionName]:value})});this.onChange(setControl(this.props.stateParams.controls,controlIndex,updatedControl))});controls_tab_defineProperty(this,"handleRemoveControl",controlIndex=>{this.onChange(removeControl(this.props.stateParams.controls,controlIndex))});controls_tab_defineProperty(this,"moveControl",(controlIndex,direction)=>{this.onChange(moveControl(this.props.stateParams.controls,controlIndex,direction))});controls_tab_defineProperty(this,"handleAddControl",()=>{this.onChange(addControl(this.props.stateParams.controls,newControl(this.state.type)))});controls_tab_defineProperty(this,"handleParentChange",(controlIndex,parent)=>{const updatedControl=_objectSpread(_objectSpread({},this.props.stateParams.controls[controlIndex]),{},{parent:parent});this.onChange(setControl(this.props.stateParams.controls,controlIndex,updatedControl))})}renderControls(){const lineageMap=getLineageMap(this.props.stateParams.controls);return this.props.stateParams.controls.map((controlParams,controlIndex)=>{const parentCandidates=getParentCandidates(this.props.stateParams.controls,controlParams.id,lineageMap);return external_kbnSharedDeps_React_default.a.createElement(ControlEditor,{key:controlParams.id,controlIndex:controlIndex,controlParams:controlParams,handleLabelChange:this.handleLabelChange,moveControl:this.moveControl,handleRemoveControl:this.handleRemoveControl,handleIndexPatternChange:this.handleIndexPatternChange,handleFieldNameChange:this.handleFieldNameChange,getIndexPattern:this.getIndexPattern,handleOptionsChange:this.handleOptionsChange,parentCandidates:parentCandidates,handleParentChange:this.handleParentChange,deps:this.props.deps})})}render(){const intl=this.props.intl;return external_kbnSharedDeps_React_default.a.createElement("div",null,this.renderControls(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"selectControlType"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"data-test-subj":"selectControlType",options:[{value:CONTROL_TYPES.RANGE,text:intl.formatMessage({id:"inputControl.editor.controlsTab.select.rangeDropDownOptionLabel",defaultMessage:"Range slider"})},{value:CONTROL_TYPES.LIST,text:intl.formatMessage({id:"inputControl.editor.controlsTab.select.listDropDownOptionLabel",defaultMessage:"Options list"})}],value:this.state.type,onChange:event=>this.setState({type:event.target.value}),"aria-label":intl.formatMessage({id:"inputControl.editor.controlsTab.select.controlTypeAriaLabel",defaultMessage:"Select control type"})}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"addControl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,onClick:this.handleAddControl,iconType:"plusInCircle","data-test-subj":"inputControlEditorAddBtn","aria-label":intl.formatMessage({id:"inputControl.editor.controlsTab.select.addControlAriaLabel",defaultMessage:"Add control"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.controlsTab.addButtonLabel",defaultMessage:"Add"})))))))}}const controls_tab_ControlsTab=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(controls_tab_ControlsTabUi);const getControlsTab=deps=>props=>external_kbnSharedDeps_React_default.a.createElement(controls_tab_ControlsTab,_extends({},props,{deps:deps}));function options_tab_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class options_tab_OptionsTab extends external_kbnSharedDeps_React_["PureComponent"]{constructor(...args){super(...args);options_tab_defineProperty(this,"handleUpdateFiltersChange",event=>{this.props.setValue("updateFiltersOnChange",event.target.checked)});options_tab_defineProperty(this,"handleUseTimeFilter",event=>{this.props.setValue("useTimeFilter",event.target.checked)});options_tab_defineProperty(this,"handlePinFilters",event=>{this.props.setValue("pinFilters",event.target.checked)})}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"updateFiltersOnChange"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.optionsTab.updateFilterLabel",defaultMessage:"Update Kibana filters on each change"}),checked:this.props.stateParams.updateFiltersOnChange,onChange:this.handleUpdateFiltersChange,"data-test-subj":"inputControlEditorUpdateFiltersOnChangeCheckbox"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"useTimeFilter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.optionsTab.useTimeFilterLabel",defaultMessage:"Use time filter"}),checked:this.props.stateParams.useTimeFilter,onChange:this.handleUseTimeFilter,"data-test-subj":"inputControlEditorUseTimeFilterCheckbox"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"pinFilters"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"inputControl.editor.optionsTab.pinFiltersLabel",defaultMessage:"Pin filters for all applications"}),checked:this.props.stateParams.pinFilters,onChange:this.handlePinFilters,"data-test-subj":"inputControlEditorPinFiltersCheckbox"})))}}function createInputControlVisTypeDefinition(deps){const InputControlVisController=createInputControlVisController(deps);const ControlsTab=getControlsTab(deps);return{name:"input_control_vis",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.register.controlsTitle",{defaultMessage:"Controls"}),icon:"controlsHorizontal",group:public_["VisGroups"].TOOLS,description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.register.controlsDescription",{defaultMessage:"Add dropdown menus and range sliders to your dashboard."}),stage:"experimental",visualization:InputControlVisController,visConfig:{defaults:{controls:[],updateFiltersOnChange:false,useTimeFilter:false,pinFilters:false}},editorConfig:{optionTabs:[{name:"controls",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.register.tabs.controlsTitle",{defaultMessage:"Controls"}),editor:ControlsTab},{name:"options",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("inputControl.register.tabs.optionsTitle",{defaultMessage:"Options"}),editor:options_tab_OptionsTab}]},inspectorAdapters:{},requestHandler:"none",responseHandler:"none"}}function plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function plugin_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_InputControlVisPlugin{constructor(initializerContext){this.initializerContext=initializerContext;plugin_defineProperty(this,"cachedSettings",undefined)}setup(core,{expressions:expressions,visualizations:visualizations,data:data}){var _this=this;const visualizationDependencies={core:core,data:data,getSettings:function(){var _getSettings=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this.cachedSettings){_context.next=4;break}_context.next=3;return core.http.get("/api/input_control_vis/settings");case 3:_this.cachedSettings=_context.sent;case 4:return _context.abrupt("return",_this.cachedSettings);case 5:case"end":return _context.stop()}}),_callee)})));function getSettings(){return _getSettings.apply(this,arguments)}return getSettings}()};expressions.registerFunction(createInputControlVisFn);visualizations.createBaseVisualization(createInputControlVisTypeDefinition(visualizationDependencies))}start(core,deps){}}function public_plugin(initializerContext){return new plugin_InputControlVisPlugin(initializerContext)}}]);