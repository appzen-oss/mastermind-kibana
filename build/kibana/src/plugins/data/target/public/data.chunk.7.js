(window["data_bundle_jsonpfunction"]=window["data_bundle_jsonpfunction"]||[]).push([[7],{248:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return IndexPatternSelect}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);var react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17);var _elastic_eui__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_2__);var _common_index_patterns_lib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(27);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}const getIndexPatterns=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(client,search,fields){var resp;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return client.find({type:"index-pattern",fields:fields,search:"".concat(search,"*"),searchFields:["title"],perPage:100});case 2:resp=_context.sent;return _context.abrupt("return",resp.savedObjects);case 4:case"end":return _context.stop()}}),_callee)})));return function getIndexPatterns(_x,_x2,_x3){return _ref.apply(this,arguments)}}();class IndexPatternSelect extends react__WEBPACK_IMPORTED_MODULE_1__["Component"]{constructor(props){var _this;super(props);_this=this;_defineProperty(this,"isMounted",false);_defineProperty(this,"state",void 0);_defineProperty(this,"fetchSelectedIndexPattern",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(indexPatternId){var indexPatternTitle;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(indexPatternId){_context2.next=3;break}_this.setState({selectedIndexPattern:undefined});return _context2.abrupt("return");case 3:_context2.prev=3;_context2.next=6;return Object(_common_index_patterns_lib__WEBPACK_IMPORTED_MODULE_3__["g"])(_this.props.savedObjectsClient,indexPatternId);case 6:indexPatternTitle=_context2.sent;_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2["catch"](3);return _context2.abrupt("return");case 12:if(_this.isMounted){_context2.next=14;break}return _context2.abrupt("return");case 14:_this.setState({selectedIndexPattern:{value:indexPatternId,label:indexPatternTitle}});case 15:case"end":return _context2.stop()}}),_callee2,null,[[3,9]])})));return function(_x4){return _ref2.apply(this,arguments)}}());_defineProperty(this,"debouncedFetch",lodash__WEBPACK_IMPORTED_MODULE_0___default.a.debounce(function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(searchValue){var _this$props,fieldTypes,onNoIndexPatterns,savedObjectsClient,savedObjectFields,savedObjects,options;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_this$props=_this.props,fieldTypes=_this$props.fieldTypes,onNoIndexPatterns=_this$props.onNoIndexPatterns,savedObjectsClient=_this$props.savedObjectsClient;savedObjectFields=["title"];if(fieldTypes){savedObjectFields.push("fields")}_context3.next=5;return getIndexPatterns(savedObjectsClient,searchValue,savedObjectFields);case 5:savedObjects=_context3.sent;if(fieldTypes){savedObjects=savedObjects.filter(savedObject=>{try{const indexPatternFields=JSON.parse(savedObject.attributes.fields);return indexPatternFields.some(field=>fieldTypes===null||fieldTypes===void 0?void 0:fieldTypes.includes(field.type))}catch(err){return false}})}if(_this.isMounted){_context3.next=9;break}return _context3.abrupt("return");case 9:if(searchValue===_this.state.searchValue){options=savedObjects.map(indexPatternSavedObject=>({label:indexPatternSavedObject.attributes.title,value:indexPatternSavedObject.id}));_this.setState({isLoading:false,options:options});if(onNoIndexPatterns&&searchValue===""&&options.length===0){onNoIndexPatterns()}}case 10:case"end":return _context3.stop()}}),_callee3)})));return function(_x5){return _ref3.apply(this,arguments)}}(),300));_defineProperty(this,"fetchOptions",(searchValue="")=>{this.setState({isLoading:true,searchValue:searchValue},this.debouncedFetch.bind(null,searchValue))});_defineProperty(this,"onChange",selectedOptions=>{this.props.onChange(lodash__WEBPACK_IMPORTED_MODULE_0___default.a.get(selectedOptions,"0.value"))});this.state={isLoading:false,options:[],selectedIndexPattern:undefined,searchValue:undefined}}componentWillUnmount(){this.isMounted=false;this.debouncedFetch.cancel()}componentDidMount(){this.isMounted=true;this.fetchOptions();this.fetchSelectedIndexPattern(this.props.indexPatternId)}UNSAFE_componentWillReceiveProps(nextProps){if(nextProps.indexPatternId!==this.props.indexPatternId){this.fetchSelectedIndexPattern(nextProps.indexPatternId)}}render(){const _this$props2=this.props,fieldTypes=_this$props2.fieldTypes,onChange=_this$props2.onChange,indexPatternId=_this$props2.indexPatternId,placeholder=_this$props2.placeholder,onNoIndexPatterns=_this$props2.onNoIndexPatterns,savedObjectsClient=_this$props2.savedObjectsClient,rest=_objectWithoutProperties(_this$props2,["fieldTypes","onChange","indexPatternId","placeholder","onNoIndexPatterns","savedObjectsClient"]);return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_2__["EuiComboBox"],_extends({},rest,{placeholder:placeholder,singleSelection:true,isLoading:this.state.isLoading,onSearchChange:this.fetchOptions,options:this.state.options,selectedOptions:this.state.selectedIndexPattern?[this.state.selectedIndexPattern]:[],onChange:this.onChange}))}}}}]);