(window["data_bundle_jsonpfunction"]=window["data_bundle_jsonpfunction"]||[]).push([[0],{223:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number"){classes.push(arg)}else if(Array.isArray(arg)&&arg.length){var inner=classNames.apply(null,arg);if(inner){classes.push(inner)}}else if(argType==="object"){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key)}}}}return classes.join(" ")}if(true&&module.exports){classNames.default=classNames;module.exports=classNames}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})()},227:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return query_string_input_QueryStringInputUI}));var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var classnames=__webpack_require__(223);var classnames_default=__webpack_require__.n(classnames);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(17);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(67);var external_kbnSharedDeps_Lodash_=__webpack_require__(2);var autocomplete=__webpack_require__(31);var public_=__webpack_require__(24);var public_0=__webpack_require__(153);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchIndexPatterns(_x,_x2,_x3){return _fetchIndexPatterns.apply(this,arguments)}function _fetchIndexPatterns(){_fetchIndexPatterns=_asyncToGenerator(regeneratorRuntime.mark((function _callee(savedObjectsClient,indexPatternStrings,uiSettings){var searchString,indexPatternsFromSavedObjects,exactMatches,defaultIndex,allMatches;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(!indexPatternStrings||Object(external_kbnSharedDeps_Lodash_["isEmpty"])(indexPatternStrings))){_context.next=2;break}return _context.abrupt("return",[]);case 2:searchString=indexPatternStrings.map(string=>'"'.concat(string,'"')).join(" | ");_context.next=5;return savedObjectsClient.find({type:"index-pattern",fields:["title","fields"],search:searchString,searchFields:["title"]});case 5:indexPatternsFromSavedObjects=_context.sent;exactMatches=indexPatternsFromSavedObjects.savedObjects.filter(savedObject=>indexPatternStrings.includes(savedObject.attributes.title));defaultIndex=uiSettings.get("defaultIndex");if(!(exactMatches.length===indexPatternStrings.length)){_context.next=12;break}_context.t0=exactMatches;_context.next=17;break;case 12:_context.t1=exactMatches;_context.next=15;return savedObjectsClient.get("index-pattern",defaultIndex);case 15:_context.t2=_context.sent;_context.t0=[..._context.t1,_context.t2];case 17:allMatches=_context.t0;return _context.abrupt("return",allMatches.map(public_0["indexPatterns"].getFromSavedObject));case 19:case"end":return _context.stop()}}),_callee)})));return _fetchIndexPatterns.apply(this,arguments)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function QueryLanguageSwitcher(props){const kibana=Object(public_["useKibana"])();const kueryQuerySyntaxDocs=kibana.services.docLinks.links.query.kueryQuerySyntax;const _useState=Object(external_kbnSharedDeps_React_["useState"])(false),_useState2=_slicedToArray(_useState,2),isPopoverOpen=_useState2[0],setIsPopoverOpen=_useState2[1];const luceneLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.luceneLanguageName",defaultMessage:"Lucene"});const kqlLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.kqlLanguageName",defaultMessage:"KQL"});const kqlFullName=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.kqlFullLanguageName",defaultMessage:"Kibana Query Language"});const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:()=>setIsPopoverOpen(!isPopoverOpen),className:"euiFormControlLayout__append kqlQueryBar__languageSwitcherButton","data-test-subj":"switchQueryLanguageButton"},props.language==="lucene"?luceneLabel:kqlLabel);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"queryLanguageSwitcherPopover",anchorClassName:"euiFormControlLayout__append",ownFocus:true,anchorPosition:props.anchorPosition||"downRight",button:button,isOpen:isPopoverOpen,closePopover:()=>setIsPopoverOpen(false),repositionOnScroll:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.syntaxOptionsTitle",defaultMessage:"Syntax options"})),external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"350px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.syntaxOptionsDescription",defaultMessage:"The {docsLink} (KQL) offers a simplified query syntax and support for scripted fields. KQL also provides autocomplete if you have a Basic license or above. If you turn off KQL, Kibana uses Lucene.",values:{docsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:kueryQuerySyntaxDocs,target:"_blank"},kqlFullName)}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:kqlFullName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"queryEnhancementOptIn",name:"popswitch",label:props.language==="kuery"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.kqlOnLabel",defaultMessage:"On"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.kqlOffLabel",defaultMessage:"Off"}),checked:props.language==="kuery",onChange:()=>{const newLanguage=props.language==="lucene"?"kuery":"lucene";props.onSelectLanguage(newLanguage)},"data-test-subj":"languageToggle"})))))}var public_query=__webpack_require__(13);var ui=__webpack_require__(32);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function query_string_input_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function query_string_input_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){query_string_input_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){query_string_input_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const KEY_CODES={LEFT:37,UP:38,RIGHT:39,DOWN:40,ENTER:13,ESC:27,TAB:9,HOME:36,END:35};class query_string_input_QueryStringInputUI extends external_kbnSharedDeps_React_["Component"]{constructor(...args){var _this;super(...args);_this=this;_defineProperty(this,"state",{isSuggestionsVisible:false,index:null,suggestions:[],suggestionLimit:50,selectionStart:null,selectionEnd:null,indexPatterns:[],queryBarRect:undefined});_defineProperty(this,"inputRef",null);_defineProperty(this,"persistedLog",void 0);_defineProperty(this,"abortController",void 0);_defineProperty(this,"fetchIndexPatternsAbortController",void 0);_defineProperty(this,"services",this.props.kibana.services);_defineProperty(this,"componentIsUnmounting",false);_defineProperty(this,"queryBarInputDivRefInstance",Object(external_kbnSharedDeps_React_["createRef"])());_defineProperty(this,"getQueryString",()=>Object(public_query["A"])(this.props.query.query));_defineProperty(this,"fetchIndexPatterns",Object(external_kbnSharedDeps_Lodash_["debounce"])(query_string_input_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var stringPatterns,objectPatterns,currentAbortController,objectPatternsFromStrings;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:stringPatterns=_this.props.indexPatterns.filter(indexPattern=>typeof indexPattern==="string");objectPatterns=_this.props.indexPatterns.filter(indexPattern=>typeof indexPattern!=="string");if(_this.fetchIndexPatternsAbortController)_this.fetchIndexPatternsAbortController.abort();_this.fetchIndexPatternsAbortController=new AbortController;currentAbortController=_this.fetchIndexPatternsAbortController;_context.next=7;return fetchIndexPatterns(_this.services.savedObjects.client,stringPatterns,_this.services.uiSettings);case 7:objectPatternsFromStrings=_context.sent;if(!currentAbortController.signal.aborted){_this.setState({indexPatterns:[...objectPatterns,...objectPatternsFromStrings]});_this.updateSuggestions()}case 9:case"end":return _context.stop()}}),_callee)}))),200));_defineProperty(this,"getSuggestions",query_string_input_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var language,queryString,recentSearchSuggestions,hasQuerySuggestions,indexPatterns,_this$inputRef,selectionStart,selectionEnd,suggestions;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:if(_this.inputRef){_context2.next=2;break}return _context2.abrupt("return");case 2:language=_this.props.query.language;queryString=_this.getQueryString();recentSearchSuggestions=_this.getRecentSearchSuggestions(queryString);hasQuerySuggestions=_this.services.data.autocomplete.hasQuerySuggestions(language);if(!(!hasQuerySuggestions||!Array.isArray(_this.state.indexPatterns)||Object(external_kbnSharedDeps_Lodash_["compact"])(_this.state.indexPatterns).length===0)){_context2.next=8;break}return _context2.abrupt("return",recentSearchSuggestions);case 8:indexPatterns=_this.state.indexPatterns;_this$inputRef=_this.inputRef,selectionStart=_this$inputRef.selectionStart,selectionEnd=_this$inputRef.selectionEnd;if(!(selectionStart===null||selectionEnd===null)){_context2.next=12;break}return _context2.abrupt("return");case 12:_context2.prev=12;if(_this.abortController)_this.abortController.abort();_this.abortController=new AbortController;_context2.next=17;return _this.services.data.autocomplete.getQuerySuggestions({language:language,indexPatterns:indexPatterns,query:queryString,selectionStart:selectionStart,selectionEnd:selectionEnd,signal:_this.abortController.signal});case 17:_context2.t0=_context2.sent;if(_context2.t0){_context2.next=20;break}_context2.t0=[];case 20:suggestions=_context2.t0;return _context2.abrupt("return",[...suggestions,...recentSearchSuggestions]);case 24:_context2.prev=24;_context2.t1=_context2["catch"](12);if(!(_context2.t1.message==="The user aborted a request.")){_context2.next=28;break}return _context2.abrupt("return");case 28:throw _context2.t1;case 29:case"end":return _context2.stop()}}),_callee2,null,[[12,24]])}))));_defineProperty(this,"getRecentSearchSuggestions",query=>{if(!this.persistedLog){return[]}const recentSearches=this.persistedLog.get();const matchingRecentSearches=recentSearches.filter(recentQuery=>{const recentQueryString=typeof recentQuery==="object"?Object(public_query["A"])(recentQuery):recentQuery;return recentQueryString.includes(query)});return matchingRecentSearches.map(recentSearch=>{const text=Object(public_query["A"])(recentSearch);const start=0;const end=query.length;return{type:autocomplete["h"].RecentSearch,text:text,start:start,end:end}})});_defineProperty(this,"updateSuggestions",Object(external_kbnSharedDeps_Lodash_["debounce"])(query_string_input_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var suggestions;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _this.getSuggestions();case 2:_context3.t0=_context3.sent;if(_context3.t0){_context3.next=5;break}_context3.t0=[];case 5:suggestions=_context3.t0;if(!_this.componentIsUnmounting){_this.setState({suggestions:suggestions})}case 7:case"end":return _context3.stop()}}),_callee3)}))),100));_defineProperty(this,"onSubmit",query=>{if(this.props.onSubmit){if(this.persistedLog){this.persistedLog.add(query.query)}this.props.onSubmit({query:Object(public_query["s"])(query.query),language:query.language})}});_defineProperty(this,"onChange",query=>{this.updateSuggestions();if(this.props.onChange){this.props.onChange({query:Object(public_query["s"])(query.query),language:query.language})}});_defineProperty(this,"onQueryStringChange",value=>{this.setState({isSuggestionsVisible:true,index:null,suggestionLimit:50});this.onChange({query:value,language:this.props.query.language})});_defineProperty(this,"onInputChange",event=>{this.onQueryStringChange(event.target.value);if(event.target.value===""){this.handleRemoveHeight()}else{this.handleAutoHeight()}});_defineProperty(this,"onClickInput",event=>{if(event.target instanceof HTMLTextAreaElement){this.onQueryStringChange(event.target.value)}});_defineProperty(this,"onKeyUp",event=>{if([KEY_CODES.LEFT,KEY_CODES.RIGHT,KEY_CODES.HOME,KEY_CODES.END].includes(event.keyCode)){this.setState({isSuggestionsVisible:true});if(event.target instanceof HTMLTextAreaElement){this.onQueryStringChange(event.target.value)}}});_defineProperty(this,"onKeyDown",event=>{if(event.target instanceof HTMLTextAreaElement){const _this$state=this.state,isSuggestionsVisible=_this$state.isSuggestionsVisible,index=_this$state.index;const preventDefault=event.preventDefault.bind(event);const target=event.target,key=event.key,metaKey=event.metaKey;const value=target.value,selectionStart=target.selectionStart,selectionEnd=target.selectionEnd;const updateQuery=(query,newSelectionStart,newSelectionEnd)=>{this.onQueryStringChange(query);this.setState({selectionStart:newSelectionStart,selectionEnd:newSelectionEnd})};switch(event.keyCode){case KEY_CODES.DOWN:if(isSuggestionsVisible&&index!==null){event.preventDefault();this.incrementIndex(index)}else if(isSuggestionsVisible&&index==null||this.getQueryString()===""){event.preventDefault();this.setState({isSuggestionsVisible:true,index:0})}break;case KEY_CODES.UP:if(isSuggestionsVisible&&index!==null){event.preventDefault();this.decrementIndex(index)}break;case KEY_CODES.ENTER:if(!this.props.bubbleSubmitEvent){event.preventDefault()}if(isSuggestionsVisible&&index!==null&&this.state.suggestions[index]){event.preventDefault();this.selectSuggestion(this.state.suggestions[index])}else{this.onSubmit(this.props.query);this.setState({isSuggestionsVisible:false})}break;case KEY_CODES.ESC:event.preventDefault();this.setState({isSuggestionsVisible:false,index:null});break;case KEY_CODES.TAB:this.setState({isSuggestionsVisible:false,index:null});break;default:if(selectionStart!==null&&selectionEnd!==null){Object(public_query["x"])({value:value,selectionStart:selectionStart,selectionEnd:selectionEnd,key:key,metaKey:metaKey,updateQuery:updateQuery,preventDefault:preventDefault})}break}}});_defineProperty(this,"selectSuggestion",suggestion=>{if(!this.inputRef){return}const type=suggestion.type,text=suggestion.text,start=suggestion.start,end=suggestion.end,cursorIndex=suggestion.cursorIndex;this.handleNestedFieldSyntaxNotification(suggestion);const query=this.getQueryString();const _this$inputRef2=this.inputRef,selectionStart=_this$inputRef2.selectionStart,selectionEnd=_this$inputRef2.selectionEnd;if(selectionStart===null||selectionEnd===null){return}const value=query.substr(0,selectionStart)+query.substr(selectionEnd);const newQueryString=value.substr(0,start)+text+value.substr(end);this.onQueryStringChange(newQueryString);this.setState({selectionStart:start+(cursorIndex?cursorIndex:text.length),selectionEnd:start+(cursorIndex?cursorIndex:text.length)});if(type===autocomplete["h"].RecentSearch){this.setState({isSuggestionsVisible:false,index:null});this.onSubmit({query:newQueryString,language:this.props.query.language})}});_defineProperty(this,"handleNestedFieldSyntaxNotification",suggestion=>{if("field"in suggestion&&suggestion.field.subType&&suggestion.field.subType.nested&&!this.services.storage.get("kibana.KQLNestedQuerySyntaxInfoOptOut")){const _this$services=this.services,notifications=_this$services.notifications,docLinks=_this$services.docLinks;const onKQLNestedQuerySyntaxInfoOptOut=toast=>{if(!this.services.storage)return;this.services.storage.set("kibana.KQLNestedQuerySyntaxInfoOptOut",true);notifications.toasts.remove(toast)};if(notifications&&docLinks){const toast=notifications.toasts.add({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.KQLNestedQuerySyntaxInfoTitle",{defaultMessage:"KQL nested query syntax"}),text:Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoText",defaultMessage:"It looks like you're querying on a nested field. You can construct KQL syntax for nested queries in different ways, depending on the results you want. Learn more in our {link}.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docLinks.links.query.kueryQuerySyntax,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoDocLinkText",defaultMessage:"docs"}))}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:()=>onKQLNestedQuerySyntaxInfoOptOut(toast)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.KQLNestedQuerySyntaxInfoOptOutText",defaultMessage:"Don't show again"}))))))})}}});_defineProperty(this,"increaseLimit",()=>{this.setState({suggestionLimit:this.state.suggestionLimit+50})});_defineProperty(this,"incrementIndex",currentIndex=>{let nextIndex=currentIndex+1;if(currentIndex===null||nextIndex>=this.state.suggestions.length){nextIndex=0}this.setState({index:nextIndex})});_defineProperty(this,"decrementIndex",currentIndex=>{const previousIndex=currentIndex-1;if(previousIndex<0){this.setState({index:this.state.suggestions.length-1})}else{this.setState({index:previousIndex})}});_defineProperty(this,"onSelectLanguage",language=>{this.services.http.post("/api/kibana/kql_opt_in_stats",{body:JSON.stringify({opt_in:language==="kuery"})});this.services.storage.set("kibana.userQueryLanguage",language);const newQuery={query:"",language:language};this.onChange(newQuery);this.onSubmit(newQuery)});_defineProperty(this,"onOutsideClick",()=>{if(this.state.isSuggestionsVisible){this.setState({isSuggestionsVisible:false,index:null})}this.handleBlurHeight();if(this.props.onChangeQueryInputFocus){this.props.onChangeQueryInputFocus(false)}});_defineProperty(this,"onInputBlur",()=>{this.handleBlurHeight();if(this.props.onChangeQueryInputFocus){this.props.onChangeQueryInputFocus(false)}if(Object(external_kbnSharedDeps_Lodash_["isFunction"])(this.props.onBlur)){this.props.onBlur()}});_defineProperty(this,"onClickSuggestion",suggestion=>{if(!this.inputRef){return}this.selectSuggestion(suggestion);this.inputRef.focus()});_defineProperty(this,"initPersistedLog",()=>{const _this$services2=this.services,uiSettings=_this$services2.uiSettings,storage=_this$services2.storage,appName=_this$services2.appName;this.persistedLog=this.props.persistedLog?this.props.persistedLog:Object(public_query["v"])(uiSettings,storage,appName,this.props.query.language)});_defineProperty(this,"onMouseEnterSuggestion",index=>{this.setState({index:index})});_defineProperty(this,"textareaId",Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])()());_defineProperty(this,"handleListUpdate",()=>{var _this$queryBarInputDi;if(this.componentIsUnmounting)return;return this.setState({queryBarRect:(_this$queryBarInputDi=this.queryBarInputDivRefInstance.current)===null||_this$queryBarInputDi===void 0?void 0:_this$queryBarInputDi.getBoundingClientRect()})});_defineProperty(this,"handleAutoHeight",()=>{if(this.inputRef!==null&&document.activeElement===this.inputRef){this.inputRef.style.setProperty("height","".concat(this.inputRef.scrollHeight,"px"),"important")}this.handleListUpdate()});_defineProperty(this,"handleRemoveHeight",()=>{if(this.inputRef!==null){this.inputRef.style.removeProperty("height")}});_defineProperty(this,"handleBlurHeight",()=>{if(this.inputRef!==null){this.handleRemoveHeight();this.inputRef.scrollTop=0}});_defineProperty(this,"handleOnFocus",()=>{if(this.props.onChangeQueryInputFocus){this.props.onChangeQueryInputFocus(true)}requestAnimationFrame(()=>{this.handleAutoHeight()})})}componentDidMount(){const parsedQuery=Object(public_query["s"])(Object(public_query["A"])(this.props.query.query));if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.props.query.query,parsedQuery)){this.onChange(_objectSpread(_objectSpread({},this.props.query),{},{query:parsedQuery}))}this.initPersistedLog();this.fetchIndexPatterns();this.handleListUpdate();window.addEventListener("resize",this.handleAutoHeight);window.addEventListener("scroll",this.handleListUpdate,{passive:true,capture:true})}componentDidUpdate(prevProps){const parsedQuery=Object(public_query["s"])(Object(public_query["A"])(this.props.query.query));if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.props.query.query,parsedQuery)){this.onChange(_objectSpread(_objectSpread({},this.props.query),{},{query:parsedQuery}))}this.initPersistedLog();if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(prevProps.indexPatterns,this.props.indexPatterns)){this.fetchIndexPatterns()}else if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(prevProps.query,this.props.query)){this.updateSuggestions()}if(this.state.selectionStart!==null&&this.state.selectionEnd!==null){if(this.inputRef!=null){this.inputRef.setSelectionRange(this.state.selectionStart,this.state.selectionEnd)}this.setState({selectionStart:null,selectionEnd:null});if(document.activeElement!==null&&document.activeElement.id===this.textareaId){this.handleAutoHeight()}else{this.handleRemoveHeight()}}}componentWillUnmount(){if(this.abortController)this.abortController.abort();if(this.updateSuggestions.cancel)this.updateSuggestions.cancel();this.componentIsUnmounting=true;window.removeEventListener("resize",this.handleAutoHeight);window.removeEventListener("scroll",this.handleListUpdate,{capture:true})}render(){const isSuggestionsVisible=this.state.isSuggestionsVisible&&{"aria-controls":"kbnTypeahead__items","aria-owns":"kbnTypeahead__items"};const ariaCombobox=_objectSpread(_objectSpread({},isSuggestionsVisible),{},{role:"combobox"});const containerClassName=classnames_default()("euiFormControlLayout euiFormControlLayout--group kbnQueryBar__wrap",this.props.className);const inputClassName=classnames_default()("kbnQueryBar__textarea",this.props.iconType?"kbnQueryBar__textarea--withIcon":null);return external_kbnSharedDeps_React_default.a.createElement("div",{className:containerClassName},this.props.prepend,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOutsideClickDetector"],{onOutsideClick:this.onOutsideClick},external_kbnSharedDeps_React_default.a.createElement("div",_extends({},ariaCombobox,{style:{position:"relative",width:"100%"},"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.comboboxAriaLabel",{defaultMessage:"Search and filter the {pageType} page",values:{pageType:this.services.appName}}),"aria-haspopup":"true","aria-expanded":this.state.isSuggestionsVisible,"data-skip-axe":"aria-required-children"}),external_kbnSharedDeps_React_default.a.createElement("div",{role:"search",className:"euiFormControlLayout__childrenWrapper kbnQueryBar__textareaWrap",ref:this.queryBarInputDivRefInstance},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{placeholder:this.props.placeholder||external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.searchInputPlaceholder",{defaultMessage:"Search"}),value:this.getQueryString(),onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onChange:this.onInputChange,onClick:this.onClickInput,onBlur:this.onInputBlur,onFocus:this.handleOnFocus,className:inputClassName,fullWidth:true,rows:1,id:this.textareaId,autoFocus:this.props.onChangeQueryInputFocus?false:!this.props.disableAutoFocus,inputRef:node=>{if(node){this.inputRef=node}},autoComplete:"off",spellCheck:false,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.searchInputAriaLabel",{defaultMessage:"Start typing to search and filter the {pageType} page",values:{pageType:this.services.appName}}),"aria-autocomplete":"list","aria-controls":this.state.isSuggestionsVisible?"kbnTypeahead__items":undefined,"aria-activedescendant":this.state.isSuggestionsVisible&&typeof this.state.index==="number"?"suggestion-".concat(this.state.index):undefined,role:"textbox","data-test-subj":this.props.dataTestSubj||"queryInput",isInvalid:this.props.isInvalid},this.getQueryString()),this.props.iconType?external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiFormControlLayoutIcons"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{className:"euiFormControlLayoutCustomIcon__icon","aria-hidden":"true",type:"search"})):null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPortal"],null,external_kbnSharedDeps_React_default.a.createElement(ui["h"],{show:this.state.isSuggestionsVisible,suggestions:this.state.suggestions.slice(0,this.state.suggestionLimit),index:this.state.index,onClick:this.onClickSuggestion,onMouseEnter:this.onMouseEnterSuggestion,loadMore:this.increaseLimit,queryBarRect:this.state.queryBarRect,size:this.props.size})))),this.props.disableLanguageSwitcher?null:external_kbnSharedDeps_React_default.a.createElement(QueryLanguageSwitcher,{language:this.props.query.language,anchorPosition:this.props.languageSwitcherPopoverAnchorPosition,onSelectLanguage:this.onSelectLanguage}))}}}}]);