/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["stackAlerts_bundle_jsonpfunction"]=window["stackAlerts_bundle_jsonpfunction"]||[]).push([[2],{26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"GeoThresholdAlertTypeExpression",(function(){return GeoThresholdAlertTypeExpression}));__webpack_require__.d(__webpack_exports__,"default",(function(){return GeoThresholdAlertTypeExpression}));var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(6);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(7);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var public_=__webpack_require__(1);let TrackingEvent;(function(TrackingEvent){TrackingEvent["entered"]="entered";TrackingEvent["exited"]="exited";TrackingEvent["crossed"]="crossed"})(TrackingEvent||(TrackingEvent={}));const ES_GEO_FIELD_TYPES=["geo_point"];const ES_GEO_SHAPE_TYPES=["geo_shape"];function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const ExpressionWithPopover=({popoverContent:popoverContent,expressionDescription:expressionDescription,defaultValue:defaultValue,value:value,isInvalid:isInvalid})=>{const _useState=Object(external_kbnSharedDeps_React_["useState"])(false),_useState2=_slicedToArray(_useState,2),popoverOpen=_useState2[0],setPopoverOpen=_useState2[1];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"popoverForExpression",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{display:"columns","data-test-subj":"selectIndexExpression",description:expressionDescription,value:value||defaultValue,isActive:popoverOpen,onClick:()=>setPopoverOpen(true),isInvalid:isInvalid}),isOpen:popoverOpen,closePopover:()=>setPopoverOpen(false),ownFocus:true,anchorPosition:"downLeft",zIndex:8e3,display:"block"},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"450px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,expressionDescription),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"data-test-subj":"closePopover",iconType:"cross",color:"danger","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.ui.expressionPopover.closePopoverLabel",{defaultMessage:"Close"}),onClick:()=>setPopoverOpen(false)})))),popoverContent))};function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class geo_index_pattern_select_GeoIndexPatternSelect extends external_kbnSharedDeps_React_["Component"]{constructor(...args){var _this;super(...args);_this=this;_defineProperty(this,"_isMounted",false);_defineProperty(this,"state",{noGeoIndexPatternsExist:false});_defineProperty(this,"_onIndexPatternSelect",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(indexPatternId){var indexPattern;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(!indexPatternId||indexPatternId.length===0||!_this.props.indexPatternService)){_context.next=2;break}return _context.abrupt("return");case 2:_context.prev=2;_context.next=5;return _this.props.indexPatternService.get(indexPatternId);case 5:indexPattern=_context.sent;_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](2);return _context.abrupt("return");case 11:if(_this._isMounted&&indexPattern.id===indexPatternId){_this.props.onChange(indexPattern)}case 12:case"end":return _context.stop()}}),_callee,null,[[2,8]])})));return function(_x){return _ref.apply(this,arguments)}}());_defineProperty(this,"_onNoIndexPatterns",()=>{this.setState({noGeoIndexPatternsExist:true})})}componentWillUnmount(){this._isMounted=false}componentDidMount(){this._isMounted=true}_renderNoIndexPatternWarning(){if(!this.state.noGeoIndexPatternsExist){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.noIndexPattern.messageTitle",{defaultMessage:"Couldn't find any index patterns with geospatial fields"}),color:"warning"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.noIndexPattern.doThisPrefixDescription",defaultMessage:"You'll need to "}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:this.props.http.basePath.prepend("/app/management/kibana/indexPatterns")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.noIndexPattern.doThisLinkTextDescription",defaultMessage:"create an index pattern"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.noIndexPattern.doThisSuffixDescription",defaultMessage:" with geospatial fields."})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.noIndexPattern.hintDescription",defaultMessage:"Don't have any geospatial data sets? "}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:this.props.http.basePath.prepend("/app/home#/tutorial_directory/sampleData")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.noIndexPattern.getStartedLinkText",defaultMessage:"Get started with some sample data sets."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))}render(){const IndexPatternSelectComponent=this.props.IndexPatternSelectComponent;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,this._renderNoIndexPatternWarning(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.indexPatternSelectLabel",{defaultMessage:"Index pattern"})},IndexPatternSelectComponent?external_kbnSharedDeps_React_default.a.createElement(IndexPatternSelectComponent,{isDisabled:this.state.noGeoIndexPatternsExist,indexPatternId:this.props.value,onChange:this._onIndexPatternSelect,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.indexPatternSelectPlaceholder",{defaultMessage:"Select index pattern"}),fieldTypes:this.props.includedGeoTypes,onNoIndexPatterns:this._onNoIndexPatterns,isClearable:false}):external_kbnSharedDeps_React_default.a.createElement("div",null)))}}var external_kbnSharedDeps_Lodash_=__webpack_require__(8);var external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);var kibanaReact_public_=__webpack_require__(9);function fieldsToOptions(fields){if(!fields){return[]}return fields.map(field=>({value:field,label:field.name})).sort((a,b)=>a.label.toLowerCase().localeCompare(b.label.toLowerCase()))}function SingleFieldSelect({placeholder:placeholder,value:value,onChange:onChange,fields:fields}){function renderOption(option,searchValue,contentClassName){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:contentClassName,gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:null},external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_["FieldIcon"],{type:option.value.type,fill:"none"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHighlight"],{search:searchValue},option.label)))}const onSelection=selectedOptions=>{onChange(external_kbnSharedDeps_Lodash_default.a.get(selectedOptions,"0.value.name"))};const selectedOptions=[];if(value&&fields){const selectedField=fields.find(field=>field.name===value);if(selectedField){selectedOptions.push({value:selectedField,label:value})}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:true,options:fieldsToOptions(fields),selectedOptions:selectedOptions,onChange:onSelection,isDisabled:!fields,renderOption:renderOption,isClearable:false,placeholder:placeholder,compressed:true})}const EntityIndexExpression=({setAlertParamsDate:setAlertParamsDate,setAlertParamsGeoField:setAlertParamsGeoField,errors:errors,alertsContext:alertsContext,setIndexPattern:setIndexPattern,indexPattern:indexPattern,isInvalid:isInvalid,dateField:timeField,geoField:geoField})=>{const dataUi=alertsContext.dataUi,dataIndexPatterns=alertsContext.dataIndexPatterns,http=alertsContext.http;const IndexPatternSelect=dataUi&&dataUi.IndexPatternSelect||null;const usePrevious=value=>{const ref=Object(external_kbnSharedDeps_React_["useRef"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{ref.current=value});return ref.current};const oldIndexPattern=usePrevious(indexPattern);const fields=Object(external_kbnSharedDeps_React_["useRef"])({dateFields:[],geoFields:[]});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(oldIndexPattern!==indexPattern){fields.current.geoFields=indexPattern.fields.length&&indexPattern.fields.filter(field=>ES_GEO_FIELD_TYPES.includes(field.type))||[];if(fields.current.geoFields.length){setAlertParamsGeoField(fields.current.geoFields[0].name)}fields.current.dateFields=indexPattern.fields.length&&indexPattern.fields.filter(field=>field.type==="date")||[];if(fields.current.dateFields.length){setAlertParamsDate(fields.current.dateFields[0].name)}}},[indexPattern,oldIndexPattern,setAlertParamsDate,setAlertParamsGeoField]);const indexPopover=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"geoIndexPatternSelect",fullWidth:true,error:errors.index},external_kbnSharedDeps_React_default.a.createElement(geo_index_pattern_select_GeoIndexPatternSelect,{onChange:_indexPattern=>{if(!_indexPattern){return}setIndexPattern(_indexPattern)},value:indexPattern.id,IndexPatternSelectComponent:IndexPatternSelect,indexPatternService:dataIndexPatterns,http:http,includedGeoTypes:ES_GEO_FIELD_TYPES})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"thresholdTimeField",fullWidth:true,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.timeFieldLabel",defaultMessage:"Time field"})},external_kbnSharedDeps_React_default.a.createElement(SingleFieldSelect,{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.selectTimeLabel",{defaultMessage:"Select time field"}),value:timeField,onChange:_timeField=>_timeField&&setAlertParamsDate(_timeField),fields:fields.current.dateFields})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"geoField",fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.geofieldLabel",{defaultMessage:"Geospatial field"})},external_kbnSharedDeps_React_default.a.createElement(SingleFieldSelect,{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.selectGeoLabel",{defaultMessage:"Select geo field"}),value:geoField,onChange:_geoField=>_geoField&&setAlertParamsGeoField(_geoField),fields:fields.current.geoFields})));return external_kbnSharedDeps_React_default.a.createElement(ExpressionWithPopover,{isInvalid:isInvalid,value:indexPattern.title,defaultValue:"Select an index pattern and geo shape/point field",popoverContent:indexPopover,expressionDescription:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.entityIndexLabel",{defaultMessage:"index"})})};const EntityByExpression=({errors:errors,entity:entity,setAlertParamsEntity:setAlertParamsEntity,indexFields:indexFields,isInvalid:isInvalid})=>{const ENTITY_TYPES=["string","number","ip"];const usePrevious=value=>{const ref=Object(external_kbnSharedDeps_React_["useRef"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{ref.current=value});return ref.current};const oldIndexFields=usePrevious(indexFields);const fields=Object(external_kbnSharedDeps_React_["useRef"])({indexFields:[]});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(!external_kbnSharedDeps_Lodash_default.a.isEqual(oldIndexFields,indexFields)){fields.current.indexFields=indexFields.filter(field=>ENTITY_TYPES.includes(field.type)&&!field.name.startsWith("_"));if(!entity&&fields.current.indexFields.length){setAlertParamsEntity(fields.current.indexFields[0].name)}}},[ENTITY_TYPES,indexFields,oldIndexFields,setAlertParamsEntity,entity]);const indexPopover=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"entitySelect",fullWidth:true,error:errors.index},external_kbnSharedDeps_React_default.a.createElement(SingleFieldSelect,{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.topHitsSplitFieldSelectPlaceholder",{defaultMessage:"Select entity field"}),value:entity,onChange:_entity=>_entity&&setAlertParamsEntity(_entity),fields:fields.current.indexFields}));return external_kbnSharedDeps_React_default.a.createElement(ExpressionWithPopover,{isInvalid:isInvalid,value:entity,defaultValue:"Select entity field",popoverContent:indexPopover,expressionDescription:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.entityByLabel",{defaultMessage:"by"})})};const BoundaryIndexExpression=({alertParams:alertParams,alertsContext:alertsContext,errors:errors,boundaryIndexPattern:boundaryIndexPattern,boundaryNameField:boundaryNameField,setBoundaryIndexPattern:setBoundaryIndexPattern,setBoundaryGeoField:setBoundaryGeoField,setBoundaryNameField:setBoundaryNameField})=>{const BOUNDARY_NAME_ENTITY_TYPES=["string","number","ip"];const dataUi=alertsContext.dataUi,dataIndexPatterns=alertsContext.dataIndexPatterns,http=alertsContext.http;const IndexPatternSelect=dataUi&&dataUi.IndexPatternSelect||null;const boundaryGeoField=alertParams.boundaryGeoField;const nothingSelected={name:"<nothing selected>",type:"string"};const usePrevious=value=>{const ref=Object(external_kbnSharedDeps_React_["useRef"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{ref.current=value});return ref.current};const oldIndexPattern=usePrevious(boundaryIndexPattern);const fields=Object(external_kbnSharedDeps_React_["useRef"])({geoFields:[],boundaryNameFields:[]});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(oldIndexPattern!==boundaryIndexPattern){fields.current.geoFields=boundaryIndexPattern.fields.length&&boundaryIndexPattern.fields.filter(field=>ES_GEO_SHAPE_TYPES.includes(field.type))||[];if(fields.current.geoFields.length){setBoundaryGeoField(fields.current.geoFields[0].name)}fields.current.boundaryNameFields=[...boundaryIndexPattern.fields.filter(field=>BOUNDARY_NAME_ENTITY_TYPES.includes(field.type)&&!field.name.startsWith("_")&&!field.name.endsWith("keyword")),nothingSelected];if(fields.current.boundaryNameFields.length){setBoundaryNameField(fields.current.boundaryNameFields[0].name)}}},[BOUNDARY_NAME_ENTITY_TYPES,boundaryIndexPattern,nothingSelected,oldIndexPattern,setBoundaryGeoField,setBoundaryNameField]);const indexPopover=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"geoIndexPatternSelect",fullWidth:true,error:errors.index},external_kbnSharedDeps_React_default.a.createElement(geo_index_pattern_select_GeoIndexPatternSelect,{onChange:_indexPattern=>{if(!_indexPattern){return}setBoundaryIndexPattern(_indexPattern)},value:boundaryIndexPattern.id,IndexPatternSelectComponent:IndexPatternSelect,indexPatternService:dataIndexPatterns,http:http,includedGeoTypes:ES_GEO_SHAPE_TYPES})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"geoField",fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.geofieldLabel",{defaultMessage:"Geospatial field"})},external_kbnSharedDeps_React_default.a.createElement(SingleFieldSelect,{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.selectLabel",{defaultMessage:"Select geo field"}),value:boundaryGeoField,onChange:setBoundaryGeoField,fields:fields.current.geoFields})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"boundaryNameFieldSelect",fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.boundaryNameSelectLabel",{defaultMessage:"Human-readable boundary name (optional)"})},external_kbnSharedDeps_React_default.a.createElement(SingleFieldSelect,{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.boundaryNameSelect",{defaultMessage:"Select boundary name"}),value:boundaryNameField||null,onChange:name=>{setBoundaryNameField(name===nothingSelected.name?undefined:name)},fields:fields.current.boundaryNameFields})));return external_kbnSharedDeps_React_default.a.createElement(ExpressionWithPopover,{defaultValue:"Select an index pattern and geo shape field",value:boundaryIndexPattern.title,popoverContent:indexPopover,expressionDescription:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.indexLabel",{defaultMessage:"index"})})};var data_public_=__webpack_require__(10);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){query_builder_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function query_builder_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function query_builder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function query_builder_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){query_builder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){query_builder_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function query_builder_slicedToArray(arr,i){return query_builder_arrayWithHoles(arr)||query_builder_iterableToArrayLimit(arr,i)||query_builder_unsupportedIterableToArray(arr,i)||query_builder_nonIterableRest()}function query_builder_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function query_builder_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return query_builder_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return query_builder_arrayLikeToArray(o,minLen)}function query_builder_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function query_builder_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function query_builder_arrayWithHoles(arr){if(Array.isArray(arr))return arr}const DEFAULT_VALUES={TRACKING_EVENT:"",ENTITY:"",INDEX:"",INDEX_ID:"",DATE_FIELD:"",BOUNDARY_TYPE:"entireIndex",GEO_FIELD:"",BOUNDARY_INDEX:"",BOUNDARY_INDEX_ID:"",BOUNDARY_GEO_FIELD:"",BOUNDARY_NAME_FIELD:"",DELAY_OFFSET_WITH_UNITS:"0m"};const conditionOptions=Object.keys(TrackingEvent).map(key=>({text:TrackingEvent[key],value:TrackingEvent[key]}));const labelForDelayOffset=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.delayOffset",defaultMessage:"Delayed evaluation offset"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{position:"right",type:"questionInCircle",content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.delayOffsetTooltip",{defaultMessage:"Evaluate alerts on a delayed cycle to adjust for data latency"})}));function validateQuery(query){try{query.language==="kuery"?data_public_["esKuery"].fromKueryExpression(query.query):data_public_["esQuery"].luceneStringToDsl(query.query)}catch(err){return false}return true}const GeoThresholdAlertTypeExpression=({alertParams:alertParams,alertInterval:alertInterval,setAlertParams:setAlertParams,setAlertProperty:setAlertProperty,errors:errors,alertsContext:alertsContext})=>{var _alertInterval;const index=alertParams.index,indexId=alertParams.indexId,indexQuery=alertParams.indexQuery,geoField=alertParams.geoField,entity=alertParams.entity,dateField=alertParams.dateField,trackingEvent=alertParams.trackingEvent,boundaryType=alertParams.boundaryType,boundaryIndexTitle=alertParams.boundaryIndexTitle,boundaryIndexId=alertParams.boundaryIndexId,boundaryIndexQuery=alertParams.boundaryIndexQuery,boundaryGeoField=alertParams.boundaryGeoField,boundaryNameField=alertParams.boundaryNameField,delayOffsetWithUnits=alertParams.delayOffsetWithUnits;const _useState=Object(external_kbnSharedDeps_React_["useState"])({id:"",fields:[],title:""}),_useState2=query_builder_slicedToArray(_useState,2),indexPattern=_useState2[0],_setIndexPattern=_useState2[1];const setIndexPattern=_indexPattern=>{if(_indexPattern){_setIndexPattern(_indexPattern);if(_indexPattern.title){setAlertParams("index",_indexPattern.title)}if(_indexPattern.id){setAlertParams("indexId",_indexPattern.id)}}};const _useState3=Object(external_kbnSharedDeps_React_["useState"])(indexQuery||{query:"",language:"kuery"}),_useState4=query_builder_slicedToArray(_useState3,2),indexQueryInput=_useState4[0],setIndexQueryInput=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])({id:"",fields:[],title:""}),_useState6=query_builder_slicedToArray(_useState5,2),boundaryIndexPattern=_useState6[0],_setBoundaryIndexPattern=_useState6[1];const setBoundaryIndexPattern=_indexPattern=>{if(_indexPattern){_setBoundaryIndexPattern(_indexPattern);if(_indexPattern.title){setAlertParams("boundaryIndexTitle",_indexPattern.title)}if(_indexPattern.id){setAlertParams("boundaryIndexId",_indexPattern.id)}}};const _useState7=Object(external_kbnSharedDeps_React_["useState"])(boundaryIndexQuery||{query:"",language:"kuery"}),_useState8=query_builder_slicedToArray(_useState7,2),boundaryIndexQueryInput=_useState8[0],setBoundaryIndexQueryInput=_useState8[1];const _useState9=Object(external_kbnSharedDeps_React_["useState"])(0),_useState10=query_builder_slicedToArray(_useState9,2),delayOffset=_useState10[0],_setDelayOffset=_useState10[1];function setDelayOffset(_delayOffset){setAlertParams("delayOffsetWithUnits","".concat(_delayOffset).concat(delayOffsetUnit));_setDelayOffset(_delayOffset)}const _useState11=Object(external_kbnSharedDeps_React_["useState"])("m"),_useState12=query_builder_slicedToArray(_useState11,2),delayOffsetUnit=_useState12[0],setDelayOffsetUnit=_useState12[1];const hasExpressionErrors=false;const expressionErrorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.fixErrorInExpressionBelowValidationMessage",{defaultMessage:"Expression contains errors."});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const initToDefaultParams=function(){var _ref=query_builder_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var _indexPattern,_boundaryIndexPattern;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setAlertProperty("params",_objectSpread(_objectSpread({},alertParams),{},{index:index!==null&&index!==void 0?index:DEFAULT_VALUES.INDEX,indexId:indexId!==null&&indexId!==void 0?indexId:DEFAULT_VALUES.INDEX_ID,entity:entity!==null&&entity!==void 0?entity:DEFAULT_VALUES.ENTITY,dateField:dateField!==null&&dateField!==void 0?dateField:DEFAULT_VALUES.DATE_FIELD,trackingEvent:trackingEvent!==null&&trackingEvent!==void 0?trackingEvent:DEFAULT_VALUES.TRACKING_EVENT,boundaryType:boundaryType!==null&&boundaryType!==void 0?boundaryType:DEFAULT_VALUES.BOUNDARY_TYPE,geoField:geoField!==null&&geoField!==void 0?geoField:DEFAULT_VALUES.GEO_FIELD,boundaryIndexTitle:boundaryIndexTitle!==null&&boundaryIndexTitle!==void 0?boundaryIndexTitle:DEFAULT_VALUES.BOUNDARY_INDEX,boundaryIndexId:boundaryIndexId!==null&&boundaryIndexId!==void 0?boundaryIndexId:DEFAULT_VALUES.BOUNDARY_INDEX_ID,boundaryGeoField:boundaryGeoField!==null&&boundaryGeoField!==void 0?boundaryGeoField:DEFAULT_VALUES.BOUNDARY_GEO_FIELD,boundaryNameField:boundaryNameField!==null&&boundaryNameField!==void 0?boundaryNameField:DEFAULT_VALUES.BOUNDARY_NAME_FIELD,delayOffsetWithUnits:delayOffsetWithUnits!==null&&delayOffsetWithUnits!==void 0?delayOffsetWithUnits:DEFAULT_VALUES.DELAY_OFFSET_WITH_UNITS}));if(alertsContext.dataIndexPatterns){_context.next=3;break}return _context.abrupt("return");case 3:if(!indexId){_context.next=8;break}_context.next=6;return alertsContext.dataIndexPatterns.get(indexId);case 6:_indexPattern=_context.sent;setIndexPattern(_indexPattern);case 8:if(!boundaryIndexId){_context.next=13;break}_context.next=11;return alertsContext.dataIndexPatterns.get(boundaryIndexId);case 11:_boundaryIndexPattern=_context.sent;setBoundaryIndexPattern(_boundaryIndexPattern);case 13:if(delayOffsetWithUnits){setDelayOffset(+delayOffsetWithUnits.replace(/\D/g,""))}case 14:case"end":return _context.stop()}}),_callee)})));return function initToDefaultParams(){return _ref.apply(this,arguments)}}();initToDefaultParams()},[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,hasExpressionErrors?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger",size:"s",title:expressionErrorMessage}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null)):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.selectOffset",defaultMessage:"Select offset (optional)"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,display:"rowCompressed",label:labelForDelayOffset},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{fullWidth:true,min:0,compressed:true,value:delayOffset||0,name:"delayOffset",onChange:e=>{setDelayOffset(+e.target.value)}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{fullWidth:true,compressed:true,value:delayOffsetUnit,options:Object(public_["getTimeOptions"])((_alertInterval=+alertInterval)!==null&&_alertInterval!==void 0?_alertInterval:1),onChange:e=>{setDelayOffsetUnit(e.target.value)}})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.selectEntity",defaultMessage:"Select entity"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(EntityIndexExpression,{dateField:dateField,geoField:geoField,alertsContext:alertsContext,errors:errors,setAlertParamsDate:_date=>setAlertParams("dateField",_date),setAlertParamsGeoField:_geoField=>setAlertParams("geoField",_geoField),setAlertProperty:setAlertProperty,setIndexPattern:setIndexPattern,indexPattern:indexPattern,isInvalid:!indexId||!dateField||!geoField}),external_kbnSharedDeps_React_default.a.createElement(EntityByExpression,{errors:errors,entity:entity,setAlertParamsEntity:entityName=>setAlertParams("entity",entityName),indexFields:indexPattern.fields,isInvalid:indexId&&dateField&&geoField?!entity:false}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(data_public_["QueryStringInput"],{disableAutoFocus:true,bubbleSubmitEvent:true,indexPatterns:indexPattern?[indexPattern]:[],query:indexQueryInput,onChange:query=>{if(query.language){if(validateQuery(query)){setAlertParams("indexQuery",query)}setIndexQueryInput(query)}}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.selectIndex",defaultMessage:"Define the condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ExpressionWithPopover,{isInvalid:entity?!trackingEvent:false,defaultValue:"Select crossing option",value:trackingEvent,popoverContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{id:"someSelect",fullWidth:true,error:errors.index},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"data-test-subj":"whenExpressionSelect",value:trackingEvent&&trackingEvent||entity&&setAlertParams("trackingEvent",conditionOptions[0].text)&&conditionOptions[0].text||undefined,fullWidth:true,onChange:e=>setAlertParams("trackingEvent",e.target.value),options:conditionOptions}))),expressionDescription:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.stackAlerts.geoThreshold.whenEntityLabel",{defaultMessage:"when entity"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.stackAlerts.geoThreshold.selectBoundaryIndex",defaultMessage:"Select boundary:"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(BoundaryIndexExpression,{alertParams:alertParams,alertsContext:alertsContext,errors:errors,boundaryIndexPattern:boundaryIndexPattern,setBoundaryIndexPattern:setBoundaryIndexPattern,setBoundaryGeoField:_geoField=>_geoField&&setAlertParams("boundaryGeoField",_geoField),setBoundaryNameField:_boundaryNameField=>_boundaryNameField?setAlertParams("boundaryNameField",_boundaryNameField):setAlertParams("boundaryNameField",""),boundaryNameField:boundaryNameField}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(data_public_["QueryStringInput"],{disableAutoFocus:true,bubbleSubmitEvent:true,indexPatterns:boundaryIndexPattern?[boundaryIndexPattern]:[],query:boundaryIndexQueryInput,onChange:query=>{if(query.language){if(validateQuery(query)){setAlertParams("boundaryIndexQuery",query)}setBoundaryIndexQueryInput(query)}}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}}}]);