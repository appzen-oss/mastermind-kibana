/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=7)})([function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);var _node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/urlDrilldown/public",__webpack_require__,9)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["urlDrilldown"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var public_=__webpack_require__(0);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var kibanaReact_public_=__webpack_require__(4);var embeddable_public_=__webpack_require__(1);var uiActions_public_=__webpack_require__(2);function getContextScope(contextScopeInput){var _output$title,_output$savedObjectId;function hasEmbeddable(val){if(val&&typeof val==="object"&&"embeddable"in val)return true;return false}if(!hasEmbeddable(contextScopeInput))throw new Error("UrlDrilldown [getContextScope] can't build scope because embeddable object is missing in context");const embeddable=contextScopeInput.embeddable;const input=embeddable.getInput();const output=embeddable.getOutput();function hasSavedObjectId(obj){return"savedObjectId"in obj&&typeof obj.savedObjectId==="string"}function getIndexPatternIds(){function hasIndexPatterns(_output){return"indexPatterns"in _output&&Array.isArray(_output.indexPatterns)&&_output.indexPatterns.length>0}return hasIndexPatterns(output)?output.indexPatterns.map(ip=>ip.id).filter(Boolean):[]}const indexPatternsIds=getIndexPatternIds();return{panel:cleanEmptyKeys({id:input.id,title:(_output$title=output.title)!==null&&_output$title!==void 0?_output$title:input.title,savedObjectId:(_output$savedObjectId=output.savedObjectId)!==null&&_output$savedObjectId!==void 0?_output$savedObjectId:hasSavedObjectId(input)?input.savedObjectId:undefined,query:input.query,timeRange:input.timeRange,filters:input.filters,indexPatternIds:indexPatternsIds.length>1?indexPatternsIds:undefined,indexPatternId:indexPatternsIds.length===1?indexPatternsIds[0]:undefined})}}function getEventScope(eventScopeInput){if(Object(embeddable_public_["isRangeSelectTriggerContext"])(eventScopeInput)){return getEventScopeFromRangeSelectTriggerContext(eventScopeInput)}else if(Object(embeddable_public_["isValueClickTriggerContext"])(eventScopeInput)){return getEventScopeFromValueClickTriggerContext(eventScopeInput)}else if(Object(embeddable_public_["isContextMenuTriggerContext"])(eventScopeInput)){return{}}else{throw new Error("UrlDrilldown [getEventScope] can't build scope from not supported trigger")}}function getEventScopeFromRangeSelectTriggerContext(eventScopeInput){const _eventScopeInput$data=eventScopeInput.data,table=_eventScopeInput$data.table,columnIndex=_eventScopeInput$data.column,range=_eventScopeInput$data.range;const column=table.columns[columnIndex];return cleanEmptyKeys({key:toPrimitiveOrUndefined(column===null||column===void 0?void 0:column.meta.field),from:toPrimitiveOrUndefined(range[0]),to:toPrimitiveOrUndefined(range[range.length-1])})}function getEventScopeFromValueClickTriggerContext(eventScopeInput){var _eventScopeInput$data2,_points$,_points$2;const negate=(_eventScopeInput$data2=eventScopeInput.data.negate)!==null&&_eventScopeInput$data2!==void 0?_eventScopeInput$data2:false;const points=eventScopeInput.data.data.map(({table:table,value:value,column:columnIndex})=>{var _column$meta;const column=table.columns[columnIndex];return{value:toPrimitiveOrUndefined(value),key:column===null||column===void 0?void 0:(_column$meta=column.meta)===null||_column$meta===void 0?void 0:_column$meta.field}});return cleanEmptyKeys({key:(_points$=points[0])===null||_points$===void 0?void 0:_points$.key,value:(_points$2=points[0])===null||_points$2===void 0?void 0:_points$2.value,negate:negate,points:points})}function getMockEventScope([trigger]){if(trigger===uiActions_public_["SELECT_RANGE_TRIGGER"]){return{key:"event.key",from:new Date(Date.now()-15*60*1e3).toISOString(),to:(new Date).toISOString()}}if(trigger===uiActions_public_["VALUE_CLICK_TRIGGER"]){const nPoints=4;const points=new Array(nPoints).fill(0).map((_,index)=>({key:"event.points.".concat(index,".key"),value:"event.points.".concat(index,".value")}));return{key:"event.key",value:"event.value",negate:false,points:points}}return{}}function toPrimitiveOrUndefined(v){if(typeof v==="number"||typeof v==="boolean"||typeof v==="string"||v===null)return v;if(typeof v==="object"&&v instanceof Date)return v.toISOString();if(typeof v==="undefined")return undefined;return String(v)}function cleanEmptyKeys(obj){Object.keys(obj).forEach(key=>{if(obj[key]===undefined){delete obj[key]}});return obj}var external_kbnSharedDeps_KbnI18n_=__webpack_require__(5);const txtUrlDrilldownDisplayName=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.urlDrilldown.DisplayName",{defaultMessage:"Go to URL"});function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const URL_DRILLDOWN="URL_DRILLDOWN";class url_drilldown_UrlDrilldown{constructor(deps){var _this=this;this.deps=deps;_defineProperty(this,"id",URL_DRILLDOWN);_defineProperty(this,"order",8);_defineProperty(this,"minimalLicense","gold");_defineProperty(this,"licenseFeatureName","URL drilldown");_defineProperty(this,"isBeta",true);_defineProperty(this,"getDisplayName",()=>txtUrlDrilldownDisplayName);_defineProperty(this,"euiIcon","link");_defineProperty(this,"ReactCollectConfig",({config:config,onConfig:onConfig,context:context})=>{const scope=external_kbnSharedDeps_React_default.a.useMemo(()=>this.buildEditorScope(context),[context]);return external_kbnSharedDeps_React_default.a.createElement(public_["UrlDrilldownCollectConfig"],{config:config,onConfig:onConfig,scope:scope,syntaxHelpDocsLink:this.deps.getSyntaxHelpDocsLink(),variablesHelpDocsLink:this.deps.getVariablesHelpDocsLink()})});_defineProperty(this,"CollectConfig",Object(kibanaReact_public_["reactToUiComponent"])(this.ReactCollectConfig));_defineProperty(this,"createConfig",()=>({url:{template:""},openInNewTab:false}));_defineProperty(this,"isConfigValid",(config,context)=>{const _urlDrilldownValidate=Object(public_["urlDrilldownValidateUrlTemplate"])(config.url,this.buildEditorScope(context)),isValid=_urlDrilldownValidate.isValid;return isValid});_defineProperty(this,"isCompatible",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(config,context){var _urlDrilldownValidate2,isValid,error;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.t0=public_["urlDrilldownValidateUrlTemplate"];_context.t1=config.url;_context.next=4;return _this.buildRuntimeScope(context);case 4:_context.t2=_context.sent;_urlDrilldownValidate2=(0,_context.t0)(_context.t1,_context.t2);isValid=_urlDrilldownValidate2.isValid;error=_urlDrilldownValidate2.error;if(!isValid){console.warn("UrlDrilldown [".concat(config.url.template,"] is not valid. Error [").concat(error,"]. Skipping execution."))}return _context.abrupt("return",Promise.resolve(isValid));case 10:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}());_defineProperty(this,"getHref",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(config,context){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",Object(public_["urlDrilldownCompileUrl"])(config.url.template,_this.buildRuntimeScope(context)));case 1:case"end":return _context2.stop()}}),_callee2)})));return function(_x3,_x4){return _ref2.apply(this,arguments)}}());_defineProperty(this,"execute",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(config,context){var url;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:url=Object(public_["urlDrilldownCompileUrl"])(config.url.template,_this.buildRuntimeScope(context));if(!config.openInNewTab){_context3.next=5;break}window.open(url,"_blank","noopener");_context3.next=7;break;case 5:_context3.next=7;return _this.deps.navigateToUrl(url);case 7:case"end":return _context3.stop()}}),_callee3)})));return function(_x5,_x6){return _ref3.apply(this,arguments)}}());_defineProperty(this,"buildEditorScope",context=>Object(public_["urlDrilldownBuildScope"])({globalScope:this.deps.getGlobalScope(),contextScope:getContextScope(context),eventScope:getMockEventScope(context.triggers)}));_defineProperty(this,"buildRuntimeScope",context=>Object(public_["urlDrilldownBuildScope"])({globalScope:this.deps.getGlobalScope(),contextScope:getContextScope(context),eventScope:getEventScope(context)}))}supportedTriggers(){return[uiActions_public_["VALUE_CLICK_TRIGGER"],uiActions_public_["SELECT_RANGE_TRIGGER"],embeddable_public_["CONTEXT_MENU_TRIGGER"]]}}var kibanaUtils_public_=__webpack_require__(6);class plugin_UrlDrilldownPlugin{constructor(context){this.context=context}setup(core,plugins){const startServices=Object(kibanaUtils_public_["createStartServicesGetter"])(core.getStartServices);plugins.uiActionsEnhanced.registerDrilldown(new url_drilldown_UrlDrilldown({getGlobalScope:Object(public_["urlDrilldownGlobalScopeProvider"])({core:core}),navigateToUrl:url=>core.getStartServices().then(([{application:application}])=>application.navigateToUrl(url)),getSyntaxHelpDocsLink:()=>startServices().core.docLinks.links.dashboard.urlDrilldownTemplateSyntax,getVariablesHelpDocsLink:()=>startServices().core.docLinks.links.dashboard.urlDrilldownVariables}));return{}}start(core,plugins){return{}}stop(){}}function public_plugin(context){return new plugin_UrlDrilldownPlugin(context)}}]);