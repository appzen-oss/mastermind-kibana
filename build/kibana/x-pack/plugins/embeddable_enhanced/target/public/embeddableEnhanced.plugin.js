/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=4)})([function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var _node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/embeddableEnhanced/public",__webpack_require__,6)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["embeddableEnhanced"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedSetupContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedSetupDependencies",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedStartContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedStartDependencies",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));__webpack_require__.d(__webpack_exports__,"EnhancedEmbeddable",(function(){return types["EnhancedEmbeddable"]}));__webpack_require__.d(__webpack_exports__,"EnhancedEmbeddableContext",(function(){return types["EnhancedEmbeddableContext"]}));__webpack_require__.d(__webpack_exports__,"isEnhancedEmbeddable",(function(){return isEnhancedEmbeddable}));__webpack_require__.d(__webpack_exports__,"embeddableEnhancedDrilldownGrouping",(function(){return drilldownGrouping}));var public_=__webpack_require__(0);var uiActionsEnhanced_public_=__webpack_require__(2);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class embeddable_action_storage_EmbeddableActionStorage extends uiActionsEnhanced_public_["UiActionsEnhancedAbstractActionStorage"]{constructor(embbeddable){super();this.embbeddable=embbeddable}put(input,events){var _input$enhancements;this.embbeddable.updateInput({enhancements:_objectSpread(_objectSpread({},input.enhancements||{}),{},{dynamicActions:_objectSpread(_objectSpread({},((_input$enhancements=input.enhancements)===null||_input$enhancements===void 0?void 0:_input$enhancements.dynamicActions)||{}),{},{events:events})})})}create(event){var _this=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee(){var input,events,exists;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:input=_this.embbeddable.getInput();events=_this.getEventsFromEmbeddable();exists=!!events.find(({eventId:eventId})=>eventId===event.eventId);if(!exists){_context.next=5;break}throw new Error("[EEXIST]: Event with [eventId = ".concat(event.eventId,"] already exists on ")+"[embeddable.id = ".concat(input.id,", embeddable.title = ").concat(input.title,"]."));case 5:_this.put(input,[...events,event]);case 6:case"end":return _context.stop()}}),_callee)})))()}update(event){var _this2=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var input,events,index;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:input=_this2.embbeddable.getInput();events=_this2.getEventsFromEmbeddable();index=events.findIndex(({eventId:eventId})=>eventId===event.eventId);if(!(index===-1)){_context2.next=5;break}throw new Error("[ENOENT]: Event with [eventId = ".concat(event.eventId,"] could not be ")+"updated as it does not exist in "+"[embeddable.id = ".concat(input.id,", embeddable.title = ").concat(input.title,"]."));case 5:_this2.put(input,[...events.slice(0,index),event,...events.slice(index+1)]);case 6:case"end":return _context2.stop()}}),_callee2)})))()}remove(eventId){var _this3=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var input,events,index;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:input=_this3.embbeddable.getInput();events=_this3.getEventsFromEmbeddable();index=events.findIndex(event=>eventId===event.eventId);if(!(index===-1)){_context3.next=5;break}throw new Error("[ENOENT]: Event with [eventId = ".concat(eventId,"] could not be ")+"removed as it does not exist in "+"[embeddable.id = ".concat(input.id,", embeddable.title = ").concat(input.title,"]."));case 5:_this3.put(input,[...events.slice(0,index),...events.slice(index+1)]);case 6:case"end":return _context3.stop()}}),_callee3)})))()}read(eventId){var _this4=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee4(){var input,events,event;return regeneratorRuntime.wrap((function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:input=_this4.embbeddable.getInput();events=_this4.getEventsFromEmbeddable();event=events.find(ev=>eventId===ev.eventId);if(event){_context4.next=5;break}throw new Error("[ENOENT]: Event with [eventId = ".concat(eventId,"] could not be found in ")+"[embeddable.id = ".concat(input.id,", embeddable.title = ").concat(input.title,"]."));case 5:return _context4.abrupt("return",event);case 6:case"end":return _context4.stop()}}),_callee4)})))()}list(){var _this5=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee5(){return regeneratorRuntime.wrap((function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",_this5.getEventsFromEmbeddable());case 1:case"end":return _context5.stop()}}),_callee5)})))()}getEventsFromEmbeddable(){var _input$enhancements2,_input$enhancements2$;const input=this.embbeddable.getInput();const events=((_input$enhancements2=input.enhancements)===null||_input$enhancements2===void 0?void 0:(_input$enhancements2$=_input$enhancements2.dynamicActions)===null||_input$enhancements2$===void 0?void 0:_input$enhancements2$.events)||[];return this.migrate(events)}migrate(events){return events.map(event=>{if(event.action.factoryId==="DASHBOARD_TO_DASHBOARD_DRILLDOWN"){return _objectSpread(_objectSpread({},event),{},{triggers:["FILTER_TRIGGER"]})}return event})}}var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);function panel_notifications_action_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function panel_notifications_action_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){panel_notifications_action_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){panel_notifications_action_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function panel_notifications_action_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const txtOneDrilldown=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.actions.panelNotifications.oneDrilldown",{defaultMessage:"Panel has 1 drilldown"});const txtManyDrilldowns=count=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.actions.panelNotifications.manyDrilldowns",{defaultMessage:"Panel has {count} drilldowns",values:{count:String(count)}});const ACTION_PANEL_NOTIFICATIONS="ACTION_PANEL_NOTIFICATIONS";class panel_notifications_action_PanelNotificationsAction{constructor(){var _this=this;panel_notifications_action_defineProperty(this,"id",ACTION_PANEL_NOTIFICATIONS);panel_notifications_action_defineProperty(this,"getDisplayName",({embeddable:embeddable})=>String(this.getEventCount(embeddable)));panel_notifications_action_defineProperty(this,"getDisplayNameTooltip",({embeddable:embeddable})=>{const count=this.getEventCount(embeddable);return!count?"":count===1?txtOneDrilldown:txtManyDrilldowns(count)});panel_notifications_action_defineProperty(this,"isCompatible",function(){var _ref=panel_notifications_action_asyncToGenerator(regeneratorRuntime.mark((function _callee({embeddable:embeddable}){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(embeddable.getInput().viewMode!==public_["ViewMode"].EDIT)){_context.next=2;break}return _context.abrupt("return",false);case 2:return _context.abrupt("return",_this.getEventCount(embeddable)>0);case 3:case"end":return _context.stop()}}),_callee)})));return function(_x){return _ref.apply(this,arguments)}}());panel_notifications_action_defineProperty(this,"execute",panel_notifications_action_asyncToGenerator(regeneratorRuntime.mark((function _callee2(){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:case"end":return _context2.stop()}}),_callee2)}))))}getEventCount(embeddable){return embeddable.enhancements.dynamicActions.state.get().events.length}}const drilldownGrouping=[{id:"drilldowns",getDisplayName:()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.Drilldowns",{defaultMessage:"Drilldowns"}),getIconType:()=>"symlink",order:25}];function plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function plugin_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function plugin_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function plugin_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){plugin_ownKeys(Object(source),true).forEach((function(key){plugin_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{plugin_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_EmbeddableEnhancedPlugin{constructor(context){this.context=context;plugin_defineProperty(this,"uiActions",void 0);plugin_defineProperty(this,"isEmbeddableContext",context=>{if(!(context===null||context===void 0?void 0:context.embeddable)){console.warn("For drilldowns to work action context should contain .embeddable field.");return false}return true})}setup(core,plugins){this.setCustomEmbeddableFactoryProvider(plugins);const panelNotificationAction=new panel_notifications_action_PanelNotificationsAction;plugins.uiActionsEnhanced.registerAction(panelNotificationAction);plugins.uiActionsEnhanced.attachAction(public_["PANEL_NOTIFICATION_TRIGGER"],panelNotificationAction.id);return{}}start(core,plugins){this.uiActions=plugins.uiActionsEnhanced;return{}}stop(){}setCustomEmbeddableFactoryProvider(plugins){var _this=this;plugins.embeddable.setCustomEmbeddableFactoryProvider(def=>{const factory=Object(public_["defaultEmbeddableFactoryProvider"])(def);return plugin_objectSpread(plugin_objectSpread({},factory),{},{create:function(){var _create=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee(...args){var embeddable;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return factory.create(...args);case 2:embeddable=_context.sent;if(embeddable){_context.next=5;break}return _context.abrupt("return",embeddable);case 5:return _context.abrupt("return",_this.enhanceEmbeddableWithDynamicActions(embeddable));case 6:case"end":return _context.stop()}}),_callee)})));function create(){return _create.apply(this,arguments)}return create}(),createFromSavedObject:function(){var _createFromSavedObject=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee2(...args){var embeddable;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.next=2;return factory.createFromSavedObject(...args);case 2:embeddable=_context2.sent;if(embeddable){_context2.next=5;break}return _context2.abrupt("return",embeddable);case 5:return _context2.abrupt("return",_this.enhanceEmbeddableWithDynamicActions(embeddable));case 6:case"end":return _context2.stop()}}),_callee2)})));function createFromSavedObject(){return _createFromSavedObject.apply(this,arguments)}return createFromSavedObject}()})})}enhanceEmbeddableWithDynamicActions(embeddable){var _this2=this;const enhancedEmbeddable=embeddable;const storage=new embeddable_action_storage_EmbeddableActionStorage(embeddable);const dynamicActions=new uiActionsEnhanced_public_["UiActionsEnhancedDynamicActionManager"]({isCompatible:function(){var _isCompatible=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee3(context){return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(_this2.isEmbeddableContext(context)){_context3.next=2;break}return _context3.abrupt("return",false);case 2:if(!(context.embeddable.getInput().viewMode!==public_["ViewMode"].VIEW)){_context3.next=4;break}return _context3.abrupt("return",false);case 4:return _context3.abrupt("return",context.embeddable.runtimeId===embeddable.runtimeId);case 5:case"end":return _context3.stop()}}),_callee3)})));function isCompatible(_x){return _isCompatible.apply(this,arguments)}return isCompatible}(),storage:storage,uiActions:this.uiActions});dynamicActions.start().catch(error=>{console.log("Failed to start embeddable dynamic actions",embeddable);console.error(error)});const stop=()=>{dynamicActions.stop().catch(error=>{console.log("Failed to stop embeddable dynamic actions",embeddable);console.error(error)})};embeddable.getInput$().subscribe({next:()=>{storage.reload$.next()},error:stop,complete:stop});enhancedEmbeddable.enhancements=plugin_objectSpread(plugin_objectSpread({},enhancedEmbeddable.enhancements),{},{dynamicActions:dynamicActions});return enhancedEmbeddable}}var types=__webpack_require__(3);const isEnhancedEmbeddable=maybeEnhancedEmbeddable=>{var _enhancements;return typeof(maybeEnhancedEmbeddable===null||maybeEnhancedEmbeddable===void 0?void 0:(_enhancements=maybeEnhancedEmbeddable.enhancements)===null||_enhancements===void 0?void 0:_enhancements.dynamicActions)==="object"};function public_plugin(context){return new plugin_EmbeddableEnhancedPlugin(context)}}]);