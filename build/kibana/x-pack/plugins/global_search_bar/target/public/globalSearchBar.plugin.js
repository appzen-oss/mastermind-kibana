/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=11)})([function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},function(module,exports){},function(module,exports){module.exports=__kbnSharedDeps__.MomentTimezone},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,exports){module.exports=__kbnSharedDeps__.ReactDom},function(module,exports){},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(0);function useMountedState(){var mountedRef=react_1.useRef(false);var get=react_1.useCallback((function(){return mountedRef.current}),[]);react_1.useEffect((function(){mountedRef.current=true;return function(){mountedRef.current=false}}));return get}exports.default=useMountedState},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(13);var react_1=__webpack_require__(0);var useTimeoutFn_1=tslib_1.__importDefault(__webpack_require__(14));function useDebounce(fn,ms,deps){if(ms===void 0){ms=0}if(deps===void 0){deps=[]}var _a=useTimeoutFn_1.default(fn,ms),isReady=_a[0],cancel=_a[1],reset=_a[2];react_1.useEffect(reset,deps);return[isReady,cancel]}exports.default=useDebounce},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(0);var util_1=__webpack_require__(15);var defaultTarget=util_1.isClient?window:null;var isListenerType1=function(target){return!!target.addEventListener};var isListenerType2=function(target){return!!target.on};var useEvent=function(name,handler,target,options){if(target===void 0){target=defaultTarget}react_1.useEffect((function(){if(!handler){return}if(!target){return}if(isListenerType1(target)){target.addEventListener(name,handler,options)}else if(isListenerType2(target)){target.on(name,handler,options)}return function(){if(isListenerType1(target)){target.removeEventListener(name,handler,options)}else if(isListenerType2(target)){target.off(name,handler,options)}}}),[name,handler,target,JSON.stringify(options)])};exports.default=useEvent},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_globalSearchBar_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _node_modules_val_loader_dist_cjs_js_key_globalSearchBar_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_globalSearchBar_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/globalSearchBar/public",__webpack_require__,17)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["globalSearchBar"]},function(module,exports){module.exports=__kbnSharedDeps__.TsLib},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(0);function useTimeoutFn(fn,ms){if(ms===void 0){ms=0}var ready=react_1.useRef(false);var timeout=react_1.useRef();var callback=react_1.useRef(fn);var isReady=react_1.useCallback((function(){return ready.current}),[]);var set=react_1.useCallback((function(){ready.current=false;timeout.current&&clearTimeout(timeout.current);timeout.current=setTimeout((function(){ready.current=true;callback.current()}),ms)}),[ms]);var clear=react_1.useCallback((function(){ready.current=null;timeout.current&&clearTimeout(timeout.current)}),[]);react_1.useEffect((function(){callback.current=fn}),[fn]);react_1.useEffect((function(){set();return clear}),[ms]);return[isReady,clear,set]}exports.default=useTimeoutFn},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isClient=typeof window==="object";exports.on=function(obj){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}return obj.addEventListener.apply(obj,args)};exports.off=function(obj){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}return obj.removeEventListener.apply(obj,args)};exports.isDeepEqual=__webpack_require__(16)},function(module,exports,__webpack_require__){"use strict";module.exports=function equal(a,b){if(a===b)return true;if(a&&b&&typeof a=="object"&&typeof b=="object"){if(a.constructor!==b.constructor)return false;var length,i,keys;if(Array.isArray(a)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return false;return true}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return false;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return false;for(i=length;i--!==0;){var key=keys[i];if(key==="_owner"&&a.$$typeof){continue}if(!equal(a[key],b[key]))return false}return true}return a!==a&&b!==b}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(6);var external_kbnSharedDeps_ReactDom_default=__webpack_require__.n(external_kbnSharedDeps_ReactDom_);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(1);function wrapArray(subj){return Array.isArray(subj)?subj:[subj]}class UnreachableCaseError extends Error{constructor(val){super("Unreachable case: ".concat(val))}}function createUiStatsMetric({type:type,appName:appName,eventName:eventName,count:count=1}){return{type:type,appName:appName,eventName:eventName,count:count}}var external_kbnSharedDeps_MomentTimezone_=__webpack_require__(4);var external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class application_usage_ApplicationUsage{constructor(){_defineProperty(this,"currentUsage",void 0)}start(){if(window)window.addEventListener("click",()=>this.currentUsage&&this.currentUsage.numberOfClicks++)}appChanged(appId){const currentUsage=this.currentUsage;if(appId){this.currentUsage={type:METRIC_TYPE.APPLICATION_USAGE,appId:appId,startTime:external_kbnSharedDeps_MomentTimezone_default()(),numberOfClicks:0}}else{this.currentUsage=void 0}return currentUsage}}var stats=__webpack_require__(7);function trackUsageAgent(appName){const userAgent=window&&window.navigator&&window.navigator.userAgent||"";return{type:METRIC_TYPE.USER_AGENT,appName:appName,userAgent:userAgent}}let METRIC_TYPE;(function(METRIC_TYPE){METRIC_TYPE["COUNT"]="count";METRIC_TYPE["LOADED"]="loaded";METRIC_TYPE["CLICK"]="click";METRIC_TYPE["USER_AGENT"]="user_agent";METRIC_TYPE["APPLICATION_USAGE"]="application_usage"})(METRIC_TYPE||(METRIC_TYPE={}));function storage_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class ReportStorageManager{constructor(storageKey,storage){storage_defineProperty(this,"storageKey",void 0);storage_defineProperty(this,"storage",void 0);this.storageKey=storageKey;this.storage=storage}get(){if(!this.storage)return;return this.storage.get(this.storageKey)}store(report){if(!this.storage)return;this.storage.set(this.storageKey,report)}}function report_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const REPORT_VERSION=1;class report_ReportManager{constructor(report){report_defineProperty(this,"report",void 0);this.report=report||report_ReportManager.createReport()}static createReport(){return{reportVersion:REPORT_VERSION}}clearReport(){this.report=report_ReportManager.createReport()}isReportEmpty(){const _this$report=this.report,uiStatsMetrics=_this$report.uiStatsMetrics,userAgent=_this$report.userAgent,appUsage=_this$report.application_usage;const noUiStats=!uiStatsMetrics||Object.keys(uiStatsMetrics).length===0;const noUserAgent=!userAgent||Object.keys(userAgent).length===0;const noAppUsage=!appUsage||Object.keys(appUsage).length===0;return noUiStats&&noUserAgent&&noAppUsage}incrementStats(count,stats){const _ref=stats||{},_ref$min=_ref.min,min=_ref$min===void 0?0:_ref$min,_ref$max=_ref.max,max=_ref$max===void 0?0:_ref$max,_ref$sum=_ref.sum,sum=_ref$sum===void 0?0:_ref$sum;const newMin=Math.min(min,count);const newMax=Math.max(max,count);const newAvg=newMin+newMax/2;const newSum=sum+count;return{min:newMin,max:newMax,avg:newAvg,sum:newSum}}assignReports(newMetrics){wrapArray(newMetrics).forEach(newMetric=>this.assignReport(this.report,newMetric));return{report:this.report}}static createMetricKey(metric){switch(metric.type){case METRIC_TYPE.USER_AGENT:{const appName=metric.appName,type=metric.type;return"".concat(appName,"-").concat(type)}case METRIC_TYPE.CLICK:case METRIC_TYPE.LOADED:case METRIC_TYPE.COUNT:{const appName=metric.appName,eventName=metric.eventName,type=metric.type;return"".concat(appName,"-").concat(type,"-").concat(eventName)}case METRIC_TYPE.APPLICATION_USAGE:return metric.appId;default:throw new UnreachableCaseError(metric)}}assignReport(report,metric){const key=report_ReportManager.createMetricKey(metric);switch(metric.type){case METRIC_TYPE.USER_AGENT:{const appName=metric.appName,type=metric.type,userAgent=metric.userAgent;if(userAgent){report.userAgent={[key]:{key:key,appName:appName,type:type,userAgent:metric.userAgent}}}return}case METRIC_TYPE.CLICK:case METRIC_TYPE.LOADED:case METRIC_TYPE.COUNT:{const appName=metric.appName,type=metric.type,eventName=metric.eventName,count=metric.count;report.uiStatsMetrics=report.uiStatsMetrics||{};const existingStats=(report.uiStatsMetrics[key]||{}).stats;report.uiStatsMetrics[key]={key:key,appName:appName,eventName:eventName,type:type,stats:this.incrementStats(count,existingStats)};return}case METRIC_TYPE.APPLICATION_USAGE:const numberOfClicks=metric.numberOfClicks,startTime=metric.startTime;const minutesOnScreen=external_kbnSharedDeps_MomentTimezone_default()().diff(startTime,"minutes",true);report.application_usage=report.application_usage||{};const appExistingData=report.application_usage[key]||{minutesOnScreen:0,numberOfClicks:0};report.application_usage[key]={minutesOnScreen:appExistingData.minutesOnScreen+minutesOnScreen,numberOfClicks:appExistingData.numberOfClicks+numberOfClicks};break;default:throw new UnreachableCaseError(metric)}}}report_defineProperty(report_ReportManager,"REPORT_VERSION",REPORT_VERSION);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function reporter_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class reporter_Reporter{constructor(config){var _this=this;reporter_defineProperty(this,"checkInterval",void 0);reporter_defineProperty(this,"interval",void 0);reporter_defineProperty(this,"lastAppId",void 0);reporter_defineProperty(this,"http",void 0);reporter_defineProperty(this,"reportManager",void 0);reporter_defineProperty(this,"storageManager",void 0);reporter_defineProperty(this,"applicationUsage",void 0);reporter_defineProperty(this,"debug",void 0);reporter_defineProperty(this,"retryCount",0);reporter_defineProperty(this,"maxRetries",3);reporter_defineProperty(this,"started",false);reporter_defineProperty(this,"start",()=>{if(!this.interval){this.interval=setTimeout(()=>{this.interval=undefined;this.sendReports()},this.checkInterval)}if(this.started){return}if(window&&document){window.addEventListener("beforeunload",()=>this.reportApplicationUsage());document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"&&this.lastAppId){this.reportApplicationUsage(this.lastAppId)}else if(document.visibilityState==="hidden"){this.reportApplicationUsage()}})}this.started=true;this.applicationUsage.start()});reporter_defineProperty(this,"reportUiStats",(appName,type,eventNames,count)=>{const metrics=wrapArray(eventNames).map(eventName=>{this.log("".concat(type," Metric -> (").concat(appName,":").concat(eventName,"):"));const report=createUiStatsMetric({type:type,appName:appName,eventName:eventName,count:count});this.log(report);return report});this.saveToReport(metrics)});reporter_defineProperty(this,"reportUserAgent",appName=>{this.log("Reporting user-agent.");const report=trackUsageAgent(appName);this.saveToReport([report])});reporter_defineProperty(this,"sendReports",_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var versionMismatch;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(_this.reportManager.isReportEmpty()){_context.next=13;break}_context.prev=1;_context.next=4;return _this.http(_this.reportManager.report);case 4:_this.flushReport();_context.next=13;break;case 7:_context.prev=7;_context.t0=_context["catch"](1);_this.log("Error Sending Metrics Report ".concat(_context.t0));_this.retryCount=_this.retryCount+1;versionMismatch=_this.reportManager.report.reportVersion!==report_ReportManager.REPORT_VERSION;if(versionMismatch||_this.retryCount>_this.maxRetries){_this.flushReport()}case 13:_this.start();case 14:case"end":return _context.stop()}}),_callee,null,[[1,7]])}))));const http=config.http,storage=config.storage,debug=config.debug,_config$checkInterval=config.checkInterval,checkInterval=_config$checkInterval===void 0?9e4:_config$checkInterval,_config$storageKey=config.storageKey,storageKey=_config$storageKey===void 0?"analytics":_config$storageKey;this.http=http;this.checkInterval=checkInterval;this.applicationUsage=new application_usage_ApplicationUsage;this.storageManager=new ReportStorageManager(storageKey,storage);const storedReport=this.storageManager.get();this.reportManager=new report_ReportManager(storedReport);this.debug=!!debug}saveToReport(newMetrics){this.reportManager.assignReports(newMetrics);this.storageManager.store(this.reportManager.report)}flushReport(){this.retryCount=0;this.reportManager.clearReport();this.storageManager.store(this.reportManager.report)}log(message){if(this.debug){console.debug(message)}}reportApplicationUsage(appId){this.log("Reporting application changed to ".concat(appId));this.lastAppId=appId||this.lastAppId;const appChangedReport=this.applicationUsage.appChanged(appId);if(appChangedReport)this.saveToReport([appChangedReport])}}var external_kbnSharedDeps_KbnI18n_=__webpack_require__(5);var useDebounce=__webpack_require__(9);var useDebounce_default=__webpack_require__.n(useDebounce);var useEvent=__webpack_require__(10);var useEvent_default=__webpack_require__.n(useEvent);var useMountedState=__webpack_require__(8);var useMountedState_default=__webpack_require__.n(useMountedState);const getFieldValueMap=query=>{const fieldMap=new Map;query.ast.clauses.forEach(clause=>{if(clause.type==="field"){var _fieldMap$get;const field=clause.field,value=clause.value;fieldMap.set(field,[...(_fieldMap$get=fieldMap.get(field))!==null&&_fieldMap$get!==void 0?_fieldMap$get:[],...Array.isArray(value)?value:[value]])}});return fieldMap};const getSearchTerm=query=>{var _term;let term;if(query.ast.getTermClauses().length){term=query.ast.getTermClauses().map(clause=>clause.value).join(" ").replace(/\s{2,}/g," ").trim()}return((_term=term)===null||_term===void 0?void 0:_term.length)?term:undefined};const applyAliases=(valueMap,aliasesMap)=>{const reverseLookup={};Object.entries(aliasesMap).forEach(([canonical,aliases])=>{aliases.forEach(alias=>{reverseLookup[alias]=canonical})});const resultMap=new Map;valueMap.forEach((values,field)=>{var _reverseLookup$field,_resultMap$get;const targetKey=(_reverseLookup$field=reverseLookup[field])!==null&&_reverseLookup$field!==void 0?_reverseLookup$field:field;resultMap.set(targetKey,[...(_resultMap$get=resultMap.get(targetKey))!==null&&_resultMap$get!==void 0?_resultMap$get:[],...values])});return resultMap};function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){parse_search_params_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function parse_search_params_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const knownFilters=["tag","type"];const aliasMap={tag:["tags"],type:["types"]};const parseSearchParams=term=>{let query;try{query=external_kbnSharedDeps_ElasticEui_["Query"].parse(term)}catch(e){return{term:term,filters:{unknowns:{}}}}const searchTerm=getSearchTerm(query);const filterValues=applyAliases(getFieldValueMap(query),aliasMap);const unknownFilters=[...filterValues.entries()].filter(([key])=>!knownFilters.includes(key)).reduce((unknowns,[key,value])=>_objectSpread(_objectSpread({},unknowns),{},{[key]:value}),{});const tags=filterValues.get("tag");const types=filterValues.get("type");return{term:searchTerm,filters:{tags:tags?valuesToString(tags):undefined,types:types?valuesToString(types):undefined,unknowns:unknownFilters}}};const valuesToString=raw=>raw.map(value=>String(value));var search_syntax_types=__webpack_require__(3);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const clearField=field=>{const nativeInputValue=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");const nativeInputValueSetter=nativeInputValue?nativeInputValue.set:undefined;if(nativeInputValueSetter){nativeInputValueSetter.call(field,"")}field.dispatchEvent(new Event("change"))};const cleanMeta=str=>(str.charAt(0).toUpperCase()+str.slice(1)).replace(/-/g," ");const blurEvent=new FocusEvent("blur");const sortByScore=(a,b)=>{if(a.score<b.score)return 1;if(a.score>b.score)return-1;return 0};const sortByTitle=(a,b)=>{const titleA=a.title.toUpperCase();const titleB=b.title.toUpperCase();if(titleA<titleB)return-1;if(titleA>titleB)return 1;return 0};const resultToOption=result=>{const id=result.id,title=result.title,url=result.url,icon=result.icon,type=result.type,meta=result.meta;const useIcon=type==="application";const option={key:id,label:title,url:url,type:type,icon:{type:useIcon&&icon?icon:"empty"},"data-test-subj":"nav-search-option"};if(type==="application"){option.meta=[{text:meta===null||meta===void 0?void 0:meta.categoryLabel}]}else{option.meta=[{text:cleanMeta(type)}]}return option};function SearchBar({globalSearch:globalSearch,taggingApi:taggingApi,navigateToUrl:navigateToUrl,trackUiMetric:trackUiMetric,basePathUrl:basePathUrl,darkMode:darkMode}){const isMounted=useMountedState_default()();const _useState=Object(external_kbnSharedDeps_React_["useState"])(""),_useState2=_slicedToArray(_useState,2),searchValue=_useState2[0],setSearchValue=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])(null),_useState4=_slicedToArray(_useState3,2),searchRef=_useState4[0],setSearchRef=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(null),_useState6=_slicedToArray(_useState5,2),buttonRef=_useState6[0],setButtonRef=_useState6[1];const searchSubscription=Object(external_kbnSharedDeps_React_["useRef"])(null);const _useState7=Object(external_kbnSharedDeps_React_["useState"])([]),_useState8=_slicedToArray(_useState7,2),options=_useState8[0],_setOptions=_useState8[1];const isMac=navigator.platform.toLowerCase().indexOf("mac")>=0;const setOptions=Object(external_kbnSharedDeps_React_["useCallback"])(_options=>{if(!isMounted()){return}_setOptions(_options.map(resultToOption))},[isMounted,_setOptions]);useDebounce_default()(()=>{if(searchSubscription.current){searchSubscription.current.unsubscribe();searchSubscription.current=null}let arr=[];if(searchValue.length!==0){trackUiMetric(METRIC_TYPE.COUNT,"search_request")}const rawParams=parseSearchParams(searchValue);const tagIds=taggingApi&&rawParams.filters.tags?rawParams.filters.tags.map(tagName=>{var _taggingApi$ui$getTag;return(_taggingApi$ui$getTag=taggingApi.ui.getTagIdFromName(tagName))!==null&&_taggingApi$ui$getTag!==void 0?_taggingApi$ui$getTag:"__unknown__"}):undefined;const searchParams={term:rawParams.term,types:rawParams.filters.types,tags:tagIds};searchSubscription.current=globalSearch(searchParams,{}).subscribe({next:({results:results})=>{if(searchValue.length>0){arr=[...results,...arr].sort(sortByScore);setOptions(arr);return}results=results.filter(({type:type})=>type==="application");arr=[...results,...arr].sort(sortByTitle);setOptions(arr)},error:()=>{trackUiMetric(METRIC_TYPE.COUNT,"unhandled_error")},complete:()=>{}})},350,[searchValue]);const onKeyDown=event=>{if(event.key==="/"&&(isMac?event.metaKey:event.ctrlKey)){event.preventDefault();trackUiMetric(METRIC_TYPE.COUNT,"shortcut_used");if(searchRef){searchRef.focus()}else if(buttonRef){buttonRef.children[0].click()}}};const onChange=selection=>{const selected=selection.find(({checked:checked})=>checked==="on");if(!selected){return}const url=selected.url,type=selected.type;try{if(type==="application"){var _selected$keys;const key=(_selected$keys=selected.keys)!==null&&_selected$keys!==void 0?_selected$keys:"unknown";trackUiMetric(METRIC_TYPE.CLICK,["user_navigated_to_application","user_navigated_to_application_".concat(key.toLowerCase().replaceAll(" ","_"))])}else{trackUiMetric(METRIC_TYPE.CLICK,["user_navigated_to_saved_object","user_navigated_to_saved_object_".concat(type)])}}catch(e){console.log("Error trying to track searchbar metrics",e)}navigateToUrl(url);document.activeElement.blur();if(searchRef){clearField(searchRef);searchRef.dispatchEvent(blurEvent)}};const emptyMessage=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectableMessage"],{style:{minHeight:300},"data-test-subj":"nav-search-no-results"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiImage"],{alt:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.globalSearchBar.searchBar.noResultsImageAlt",{defaultMessage:"Illustration of black hole"}),size:"fullWidth",url:"".concat(basePathUrl,"illustration_product_no_search_results_").concat(darkMode?"dark":"light",".svg")}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.noResultsHeading",defaultMessage:"No results found"}))),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.noResults",defaultMessage:"Try searching for applications, dashboards, visualizations, and more."})));useEvent_default()("keydown",onKeyDown);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectableTemplateSitewide"],{onChange:onChange,options:options,popoverButtonBreakpoints:["xs","s"],singleSelection:true,popoverButton:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHeaderSectionItemButton"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.globalSearchBar.searchBar.mobileSearchButtonAriaLabel",{defaultMessage:"Site-wide search"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"search",size:"m"})),searchProps:{onSearch:()=>undefined,onKeyUpCapture:e=>setSearchValue(e.currentTarget.value),"data-test-subj":"nav-search-input",inputRef:setSearchRef,compressed:true,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.globalSearchBar.searchBar.placeholder",{defaultMessage:"Search AppZen"}),onFocus:()=>{trackUiMetric(METRIC_TYPE.COUNT,"search_focus")}},popoverProps:{"data-test-subj":"nav-search-popover",panelClassName:"navSearch__panel",repositionOnScroll:true,buttonRef:setButtonRef},emptyMessage:emptyMessage,noMatchesMessage:emptyMessage,popoverFooter:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued",size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"spaceBetween",gutterSize:"s",responsive:false,wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("p",{style:{marginBottom:0}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.helpText.helpTextPrefix",defaultMessage:"Filter by"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"type:")," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.helpText.helpTextConjunction",defaultMessage:"or"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"tag:"))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("p",{style:{marginBottom:0}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.shortcutDescription.shortcutDetail",defaultMessage:"{shortcutDescription} {commandDescription}",values:{shortcutDescription:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.shortcutDescription.shortcutInstructionDescription",defaultMessage:"Shortcut"}),commandDescription:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,isMac?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.shortcutDescription.macCommandDescription",defaultMessage:"Command + /"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.globalSearchBar.searchBar.shortcutDescription.windowsCommandDescription",defaultMessage:"Control + /"}))}})))))})}function plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function plugin_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}class plugin_GlobalSearchBarPlugin{setup(){return plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee(){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:return _context.abrupt("return",{});case 1:case"end":return _context.stop()}}),_callee)})))()}start(core,{globalSearch:globalSearch,savedObjectsTagging:savedObjectsTagging,usageCollection:usageCollection}){const trackUiMetric=usageCollection?usageCollection.reportUiStats.bind(usageCollection,"global_search_bar"):(metricType,eventName)=>{};core.chrome.navControls.registerCenter({order:1e3,mount:container=>this.mount({container:container,globalSearch:globalSearch,savedObjectsTagging:savedObjectsTagging,navigateToUrl:core.application.navigateToUrl,basePathUrl:core.http.basePath.prepend("/plugins/globalSearchBar/assets/"),darkMode:core.uiSettings.get("theme:darkMode"),trackUiMetric:trackUiMetric})});return{}}mount({container:container,globalSearch:globalSearch,savedObjectsTagging:savedObjectsTagging,navigateToUrl:navigateToUrl,basePathUrl:basePathUrl,darkMode:darkMode,trackUiMetric:trackUiMetric}){external_kbnSharedDeps_ReactDom_default.a.render(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["I18nProvider"],null,external_kbnSharedDeps_React_default.a.createElement(SearchBar,{globalSearch:globalSearch.find,navigateToUrl:navigateToUrl,taggingApi:savedObjectsTagging,basePathUrl:basePathUrl,darkMode:darkMode,trackUiMetric:trackUiMetric})),container);return()=>external_kbnSharedDeps_ReactDom_default.a.unmountComponentAtNode(container)}}const public_plugin=()=>new plugin_GlobalSearchBarPlugin}]);