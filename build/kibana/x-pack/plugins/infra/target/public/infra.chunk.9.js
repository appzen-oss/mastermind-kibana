/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["infra_bundle_jsonpfunction"]=window["infra_bundle_jsonpfunction"]||[]).push([[9],{112:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getChartTheme}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getTimelineChartTheme}));var _elastic_charts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(61);var _elastic_charts__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_charts__WEBPACK_IMPORTED_MODULE_0__);function getChartTheme(isDarkMode){return isDarkMode?_elastic_charts__WEBPACK_IMPORTED_MODULE_0__["DARK_THEME"]:_elastic_charts__WEBPACK_IMPORTED_MODULE_0__["LIGHT_THEME"]}function getTimelineChartTheme(isDarkMode){return isDarkMode?_elastic_charts__WEBPACK_IMPORTED_MODULE_0__["DARK_THEME"]:Object(_elastic_charts__WEBPACK_IMPORTED_MODULE_0__["mergeWithDefaultTheme"])(TIMELINE_LIGHT_THEME,_elastic_charts__WEBPACK_IMPORTED_MODULE_0__["LIGHT_THEME"])}const TIMELINE_LIGHT_THEME={crosshair:{band:{fill:"#D3DAE6"}},axes:{gridLine:{horizontal:{stroke:"#eaeaea"}}}}},123:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return MetricExplorerSeriesChart}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(61);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__);var _common_color_palette__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(85);var _helpers_create_metric_label__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(160);var _hooks_use_metrics_explorer_options__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(88);var _helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(124);const MetricExplorerSeriesChart=props=>{if(_hooks_use_metrics_explorer_options__WEBPACK_IMPORTED_MODULE_4__["b"].bar===props.type){return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(MetricsExplorerBarChart,props)}return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(MetricsExplorerAreaChart,props)};const MetricsExplorerAreaChart=({metric:metric,id:id,series:series,type:type,stack:stack,opacity:opacity})=>{const color=metric.color&&Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["b"])(metric.color)||Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["b"])(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["a"].color0);const yAccessors=Array.isArray(id)?id.map(i=>Object(_helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__["a"])(metric,i)).slice(id.length-1,id.length):[Object(_helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__["a"])(metric,id)];const y0Accessors=Array.isArray(id)&&id.length>1?id.map(i=>Object(_helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__["a"])(metric,i)).slice(0,1):undefined;const chartId="series-".concat(series.id,"-").concat(yAccessors.join("-"));const seriesAreaStyle={line:{strokeWidth:2,visible:true},area:{opacity:opacity||.5,visible:type===_hooks_use_metrics_explorer_options__WEBPACK_IMPORTED_MODULE_4__["b"].area}};return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AreaSeries"],{id:chartId,key:chartId,name:Object(_helpers_create_metric_label__WEBPACK_IMPORTED_MODULE_3__["a"])(metric),xScaleType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["ScaleType"].Time,yScaleType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["ScaleType"].Linear,xAccessor:"timestamp",yAccessors:yAccessors,y0Accessors:y0Accessors,data:series.rows,stackAccessors:stack?["timestamp"]:void 0,areaSeriesStyle:seriesAreaStyle,color:color})};const MetricsExplorerBarChart=({metric:metric,id:id,series:series,stack:stack})=>{const color=metric.color&&Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["b"])(metric.color)||Object(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["b"])(_common_color_palette__WEBPACK_IMPORTED_MODULE_2__["a"].color0);const yAccessors=Array.isArray(id)?id.map(i=>Object(_helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__["a"])(metric,i)).slice(id.length-1,id.length):[Object(_helpers_get_metric_id__WEBPACK_IMPORTED_MODULE_5__["a"])(metric,id)];const chartId="series-".concat(series.id,"-").concat(yAccessors.join("-"));const seriesBarStyle={rectBorder:{stroke:color,strokeWidth:1,visible:true},rect:{opacity:1}};return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["BarSeries"],{id:chartId,key:chartId,name:Object(_helpers_create_metric_label__WEBPACK_IMPORTED_MODULE_3__["a"])(metric),xScaleType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["ScaleType"].Time,yScaleType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["ScaleType"].Linear,xAccessor:"timestamp",yAccessors:yAccessors,data:series.rows,stackAccessors:stack?["timestamp"]:void 0,barSeriesStyle:seriesBarStyle,color:color})}},124:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getMetricId}));const getMetricId=(metric,index)=>"metric_".concat(index)},125:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return calculateDomain}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var _get_metric_id__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(124);const getMin=values=>{const minValue=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["min"])(values);return Object(lodash__WEBPACK_IMPORTED_MODULE_0__["isNumber"])(minValue)&&Number.isFinite(minValue)?minValue:undefined};const getMax=values=>{const maxValue=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["max"])(values);return Object(lodash__WEBPACK_IMPORTED_MODULE_0__["isNumber"])(maxValue)&&Number.isFinite(maxValue)?maxValue:undefined};const calculateDomain=(series,metrics,stacked=false)=>{const values=series.rows.reduce((acc,row)=>{const rowValues=metrics.map((m,index)=>row[Object(_get_metric_id__WEBPACK_IMPORTED_MODULE_1__["a"])(m,index)]||null).filter(v=>Object(lodash__WEBPACK_IMPORTED_MODULE_0__["isNumber"])(v));const minValue=getMin(rowValues);const maxValue=stacked?Object(lodash__WEBPACK_IMPORTED_MODULE_0__["sum"])(rowValues)*1.1:getMax(rowValues);return acc.concat([minValue||null,maxValue||null])},[]).filter(v=>Object(lodash__WEBPACK_IMPORTED_MODULE_0__["isNumber"])(v));return{min:getMin(values)||0,max:getMax(values)||0}}},132:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return METRIC_THRESHOLD_ALERT_TYPE_ID}));__webpack_require__.d(__webpack_exports__,"d",(function(){return METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID}));__webpack_require__.d(__webpack_exports__,"b",(function(){return Comparator}));__webpack_require__.d(__webpack_exports__,"a",(function(){return Aggregators}));__webpack_require__.d(__webpack_exports__,"c",(function(){return INFRA_ALERT_PREVIEW_PATH}));var lib=__webpack_require__(0);var types=__webpack_require__(83);const METRIC_THRESHOLD_ALERT_TYPE_ID="metrics.alert.threshold";const METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID="metrics.alert.inventory.threshold";let Comparator;(function(Comparator){Comparator["GT"]=">";Comparator["LT"]="<";Comparator["GT_OR_EQ"]=">=";Comparator["LT_OR_EQ"]="<=";Comparator["BETWEEN"]="between";Comparator["OUTSIDE_RANGE"]="outside"})(Comparator||(Comparator={}));let Aggregators;(function(Aggregators){Aggregators["COUNT"]="count";Aggregators["AVERAGE"]="avg";Aggregators["SUM"]="sum";Aggregators["MIN"]="min";Aggregators["MAX"]="max";Aggregators["RATE"]="rate";Aggregators["CARDINALITY"]="cardinality";Aggregators["P95"]="p95";Aggregators["P99"]="p99"})(Aggregators||(Aggregators={}));const baseAlertRequestParamsRT=lib["intersection"]([lib["partial"]({filterQuery:lib["union"]([lib["string"],lib["undefined"]]),sourceId:lib["string"]}),lib["type"]({lookback:lib["union"]([lib["literal"]("ms"),lib["literal"]("s"),lib["literal"]("m"),lib["literal"]("h"),lib["literal"]("d"),lib["literal"]("w"),lib["literal"]("M"),lib["literal"]("y")]),criteria:lib["array"](lib["any"]),alertInterval:lib["string"],alertThrottle:lib["string"],alertOnNoData:lib["boolean"]})]);const metricThresholdAlertPreviewRequestParamsRT=lib["intersection"]([baseAlertRequestParamsRT,lib["partial"]({groupBy:lib["union"]([lib["string"],lib["array"](lib["string"]),lib["undefined"]])}),lib["type"]({alertType:lib["literal"](METRIC_THRESHOLD_ALERT_TYPE_ID)})]);const inventoryAlertPreviewRequestParamsRT=lib["intersection"]([baseAlertRequestParamsRT,lib["type"]({nodeType:types["c"],alertType:lib["literal"](METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID)})]);const alertPreviewRequestParamsRT=lib["union"]([metricThresholdAlertPreviewRequestParamsRT,inventoryAlertPreviewRequestParamsRT]);const alertPreviewSuccessResponsePayloadRT=lib["type"]({numberOfGroups:lib["number"],resultTotals:lib["type"]({fired:lib["number"],noData:lib["number"],error:lib["number"],notifications:lib["number"]})});const INFRA_ALERT_PREVIEW_PATH="/api/infra/alerting/preview";const TOO_MANY_BUCKETS_PREVIEW_EXCEPTION="TOO_MANY_BUCKETS_PREVIEW_EXCEPTION";const isTooManyBucketsPreviewException=value=>Boolean(value&&value.TOO_MANY_BUCKETS_PREVIEW_EXCEPTION)},151:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return WithKueryAutocompletion}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8);var _src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_1__);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class WithKueryAutocompletionComponent extends react__WEBPACK_IMPORTED_MODULE_0___default.a.Component{constructor(...args){var _this;super(...args);_this=this;_defineProperty(this,"state",{currentRequest:null,suggestions:[]});_defineProperty(this,"loadSuggestions",function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(expression,cursorPosition,maxSuggestions){var _this$props$kibana$se;var indexPattern,language,hasQuerySuggestions,suggestions;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:indexPattern=_this.props.indexPattern;language="kuery";hasQuerySuggestions=(_this$props$kibana$se=_this.props.kibana.services.data)===null||_this$props$kibana$se===void 0?void 0:_this$props$kibana$se.autocomplete.hasQuerySuggestions(language);if(hasQuerySuggestions){_context.next=5;break}return _context.abrupt("return");case 5:_this.setState({currentRequest:{expression:expression,cursorPosition:cursorPosition},suggestions:[]});_context.next=8;return _this.props.kibana.services.data.autocomplete.getQuerySuggestions({language:language,query:expression,selectionStart:cursorPosition,selectionEnd:cursorPosition,indexPatterns:[indexPattern],boolFilter:[]});case 8:_context.t0=_context.sent;if(_context.t0){_context.next=11;break}_context.t0=[];case 11:suggestions=_context.t0;_this.setState(state=>state.currentRequest&&state.currentRequest.expression!==expression&&state.currentRequest.cursorPosition!==cursorPosition?state:_objectSpread(_objectSpread({},state),{},{currentRequest:null,suggestions:maxSuggestions?suggestions.slice(0,maxSuggestions):suggestions}));case 13:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2,_x3){return _ref.apply(this,arguments)}}())}render(){const _this$state=this.state,currentRequest=_this$state.currentRequest,suggestions=_this$state.suggestions;return this.props.children({isLoadingSuggestions:currentRequest!==null,loadSuggestions:this.loadSuggestions,suggestions:suggestions})}}const WithKueryAutocompletion=Object(_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_1__["withKibana"])(WithKueryAutocompletionComponent)},158:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return createFormatterForMetric}));var _common_formatters__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(25);var _lib_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24);var _metric_to_format__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(159);const createFormatterForMetric=metric=>{if(metric&&metric.field){const format=Object(_metric_to_format__WEBPACK_IMPORTED_MODULE_2__["a"])(metric);if(format===_lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].bits&&metric.aggregation==="rate"){return Object(_common_formatters__WEBPACK_IMPORTED_MODULE_0__["b"])(_lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].bits,"{{value}}/s")}return Object(_common_formatters__WEBPACK_IMPORTED_MODULE_0__["b"])(format)}return Object(_common_formatters__WEBPACK_IMPORTED_MODULE_0__["b"])(_lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].number)}},159:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return metricToFormat}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var _lib_lib__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(24);const metricToFormat=metric=>{if(metric&&metric.field){const suffix=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["last"])(metric.field.split(/\./));if(suffix==="pct"){return _lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].percent}if(suffix==="bytes"&&metric.aggregation==="rate"){return _lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].bits}if(suffix==="bytes"){return _lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].bytes}}return _lib_lib__WEBPACK_IMPORTED_MODULE_1__["b"].number}},160:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return createMetricLabel}));const createMetricLabel=metric=>{if(metric.label){return metric.label}return"".concat(metric.aggregation,"(").concat(metric.field||"",")")}},164:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return autocomplete_field_AutocompleteField}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(7);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var public_=__webpack_require__(57);var external_kbnSharedDeps_Lodash_=__webpack_require__(4);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const asChildFunctionRenderer=(hoc,{onInitialize:onInitialize,onCleanup:onCleanup}={})=>{var _temp;return hoc((_temp=class ChildFunctionRenderer extends external_kbnSharedDeps_React_default.a.Component{constructor(...args){super(...args);_defineProperty(this,"displayName","ChildFunctionRenderer");_defineProperty(this,"getRendererArgs",()=>Object(external_kbnSharedDeps_Lodash_["omit"])(this.props,["children","initializeOnMount","resetOnUnmount"]))}componentDidMount(){if(this.props.initializeOnMount&&onInitialize){onInitialize(this.getRendererArgs())}}componentWillUnmount(){if(this.props.resetOnUnmount&&onCleanup){onCleanup(this.getRendererArgs())}}render(){return this.props.children(this.getRendererArgs())}},_temp))};function composeStateUpdaters(...updaters){return(state,props)=>updaters.reduce((currentState,updater)=>updater(currentState,props)||currentState,state)}var lib=__webpack_require__(101);var data_public_=__webpack_require__(62);function _templateObject5(){const data=_taggedTemplateLiteral(["\n  flex: 3 0 0;\n\n  p {\n    display: inline;\n\n    span {\n      font-family: ",";\n    }\n  }\n"]);_templateObject5=function _templateObject5(){return data};return data}function _templateObject4(){const data=_taggedTemplateLiteral(["\n  flex: 2 0 0;\n  font-family: ",";\n"]);_templateObject4=function _templateObject4(){return data};return data}function _templateObject3(){const data=_taggedTemplateLiteral(["\n  background-color: ",";\n  color: ",";\n  flex: 0 0 auto;\n  justify-content: center;\n  width: ",";\n"]);_templateObject3=function _templateObject3(){return data};return data}function _templateObject2(){const data=_taggedTemplateLiteral(["\n  align-items: center;\n  cursor: pointer;\n  display: flex;\n  flex-direction: row;\n  height: ",";\n  padding: ",";\n"]);_templateObject2=function _templateObject2(){return data};return data}function _templateObject(){const data=_taggedTemplateLiteral(["\n  display: flex;\n  flex-direction: row;\n  font-size: ",";\n  height: ",";\n  white-space: nowrap;\n  background-color: ",";\n"]);_templateObject=function _templateObject(){return data};return data}function _taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}const SuggestionItem=props=>{const isSelected=props.isSelected,onClick=props.onClick,onMouseEnter=props.onMouseEnter,suggestion=props.suggestion;return external_kbnSharedDeps_React_default.a.createElement(SuggestionItemContainer,{isSelected:isSelected,onClick:onClick,onMouseEnter:onMouseEnter},external_kbnSharedDeps_React_default.a.createElement(SuggestionItemIconField,{suggestionType:suggestion.type},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:getEuiIconType(suggestion.type)})),external_kbnSharedDeps_React_default.a.createElement(SuggestionItemTextField,null,suggestion.text),external_kbnSharedDeps_React_default.a.createElement(SuggestionItemDescriptionField,null,suggestion.description))};SuggestionItem.defaultProps={isSelected:false};const SuggestionItemContainer=public_["euiStyled"].div(_templateObject(),props=>props.theme.eui.euiFontSizeS,props=>props.theme.eui.euiSizeXL,props=>props.isSelected?props.theme.eui.euiColorLightestShade:"transparent");const SuggestionItemField=public_["euiStyled"].div(_templateObject2(),props=>props.theme.eui.euiSizeXL,props=>props.theme.eui.euiSizeXS);const SuggestionItemIconField=Object(public_["euiStyled"])(SuggestionItemField)(_templateObject3(),props=>Object(lib["transparentize"])(.9,getEuiIconColor(props.theme,props.suggestionType)),props=>getEuiIconColor(props.theme,props.suggestionType),props=>props.theme.eui.euiSizeXL);const SuggestionItemTextField=Object(public_["euiStyled"])(SuggestionItemField)(_templateObject4(),props=>props.theme.eui.euiCodeFontFamily);const SuggestionItemDescriptionField=Object(public_["euiStyled"])(SuggestionItemField)(_templateObject5(),props=>props.theme.eui.euiCodeFontFamily);const getEuiIconType=suggestionType=>{switch(suggestionType){case data_public_["QuerySuggestionTypes"].Field:return"kqlField";case data_public_["QuerySuggestionTypes"].Value:return"kqlValue";case data_public_["QuerySuggestionTypes"].RecentSearch:return"search";case data_public_["QuerySuggestionTypes"].Conjunction:return"kqlSelector";case data_public_["QuerySuggestionTypes"].Operator:return"kqlOperand";default:return"empty"}};const getEuiIconColor=(theme,suggestionType)=>{switch(suggestionType){case data_public_["QuerySuggestionTypes"].Field:return theme===null||theme===void 0?void 0:theme.eui.euiColorVis7;case data_public_["QuerySuggestionTypes"].Value:return theme===null||theme===void 0?void 0:theme.eui.euiColorVis0;case data_public_["QuerySuggestionTypes"].Operator:return theme===null||theme===void 0?void 0:theme.eui.euiColorVis1;case data_public_["QuerySuggestionTypes"].Conjunction:return theme===null||theme===void 0?void 0:theme.eui.euiColorVis2;case data_public_["QuerySuggestionTypes"].RecentSearch:default:return theme===null||theme===void 0?void 0:theme.eui.euiColorMediumShade}};function autocomplete_field_templateObject2(){const data=autocomplete_field_taggedTemplateLiteral(["\n  position: absolute;\n  width: 100%;\n  margin-top: 2px;\n  overflow-x: hidden;\n  overflow-y: scroll;\n  z-index: ",";\n  max-height: 322px;\n"]);autocomplete_field_templateObject2=function _templateObject2(){return data};return data}function autocomplete_field_templateObject(){const data=autocomplete_field_taggedTemplateLiteral(["\n  position: relative;\n"]);autocomplete_field_templateObject=function _templateObject(){return data};return data}function autocomplete_field_taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){autocomplete_field_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function autocomplete_field_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class autocomplete_field_AutocompleteField extends external_kbnSharedDeps_React_default.a.Component{constructor(...args){super(...args);autocomplete_field_defineProperty(this,"state",{areSuggestionsVisible:false,isFocused:false,selectedIndex:null});autocomplete_field_defineProperty(this,"inputElement",null);autocomplete_field_defineProperty(this,"handleChangeInputRef",element=>{this.inputElement=element});autocomplete_field_defineProperty(this,"handleChange",evt=>{this.changeValue(evt.currentTarget.value)});autocomplete_field_defineProperty(this,"handleKeyDown",evt=>{const suggestions=this.props.suggestions;switch(evt.key){case"ArrowUp":evt.preventDefault();if(suggestions.length>0){this.setState(composeStateUpdaters(withSuggestionsVisible,withPreviousSuggestionSelected))}break;case"ArrowDown":evt.preventDefault();if(suggestions.length>0){this.setState(composeStateUpdaters(withSuggestionsVisible,withNextSuggestionSelected))}else{this.updateSuggestions()}break;case"Enter":evt.preventDefault();if(this.state.selectedIndex!==null){this.applySelectedSuggestion()}else{this.submit()}break;case"Escape":evt.preventDefault();this.setState(withSuggestionsHidden);break}});autocomplete_field_defineProperty(this,"handleKeyUp",evt=>{switch(evt.key){case"ArrowLeft":case"ArrowRight":case"Home":case"End":this.updateSuggestions();break}});autocomplete_field_defineProperty(this,"handleFocus",()=>{this.setState(composeStateUpdaters(withSuggestionsVisible,withFocused))});autocomplete_field_defineProperty(this,"handleBlur",()=>{this.setState(composeStateUpdaters(withSuggestionsHidden,withUnfocused))});autocomplete_field_defineProperty(this,"selectSuggestionAt",index=>()=>{this.setState(withSuggestionAtIndexSelected(index))});autocomplete_field_defineProperty(this,"applySelectedSuggestion",()=>{if(this.state.selectedIndex!==null){this.applySuggestionAt(this.state.selectedIndex)()}});autocomplete_field_defineProperty(this,"applySuggestionAt",index=>()=>{const _this$props=this.props,value=_this$props.value,suggestions=_this$props.suggestions;const selectedSuggestion=suggestions[index];if(!selectedSuggestion){return}const newValue=value.substr(0,selectedSuggestion.start)+selectedSuggestion.text+value.substr(selectedSuggestion.end);this.setState(withSuggestionsHidden);this.changeValue(newValue);this.focusInputElement()});autocomplete_field_defineProperty(this,"changeValue",value=>{const onChange=this.props.onChange;if(onChange){onChange(value)}});autocomplete_field_defineProperty(this,"focusInputElement",()=>{if(this.inputElement){this.inputElement.focus()}});autocomplete_field_defineProperty(this,"showSuggestions",()=>{this.setState(withSuggestionsVisible)});autocomplete_field_defineProperty(this,"submit",()=>{const _this$props2=this.props,isValid=_this$props2.isValid,onSubmit=_this$props2.onSubmit,value=_this$props2.value;if(isValid&&onSubmit){onSubmit(value)}this.setState(withSuggestionsHidden)});autocomplete_field_defineProperty(this,"updateSuggestions",()=>{const inputCursorPosition=this.inputElement?this.inputElement.selectionStart||0:0;this.props.loadSuggestions(this.props.value,inputCursorPosition,200)})}render(){const _this$props3=this.props,suggestions=_this$props3.suggestions,isLoadingSuggestions=_this$props3.isLoadingSuggestions,isValid=_this$props3.isValid,placeholder=_this$props3.placeholder,value=_this$props3.value,disabled=_this$props3.disabled,ariaLabel=_this$props3["aria-label"];const _this$state=this.state,areSuggestionsVisible=_this$state.areSuggestionsVisible,selectedIndex=_this$state.selectedIndex;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOutsideClickDetector"],{onOutsideClick:this.handleBlur},external_kbnSharedDeps_React_default.a.createElement(AutocompleteContainer,null,external_kbnSharedDeps_React_default.a.createElement(FixedEuiFieldSearch,{fullWidth:true,disabled:disabled,inputRef:this.handleChangeInputRef,isLoading:isLoadingSuggestions,isInvalid:!isValid,onChange:this.handleChange,onFocus:this.handleFocus,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onSearch:this.submit,placeholder:placeholder,value:value,"aria-label":ariaLabel}),areSuggestionsVisible&&!isLoadingSuggestions&&suggestions.length>0?external_kbnSharedDeps_React_default.a.createElement(SuggestionsPanel,null,suggestions.map((suggestion,suggestionIndex)=>external_kbnSharedDeps_React_default.a.createElement(SuggestionItem,{key:suggestion.text,suggestion:suggestion,isSelected:suggestionIndex===selectedIndex,onMouseEnter:this.selectSuggestionAt(suggestionIndex),onClick:this.applySuggestionAt(suggestionIndex)}))):null))}componentDidMount(){if(this.inputElement&&this.props.autoFocus){this.inputElement.focus()}}componentDidUpdate(prevProps){const hasNewValue=prevProps.value!==this.props.value;const hasNewSuggestions=prevProps.suggestions!==this.props.suggestions;if(hasNewValue){this.updateSuggestions()}if(hasNewValue&&this.props.value===""){this.submit()}if(hasNewSuggestions&&this.state.isFocused){this.showSuggestions()}}}const withPreviousSuggestionSelected=(state,props)=>_objectSpread(_objectSpread({},state),{},{selectedIndex:props.suggestions.length===0?null:state.selectedIndex!==null?(state.selectedIndex+props.suggestions.length-1)%props.suggestions.length:Math.max(props.suggestions.length-1,0)});const withNextSuggestionSelected=(state,props)=>_objectSpread(_objectSpread({},state),{},{selectedIndex:props.suggestions.length===0?null:state.selectedIndex!==null?(state.selectedIndex+1)%props.suggestions.length:0});const withSuggestionAtIndexSelected=suggestionIndex=>(state,props)=>_objectSpread(_objectSpread({},state),{},{selectedIndex:props.suggestions.length===0?null:suggestionIndex>=0&&suggestionIndex<props.suggestions.length?suggestionIndex:0});const withSuggestionsVisible=state=>_objectSpread(_objectSpread({},state),{},{areSuggestionsVisible:true});const withSuggestionsHidden=state=>_objectSpread(_objectSpread({},state),{},{areSuggestionsVisible:false,selectedIndex:null});const withFocused=state=>_objectSpread(_objectSpread({},state),{},{isFocused:true});const withUnfocused=state=>_objectSpread(_objectSpread({},state),{},{isFocused:false});const FixedEuiFieldSearch=external_kbnSharedDeps_ElasticEui_["EuiFieldSearch"];const AutocompleteContainer=public_["euiStyled"].div(autocomplete_field_templateObject());const SuggestionsPanel=Object(public_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiPanel"]).attrs(()=>({paddingSize:"none",hasShadow:true}))(autocomplete_field_templateObject2(),props=>props.theme.eui.euiZLevel1)},198:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return MetricsExplorerGroupBy}));var _elastic_eui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7);var _elastic_eui__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__);var react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2);var react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__);const MetricsExplorerGroupBy=({options:options,onChange:onChange,fields:fields})=>{const handleChange=Object(react__WEBPACK_IMPORTED_MODULE_2__["useCallback"])(selectedOptions=>{const groupBy=selectedOptions.map(option=>option.label);onChange(groupBy)},[onChange]);const selectedOptions=Array.isArray(options.groupBy)?options.groupBy.map(field=>({label:field})):options.groupBy?[{label:options.groupBy}]:[];return react__WEBPACK_IMPORTED_MODULE_2___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__["EuiComboBox"],{placeholder:_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.infra.metricsExplorer.groupByLabel",{defaultMessage:"Everything"}),"aria-label":_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.infra.metricsExplorer.groupByAriaLabel",{defaultMessage:"Graph per"}),fullWidth:true,singleSelection:false,selectedOptions:selectedOptions,options:fields.filter(f=>f.aggregatable&&f.type==="string").map(f=>({label:f.name})),onChange:handleChange,isClearable:true})}},199:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useMetricsExplorerData}));var _elastic_datemath__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(95);var _elastic_datemath__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_datemath__WEBPACK_IMPORTED_MODULE_0__);var lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4);var lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);var react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2);var react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_2__);var _common_http_api_metrics_explorer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(93);var _utils_kuery__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(99);var _src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8);var _src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_5__);var _common_runtime_types__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function isSameOptions(current,next){return Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isEqual"])(current,next)}function useMetricsExplorerData(options,source,derivedIndexPattern,timerange,afterKey,signal,fetch,shouldLoadImmediately=true){var _kibana$services$http;const kibana=Object(_src_plugins_kibana_react_public__WEBPACK_IMPORTED_MODULE_5__["useKibana"])();const fetchFn=fetch?fetch:(_kibana$services$http=kibana.services.http)===null||_kibana$services$http===void 0?void 0:_kibana$services$http.fetch;const _useState=Object(react__WEBPACK_IMPORTED_MODULE_2__["useState"])(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];const _useState3=Object(react__WEBPACK_IMPORTED_MODULE_2__["useState"])(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];const _useState5=Object(react__WEBPACK_IMPORTED_MODULE_2__["useState"])(null),_useState6=_slicedToArray(_useState5,2),data=_useState6[0],setData=_useState6[1];const _useState7=Object(react__WEBPACK_IMPORTED_MODULE_2__["useState"])(null),_useState8=_slicedToArray(_useState7,2),lastOptions=_useState8[0],setLastOptions=_useState8[1];const _useState9=Object(react__WEBPACK_IMPORTED_MODULE_2__["useState"])(null),_useState10=_slicedToArray(_useState9,2),lastTimerange=_useState10[0],setLastTimerange=_useState10[1];const loadData=Object(react__WEBPACK_IMPORTED_MODULE_2__["useCallback"])(()=>{_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var from,to,response,series;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setLoading(true);_context.prev=1;from=_elastic_datemath__WEBPACK_IMPORTED_MODULE_0___default.a.parse(timerange.from);to=_elastic_datemath__WEBPACK_IMPORTED_MODULE_0___default.a.parse(timerange.to,{roundUp:true});if(!(!from||!to)){_context.next=6;break}throw new Error("Unalble to parse timerange");case 6:if(fetchFn){_context.next=8;break}throw new Error("HTTP service is unavailable");case 8:if(source){_context.next=10;break}throw new Error("Source is unavailable");case 10:_context.t0=Object(_common_runtime_types__WEBPACK_IMPORTED_MODULE_6__["b"])(_common_http_api_metrics_explorer__WEBPACK_IMPORTED_MODULE_3__["e"]);_context.next=13;return fetchFn("/api/infra/metrics_explorer",{method:"POST",body:JSON.stringify({forceInterval:options.forceInterval,dropLastBucket:options.dropLastBucket!=null?options.dropLastBucket:true,metrics:options.aggregation==="count"?[{aggregation:"count"}]:options.metrics.map(metric=>({aggregation:metric.aggregation,field:metric.field})),groupBy:options.groupBy,afterKey:afterKey,limit:options.limit,indexPattern:source.metricAlias,filterQuery:options.filterQuery&&Object(_utils_kuery__WEBPACK_IMPORTED_MODULE_4__["a"])(options.filterQuery,derivedIndexPattern)||void 0,timerange:_objectSpread(_objectSpread({},timerange),{},{field:source.fields.timestamp,from:from.valueOf(),to:to.valueOf()})})});case 13:_context.t1=_context.sent;response=(0,_context.t0)(_context.t1);if(response){if(data&&lastOptions&&data.pageInfo.afterKey!==response.pageInfo.afterKey&&isSameOptions(lastOptions,options)&&Object(lodash__WEBPACK_IMPORTED_MODULE_1__["isEqual"])(timerange,lastTimerange)&&afterKey){series=data.series;setData(_objectSpread(_objectSpread({},response),{},{series:[...series,...response.series]}))}else{setData(response)}setLastOptions(options);setLastTimerange(timerange);setError(null)}_context.next=21;break;case 18:_context.prev=18;_context.t2=_context["catch"](1);setError(_context.t2);case 21:setLoading(false);case 22:case"end":return _context.stop()}}),_callee,null,[[1,18]])})))()},[options,source,timerange,signal,afterKey]);Object(react__WEBPACK_IMPORTED_MODULE_2__["useEffect"])(()=>{if(!shouldLoadImmediately){return}loadData()},[loadData,shouldLoadImmediately]);return{error:error,loading:loading,data:data,loadData:loadData}}},205:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AlertPreview}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var external_kbnSharedDeps_Lodash_=__webpack_require__(4);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(7);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(12);var formatters=__webpack_require__(25);var get_interval_in_seconds=__webpack_require__(201);var metrics=__webpack_require__(132);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function getAlertPreview(_x){return _getAlertPreview.apply(this,arguments)}function _getAlertPreview(){_getAlertPreview=_asyncToGenerator(regeneratorRuntime.mark((function _callee({fetch:fetch,params:params,alertType:alertType}){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch("".concat(metrics["c"]),{method:"POST",body:JSON.stringify(_objectSpread(_objectSpread({},params),{},{alertType:alertType}))});case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}),_callee)})));return _getAlertPreview.apply(this,arguments)}function alert_preview_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function alert_preview_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){alert_preview_ownKeys(Object(source),true).forEach((function(key){alert_preview_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{alert_preview_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function alert_preview_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function alert_preview_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const AlertPreview=props=>{var _previewOptions$find,_previewError$body;const alertParams=props.alertParams,alertInterval=props.alertInterval,alertThrottle=props.alertThrottle,fetch=props.fetch,alertType=props.alertType,validate=props.validate,showNoDataResults=props.showNoDataResults,groupByDisplayName=props.groupByDisplayName;const _useState=Object(external_kbnSharedDeps_React_["useState"])("h"),_useState2=_slicedToArray(_useState,2),previewLookbackInterval=_useState2[0],setPreviewLookbackInterval=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])(false),_useState4=_slicedToArray(_useState3,2),isPreviewLoading=_useState4[0],setIsPreviewLoading=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(false),_useState6=_slicedToArray(_useState5,2),previewError=_useState6[0],setPreviewError=_useState6[1];const _useState7=Object(external_kbnSharedDeps_React_["useState"])(null),_useState8=_slicedToArray(_useState7,2),previewResult=_useState8[0],setPreviewResult=_useState8[1];const onSelectPreviewLookbackInterval=Object(external_kbnSharedDeps_React_["useCallback"])(e=>{setPreviewLookbackInterval(e.target.value)},[]);const onClickPreview=Object(external_kbnSharedDeps_React_["useCallback"])(alert_preview_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var result;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setIsPreviewLoading(true);setPreviewResult(null);setPreviewError(false);_context.prev=3;_context.next=6;return getAlertPreview({fetch:fetch,params:alert_preview_objectSpread(alert_preview_objectSpread({},alertParams),{},{lookback:previewLookbackInterval,alertInterval:alertInterval,alertThrottle:alertThrottle,alertOnNoData:showNoDataResults!==null&&showNoDataResults!==void 0?showNoDataResults:false}),alertType:alertType});case 6:result=_context.sent;setPreviewResult(alert_preview_objectSpread(alert_preview_objectSpread({},result),{},{groupByDisplayName:groupByDisplayName,previewLookbackInterval:previewLookbackInterval,alertThrottle:alertThrottle}));_context.next=13;break;case 10:_context.prev=10;_context.t0=_context["catch"](3);setPreviewError(_context.t0);case 13:_context.prev=13;setIsPreviewLoading(false);return _context.finish(13);case 16:case"end":return _context.stop()}}),_callee,null,[[3,10,13,16]])}))),[alertParams,alertInterval,fetch,alertType,groupByDisplayName,previewLookbackInterval,alertThrottle,showNoDataResults]);const previewIntervalError=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const intervalInSeconds=Object(get_interval_in_seconds["a"])(alertInterval);const lookbackInSeconds=Object(get_interval_in_seconds["a"])("1".concat(previewLookbackInterval));if(intervalInSeconds>=lookbackInSeconds){return true}return false},[previewLookbackInterval,alertInterval]);const isPreviewDisabled=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const validationResult=validate({criteria:alertParams.criteria});const hasValidationErrors=Object.values(validationResult.errors).some(result=>Object.values(result).some(arr=>Array.isArray(arr)&&arr.length));return hasValidationErrors||previewIntervalError},[alertParams.criteria,previewIntervalError,validate]);const showNumberOfNotifications=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(!previewResult)return false;const _previewResult$result=previewResult.resultTotals,notifications=_previewResult$result.notifications,fired=_previewResult$result.fired,noData=_previewResult$result.noData,error=_previewResult$result.error;const unthrottledNotifications=fired+(showNoDataResults?noData+error:0);return unthrottledNotifications>notifications},[previewResult,showNoDataResults]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.previewLabel",{defaultMessage:"Preview"}),fullWidth:true,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{id:"selectPreviewLookbackInterval",value:previewLookbackInterval,onChange:onSelectPreviewLookbackInterval,options:previewDOMOptions})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isLoading:isPreviewLoading,isDisabled:isPreviewDisabled,onClick:onClickPreview},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.testAlertCondition",{defaultMessage:"Test alert condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),previewResult&&!previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewResult",defaultMessage:"There were {firedTimes}",values:{firedTimes:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.firedTimes",defaultMessage:"{fired, plural, one {# instance} other {# instances}}",values:{fired:previewResult.resultTotals.fired}}))}})," ",previewResult.groupByDisplayName?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroupsAcross",defaultMessage:"across"})," ",external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroups",defaultMessage:"{numberOfGroups, plural, one {# {groupName}} other {# {groupName}s}}",values:{numberOfGroups:previewResult.numberOfGroups,groupName:previewResult.groupByDisplayName}}))," "):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewResultLookback",defaultMessage:"that satisfied the conditions of this alert in the last {lookback}.",values:{lookback:(_previewOptions$find=previewOptions.find(e=>e.value===previewResult.previewLookbackInterval))===null||_previewOptions$find===void 0?void 0:_previewOptions$find.shortText}}))},showNoDataResults&&previewResult.resultTotals.noData?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewNoDataResult",defaultMessage:"There {boldedResultsNumber} of no data.",values:{boldedResultsNumber:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertPreviewNoDataResultNumber",{defaultMessage:"{noData, plural, one {was # result} other {were # results}}",values:{noData:previewResult.resultTotals.noData}}))}}):null," ",previewResult.resultTotals.error?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorResult",defaultMessage:"An error occurred when trying to evaluate some of the data."}):null,showNumberOfNotifications?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewTotalNotifications",defaultMessage:'As a result, this alert would have sent {notifications} based on the selected "notify every" setting of "{alertThrottle}."',values:{alertThrottle:previewResult.alertThrottle,notifications:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertPreviewTotalNotificationsNumber",{defaultMessage:"{notifs, plural, one {# notification} other {# notifications}}",values:{notifs:previewResult.resultTotals.notifications}}))}})):null," ")),previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortTitle",defaultMessage:"Not enough data"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortDescription",defaultMessage:"Try selecting a longer preview length, or increase the amount of time in the {checkEvery} field.",values:{checkEvery:external_kbnSharedDeps_React_default.a.createElement("strong",null,"check every")}}))),previewError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),((_previewError$body=previewError.body)===null||_previewError$body===void 0?void 0:_previewError$body.statusCode)===508?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorTitle",defaultMessage:"Too much data (>{maxBuckets} results)",values:{maxBuckets:formatters["a"].number(previewError.body.message)}}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorDescription",defaultMessage:"Try selecting a shorter preview length, or increase the amount of time in the {forTheLast} field.",values:{forTheLast:external_kbnSharedDeps_React_default.a.createElement("strong",null,"FOR THE LAST")}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewError",defaultMessage:"An error occurred when trying to preview this alert condition"}),color:"danger",iconType:"alert"},previewError.body&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorDesc",defaultMessage:"Please try again later or see details for more information."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"alertErrorDetailsAccordion",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.errorDetails",defaultMessage:"Details"})))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],null,previewError.body.message)))))))};const previewOptions=[{value:"h",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"})},{value:"d",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"})},{value:"w",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"})},{value:"M",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})}];const previewDOMOptions=previewOptions.map(o=>Object(external_kbnSharedDeps_Lodash_["omit"])(o,"shortText"));const common_previewOptions=[{value:"h",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"})},{value:"d",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"})},{value:"w",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"})},{value:"M",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})}]},497:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"defaultExpression",(function(){return defaultExpression}));__webpack_require__.d(__webpack_exports__,"Expressions",(function(){return Expressions}));var external_kbnSharedDeps_Lodash_=__webpack_require__(4);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(7);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(12);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var common=__webpack_require__(205);var metrics=__webpack_require__(132);var common_=__webpack_require__(66);var kuery_bar=__webpack_require__(197);var group_by=__webpack_require__(198);var use_source_via_http=__webpack_require__(170);var kuery=__webpack_require__(99);const correctedPctConvert=(v,decimalToPct)=>{const replacementPattern=decimalToPct?new RegExp(/0?\./):".";const numberOfDigits=String(v).replace(replacementPattern,"").length;const multipliedValue=decimalToPct?v*100:v/100;return parseFloat(multipliedValue.toPrecision(numberOfDigits))};const decimalToPct=v=>correctedPctConvert(v,true);const pctToDecimal=v=>correctedPctConvert(v,false);var public_=__webpack_require__(57);let AGGREGATION_TYPES;(function(AGGREGATION_TYPES){AGGREGATION_TYPES["COUNT"]="count";AGGREGATION_TYPES["AVERAGE"]="avg";AGGREGATION_TYPES["SUM"]="sum";AGGREGATION_TYPES["MIN"]="min";AGGREGATION_TYPES["MAX"]="max";AGGREGATION_TYPES["RATE"]="rate";AGGREGATION_TYPES["CARDINALITY"]="cardinality";AGGREGATION_TYPES["P95"]="p95";AGGREGATION_TYPES["P99"]="p99"})(AGGREGATION_TYPES||(AGGREGATION_TYPES={}));var types=__webpack_require__(15);var constants_=__webpack_require__(75);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _templateObject2(){const data=_taggedTemplateLiteral(["\n  padding: 0 4px;\n"]);_templateObject2=function _templateObject2(){return data};return data}function _templateObject(){const data=_taggedTemplateLiteral(["\n  display: flex;\n  flex-wrap: wrap;\n  margin: 0 -4px;\n"]);_templateObject=function _templateObject(){return data};return data}function _taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const customComparators=_objectSpread(_objectSpread({},constants_["builtInComparators"]),{},{[types["a"].OUTSIDE_RANGE]:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.outsideRangeLabel",{defaultMessage:"Is not between"}),value:types["a"].OUTSIDE_RANGE,requiredValues:2}});const StyledExpressionRow=Object(public_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"])(_templateObject());const StyledExpression=public_["euiStyled"].div(_templateObject2());const ExpressionRow=props=>{const _useState=Object(external_kbnSharedDeps_React_["useState"])(true),_useState2=_slicedToArray(_useState,2),isExpanded=_useState2[0],setRowState=_useState2[1];const toggleRowState=Object(external_kbnSharedDeps_React_["useCallback"])(()=>setRowState(!isExpanded),[isExpanded]);const children=props.children,setAlertParams=props.setAlertParams,expression=props.expression,errors=props.errors,expressionId=props.expressionId,remove=props.remove,fields=props.fields,canDelete=props.canDelete;const _expression$aggType=expression.aggType,aggType=_expression$aggType===void 0?AGGREGATION_TYPES.MAX:_expression$aggType,metric=expression.metric,_expression$comparato=expression.comparator,comparator=_expression$comparato===void 0?types["a"].GT:_expression$comparato,_expression$threshold=expression.threshold,threshold=_expression$threshold===void 0?[]:_expression$threshold;const isMetricPct=Object(external_kbnSharedDeps_React_["useMemo"])(()=>metric&&metric.endsWith(".pct"),[metric]);const updateAggType=Object(external_kbnSharedDeps_React_["useCallback"])(at=>{setAlertParams(expressionId,_objectSpread(_objectSpread({},expression),{},{aggType:at,metric:at==="count"?undefined:expression.metric}))},[expressionId,expression,setAlertParams]);const updateMetric=Object(external_kbnSharedDeps_React_["useCallback"])(m=>{setAlertParams(expressionId,_objectSpread(_objectSpread({},expression),{},{metric:m}))},[expressionId,expression,setAlertParams]);const updateComparator=Object(external_kbnSharedDeps_React_["useCallback"])(c=>{setAlertParams(expressionId,_objectSpread(_objectSpread({},expression),{},{comparator:c}))},[expressionId,expression,setAlertParams]);const updateThreshold=Object(external_kbnSharedDeps_React_["useCallback"])(enteredThreshold=>{const t=isMetricPct?enteredThreshold.map(v=>pctToDecimal(v)):enteredThreshold;if(t.join()!==expression.threshold.join()){setAlertParams(expressionId,_objectSpread(_objectSpread({},expression),{},{threshold:t}))}},[expressionId,expression,isMetricPct,setAlertParams]);const displayedThreshold=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(isMetricPct)return threshold.map(v=>decimalToPct(v));return threshold},[threshold,isMetricPct]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:isExpanded?"arrowDown":"arrowRight",onClick:toggleRowState,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.expandRowLabel",{defaultMessage:"Expand row."})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true},external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(common_["WhenExpression"],{customAggTypesOptions:aggregationType,aggType:aggType,onChangeSelectedAggType:updateAggType})),aggType!=="count"&&external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(common_["OfExpression"],{customAggTypesOptions:aggregationType,aggField:metric,fields:fields.map(f=>({normalizedType:f.type,name:f.name})),aggType:aggType,errors:errors,onChangeSelectedAggField:updateMetric})),external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(common_["ThresholdExpression"],{thresholdComparator:comparator||types["a"].GT,threshold:displayedThreshold,customComparators:customComparators,onChangeSelectedThresholdComparator:updateComparator,onChangeSelectedThreshold:updateThreshold,errors:errors})),isMetricPct&&external_kbnSharedDeps_React_default.a.createElement("div",{style:{alignSelf:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},"%")))),canDelete&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>remove(expressionId)}))),isExpanded?external_kbnSharedDeps_React_default.a.createElement("div",{style:{padding:"0 0 0 28px"}},children):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))};const aggregationType={avg:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.avg",{defaultMessage:"Average"}),fieldRequired:true,validNormalizedTypes:["number"],value:AGGREGATION_TYPES.AVERAGE},max:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.max",{defaultMessage:"Max"}),fieldRequired:true,validNormalizedTypes:["number","date"],value:AGGREGATION_TYPES.MAX},min:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.min",{defaultMessage:"Min"}),fieldRequired:true,validNormalizedTypes:["number","date"],value:AGGREGATION_TYPES.MIN},cardinality:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.cardinality",{defaultMessage:"Cardinality"}),fieldRequired:false,value:AGGREGATION_TYPES.CARDINALITY,validNormalizedTypes:["number"]},rate:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.rate",{defaultMessage:"Rate"}),fieldRequired:false,value:AGGREGATION_TYPES.RATE,validNormalizedTypes:["number"]},count:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.count",{defaultMessage:"Document count"}),fieldRequired:false,value:AGGREGATION_TYPES.COUNT,validNormalizedTypes:["number"]},sum:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.sum",{defaultMessage:"Sum"}),fieldRequired:false,value:AGGREGATION_TYPES.SUM,validNormalizedTypes:["number"]},p95:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.p95",{defaultMessage:"95th Percentile"}),fieldRequired:false,value:AGGREGATION_TYPES.P95,validNormalizedTypes:["number"]},p99:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.aggregationText.p99",{defaultMessage:"99th Percentile"}),fieldRequired:false,value:AGGREGATION_TYPES.P99,validNormalizedTypes:["number"]}};var external_kbnSharedDeps_ElasticCharts_=__webpack_require__(61);var external_kbnSharedDeps_Moment_=__webpack_require__(58);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);var color_palette=__webpack_require__(85);var series_chart=__webpack_require__(123);var use_metrics_explorer_options=__webpack_require__(88);var get_chart_theme=__webpack_require__(112);var create_formatter_for_metric=__webpack_require__(158);var calculate_domain=__webpack_require__(125);var use_metrics_explorer_data=__webpack_require__(199);const useMetricsExplorerChartData=(expression,context,derivedIndexPattern,source,filterQuery,groupBy)=>{const _ref=expression||{timeSize:1,timeUnit:"m"},timeSize=_ref.timeSize,timeUnit=_ref.timeUnit;const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({limit:1,forceInterval:true,dropLastBucket:false,groupBy:groupBy,filterQuery:filterQuery,metrics:[{field:expression.metric,aggregation:expression.aggType}],aggregation:expression.aggType||"avg"}),[expression.aggType,expression.metric,filterQuery,groupBy]);const timerange=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({interval:">=".concat(timeSize||1).concat(timeUnit),from:"now-".concat((timeSize||1)*20).concat(timeUnit),to:"now"}),[timeSize,timeUnit]);return Object(use_metrics_explorer_data["a"])(options,source===null||source===void 0?void 0:source.configuration,derivedIndexPattern,timerange,null,null,context.http.fetch)};var get_metric_id=__webpack_require__(124);function expression_chart_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function expression_chart_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){expression_chart_ownKeys(Object(source),true).forEach((function(key){expression_chart_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{expression_chart_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function expression_chart_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const tooltipProps={headerFormatter:tooltipValue=>external_kbnSharedDeps_Moment_default()(tooltipValue.value).format("Y-MM-DD HH:mm:ss.SSS")};const TIME_LABELS={s:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alerts.timeLabels.seconds",{defaultMessage:"seconds"}),m:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alerts.timeLabels.minutes",{defaultMessage:"minutes"}),h:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alerts.timeLabels.hours",{defaultMessage:"hours"}),d:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alerts.timeLabels.days",{defaultMessage:"days"})};const ExpressionChart=({expression:expression,context:context,derivedIndexPattern:derivedIndexPattern,source:source,filterQuery:filterQuery,groupBy:groupBy})=>{var _context$uiSettings;const _useMetricsExplorerCh=useMetricsExplorerChartData(expression,context,derivedIndexPattern,source,filterQuery,groupBy),loading=_useMetricsExplorerCh.loading,data=_useMetricsExplorerCh.data;const metric={field:expression.metric,aggregation:expression.aggType,color:color_palette["a"].color0};const isDarkMode=((_context$uiSettings=context.uiSettings)===null||_context$uiSettings===void 0?void 0:_context$uiSettings.get("theme:darkMode"))||false;const dateFormatter=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _first,_last;const firstSeries=Object(external_kbnSharedDeps_Lodash_["first"])(data===null||data===void 0?void 0:data.series);const firstTimestamp=(_first=Object(external_kbnSharedDeps_Lodash_["first"])(firstSeries===null||firstSeries===void 0?void 0:firstSeries.rows))===null||_first===void 0?void 0:_first.timestamp;const lastTimestamp=(_last=Object(external_kbnSharedDeps_Lodash_["last"])(firstSeries===null||firstSeries===void 0?void 0:firstSeries.rows))===null||_last===void 0?void 0:_last.timestamp;if(firstTimestamp==null||lastTimestamp==null){return value=>"".concat(value)}return Object(external_kbnSharedDeps_ElasticCharts_["niceTimeFormatter"])([firstTimestamp,lastTimestamp])},[data===null||data===void 0?void 0:data.series]);const yAxisFormater=Object(external_kbnSharedDeps_React_["useCallback"])(Object(create_formatter_for_metric["a"])(metric),[expression]);if(loading||!data){return external_kbnSharedDeps_React_default.a.createElement(EmptyContainer,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alerts.loadingMessage",defaultMessage:"Loading"})))}const thresholds=expression.threshold.slice().sort();const firstSeries=Object(external_kbnSharedDeps_Lodash_["first"])(data.series);if(!firstSeries||!firstSeries.rows||firstSeries.rows.length===0){return external_kbnSharedDeps_React_default.a.createElement(EmptyContainer,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued","data-test-subj":"noChartData"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alerts.noDataMessage",defaultMessage:"Oops, no chart data available"})))}const series=expression_chart_objectSpread(expression_chart_objectSpread({},firstSeries),{},{rows:firstSeries.rows.map(row=>{const newRow=expression_chart_objectSpread({},row);thresholds.forEach((thresholdValue,index)=>{newRow[Object(get_metric_id["a"])(metric,"threshold_".concat(index))]=thresholdValue});return newRow})});const firstTimestamp=Object(external_kbnSharedDeps_Lodash_["first"])(firstSeries.rows).timestamp;const lastTimestamp=Object(external_kbnSharedDeps_Lodash_["last"])(firstSeries.rows).timestamp;const dataDomain=Object(calculate_domain["a"])(series,[metric],false);const domain={max:Math.max(dataDomain.max,Object(external_kbnSharedDeps_Lodash_["last"])(thresholds)||dataDomain.max)*1.1,min:Math.min(dataDomain.min,Object(external_kbnSharedDeps_Lodash_["first"])(thresholds)||dataDomain.min)};if(domain.min===Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold)){domain.min=domain.min*.9}const isAbove=[types["a"].GT,types["a"].GT_OR_EQ].includes(expression.comparator);const isBelow=[types["a"].LT,types["a"].LT_OR_EQ].includes(expression.comparator);const opacity=.3;const timeSize=expression.timeSize,timeUnit=expression.timeUnit;const timeLabel=TIME_LABELS[timeUnit];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ChartContainer,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],null,external_kbnSharedDeps_React_default.a.createElement(series_chart["a"],{type:use_metrics_explorer_options["b"].bar,metric:metric,id:"0",series:series,stack:false}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineAnnotation"],{id:"thresholds",domainType:external_kbnSharedDeps_ElasticCharts_["AnnotationDomainTypes"].YDomain,dataValues:thresholds.map(threshold=>({dataValue:threshold})),style:{line:{strokeWidth:2,stroke:Object(color_palette["b"])(color_palette["a"].color1),opacity:1}}}),thresholds.length===2&&expression.comparator===types["a"].BETWEEN?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:"lower-threshold",style:{fill:Object(color_palette["b"])(color_palette["a"].color1),opacity:opacity},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold),y1:Object(external_kbnSharedDeps_Lodash_["last"])(expression.threshold)}}]})):null,thresholds.length===2&&expression.comparator===types["a"].OUTSIDE_RANGE?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:"lower-threshold",style:{fill:Object(color_palette["b"])(color_palette["a"].color1),opacity:opacity},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:domain.min,y1:Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold)}}]}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:"upper-threshold",style:{fill:Object(color_palette["b"])(color_palette["a"].color1),opacity:opacity},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(external_kbnSharedDeps_Lodash_["last"])(expression.threshold),y1:domain.max}}]})):null,isBelow&&Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold)!=null?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:"upper-threshold",style:{fill:Object(color_palette["b"])(color_palette["a"].color1),opacity:opacity},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:domain.min,y1:Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold)}}]}):null,isAbove&&Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold)!=null?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:"upper-threshold",style:{fill:Object(color_palette["b"])(color_palette["a"].color1),opacity:opacity},dataValues:[{coordinates:{x0:firstTimestamp,x1:lastTimestamp,y0:Object(external_kbnSharedDeps_Lodash_["first"])(expression.threshold),y1:domain.max}}]}):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"timestamp",position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,showOverlappingTicks:true,tickFormat:dateFormatter}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"values",position:external_kbnSharedDeps_ElasticCharts_["Position"].Left,tickFormat:yAxisFormater,domain:domain}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{tooltip:tooltipProps,theme:Object(get_chart_theme["a"])(isDarkMode)}))),external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},series.id!=="ALL"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alerts.dataTimeRangeLabelWithGrouping",defaultMessage:"Last {lookback} {timeLabel} of data for {id}",values:{id:series.id,timeLabel:timeLabel,lookback:timeSize*20}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alerts.dataTimeRangeLabel",defaultMessage:"Last {lookback} {timeLabel}",values:{timeLabel:timeLabel,lookback:timeSize*20}}))))};const EmptyContainer=({children:children})=>external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"100%",height:150,display:"flex",justifyContent:"center",alignItems:"center"}},children);const ChartContainer=({children:children})=>external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"100%",height:150}},children);var validation=__webpack_require__(31);function expression_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function expression_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){expression_ownKeys(Object(source),true).forEach((function(key){expression_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{expression_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function expression_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function expression_slicedToArray(arr,i){return expression_arrayWithHoles(arr)||expression_iterableToArrayLimit(arr,i)||expression_unsupportedIterableToArray(arr,i)||expression_nonIterableRest()}function expression_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function expression_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return expression_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return expression_arrayLikeToArray(o,minLen)}function expression_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function expression_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function expression_arrayWithHoles(arr){if(Array.isArray(arr))return arr}const FILTER_TYPING_DEBOUNCE_MS=500;const defaultExpression={aggType:metrics["a"].AVERAGE,comparator:metrics["b"].GT,threshold:[],timeSize:1,timeUnit:"m"};const Expressions=props=>{const setAlertParams=props.setAlertParams,alertParams=props.alertParams,errors=props.errors,alertsContext=props.alertsContext,alertInterval=props.alertInterval,alertThrottle=props.alertThrottle;const _useSourceViaHttp=Object(use_source_via_http["a"])({sourceId:"default",type:"metrics",fetch:alertsContext.http.fetch,toastWarning:alertsContext.toastNotifications.addWarning}),source=_useSourceViaHttp.source,createDerivedIndexPattern=_useSourceViaHttp.createDerivedIndexPattern;const _useState=Object(external_kbnSharedDeps_React_["useState"])(1),_useState2=expression_slicedToArray(_useState,2),timeSize=_useState2[0],setTimeSize=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])("m"),_useState4=expression_slicedToArray(_useState3,2),timeUnit=_useState4[0],setTimeUnit=_useState4[1];const derivedIndexPattern=Object(external_kbnSharedDeps_React_["useMemo"])(()=>createDerivedIndexPattern("metrics"),[createDerivedIndexPattern]);const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _alertsContext$metada,_alertsContext$metada2;if((_alertsContext$metada=alertsContext.metadata)===null||_alertsContext$metada===void 0?void 0:(_alertsContext$metada2=_alertsContext$metada.currentOptions)===null||_alertsContext$metada2===void 0?void 0:_alertsContext$metada2.metrics){return alertsContext.metadata.currentOptions}else{return{metrics:[],aggregation:"avg"}}},[alertsContext.metadata]);const updateParams=Object(external_kbnSharedDeps_React_["useCallback"])((id,e)=>{const exp=alertParams.criteria?alertParams.criteria.slice():[];exp[id]=expression_objectSpread(expression_objectSpread({},exp[id]),e);setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria]);const addExpression=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{var _alertParams$criteria;const exp=((_alertParams$criteria=alertParams.criteria)===null||_alertParams$criteria===void 0?void 0:_alertParams$criteria.slice())||[];exp.push(expression_objectSpread(expression_objectSpread({},defaultExpression),{},{timeSize:timeSize!==null&&timeSize!==void 0?timeSize:defaultExpression.timeSize,timeUnit:timeUnit!==null&&timeUnit!==void 0?timeUnit:defaultExpression.timeUnit}));setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria,timeSize,timeUnit]);const removeExpression=Object(external_kbnSharedDeps_React_["useCallback"])(id=>{var _alertParams$criteria2;const exp=((_alertParams$criteria2=alertParams.criteria)===null||_alertParams$criteria2===void 0?void 0:_alertParams$criteria2.slice())||[];if(exp.length>1){exp.splice(id,1);setAlertParams("criteria",exp)}},[setAlertParams,alertParams.criteria]);const onFilterChange=Object(external_kbnSharedDeps_React_["useCallback"])(filter=>{setAlertParams("filterQueryText",filter);setAlertParams("filterQuery",Object(kuery["a"])(filter,derivedIndexPattern)||"")},[setAlertParams,derivedIndexPattern]);const debouncedOnFilterChange=Object(external_kbnSharedDeps_React_["useCallback"])(Object(external_kbnSharedDeps_Lodash_["debounce"])(onFilterChange,FILTER_TYPING_DEBOUNCE_MS),[onFilterChange]);const onGroupByChange=Object(external_kbnSharedDeps_React_["useCallback"])(group=>{setAlertParams("groupBy",group&&group.length?group:"")},[setAlertParams]);const emptyError=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]}),[]);const updateTimeSize=Object(external_kbnSharedDeps_React_["useCallback"])(ts=>{var _alertParams$criteria3;const criteria=((_alertParams$criteria3=alertParams.criteria)===null||_alertParams$criteria3===void 0?void 0:_alertParams$criteria3.map(c=>expression_objectSpread(expression_objectSpread({},c),{},{timeSize:ts})))||[];setTimeSize(ts||undefined);setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]);const updateTimeUnit=Object(external_kbnSharedDeps_React_["useCallback"])(tu=>{var _alertParams$criteria4;const criteria=((_alertParams$criteria4=alertParams.criteria)===null||_alertParams$criteria4===void 0?void 0:_alertParams$criteria4.map(c=>expression_objectSpread(expression_objectSpread({},c),{},{timeUnit:tu})))||[];setTimeUnit(tu);setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]);const preFillAlertCriteria=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{var _md$currentOptions,_md$currentOptions$me;const md=alertsContext.metadata;if(md===null||md===void 0?void 0:(_md$currentOptions=md.currentOptions)===null||_md$currentOptions===void 0?void 0:(_md$currentOptions$me=_md$currentOptions.metrics)===null||_md$currentOptions$me===void 0?void 0:_md$currentOptions$me.length){setAlertParams("criteria",md.currentOptions.metrics.map(metric=>({metric:metric.field,comparator:metrics["b"].GT,threshold:[],timeSize:timeSize,timeUnit:timeUnit,aggType:metric.aggregation})))}else{setAlertParams("criteria",[defaultExpression])}},[alertsContext.metadata,setAlertParams,timeSize,timeUnit]);const preFillAlertFilter=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{var _md$currentOptions2,_md$currentOptions3;const md=alertsContext.metadata;if(md&&((_md$currentOptions2=md.currentOptions)===null||_md$currentOptions2===void 0?void 0:_md$currentOptions2.filterQuery)){setAlertParams("filterQueryText",md.currentOptions.filterQuery);setAlertParams("filterQuery",Object(kuery["a"])(md.currentOptions.filterQuery,derivedIndexPattern)||"")}else if(md&&((_md$currentOptions3=md.currentOptions)===null||_md$currentOptions3===void 0?void 0:_md$currentOptions3.groupBy)&&md.series){const groupBy=md.currentOptions.groupBy;const filter=Array.isArray(groupBy)?groupBy.map((field,index)=>{var _md$series,_md$series$keys;return"".concat(field,': "').concat((_md$series=md.series)===null||_md$series===void 0?void 0:(_md$series$keys=_md$series.keys)===null||_md$series$keys===void 0?void 0:_md$series$keys[index],'"')}).join(" and "):"".concat(groupBy,': "').concat(md.series.id,'"');setAlertParams("filterQueryText",filter);setAlertParams("filterQuery",Object(kuery["a"])(filter,derivedIndexPattern)||"")}},[alertsContext.metadata,derivedIndexPattern,setAlertParams]);const preFillAlertGroupBy=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{var _md$currentOptions4;const md=alertsContext.metadata;if(md&&((_md$currentOptions4=md.currentOptions)===null||_md$currentOptions4===void 0?void 0:_md$currentOptions4.groupBy)&&!md.series){setAlertParams("groupBy",md.currentOptions.groupBy)}},[alertsContext.metadata,setAlertParams]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(alertParams.criteria&&alertParams.criteria.length){setTimeSize(alertParams.criteria[0].timeSize);setTimeUnit(alertParams.criteria[0].timeUnit)}else{preFillAlertCriteria()}if(!alertParams.filterQuery){preFillAlertFilter()}if(!alertParams.groupBy){preFillAlertGroupBy()}if(!alertParams.sourceId){setAlertParams("sourceId",(source===null||source===void 0?void 0:source.id)||"default")}},[alertsContext.metadata,source]);const handleFieldSearchChange=Object(external_kbnSharedDeps_React_["useCallback"])(e=>onFilterChange(e.target.value),[onFilterChange]);const groupByPreviewDisplayName=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(Array.isArray(alertParams.groupBy))return alertParams.groupBy.join(", ");return alertParams.groupBy},[alertParams.groupBy]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),alertParams.criteria&&alertParams.criteria.map((e,idx)=>external_kbnSharedDeps_React_default.a.createElement(ExpressionRow,{canDelete:alertParams.criteria&&alertParams.criteria.length>1||false,fields:derivedIndexPattern.fields,remove:removeExpression,addExpression:addExpression,key:idx,expressionId:idx,setAlertParams:updateParams,errors:errors[idx]||emptyError,expression:e||{}},external_kbnSharedDeps_React_default.a.createElement(ExpressionChart,{expression:e,context:alertsContext,derivedIndexPattern:derivedIndexPattern,source:source,filterQuery:alertParams.filterQueryText,groupBy:alertParams.groupBy}))),external_kbnSharedDeps_React_default.a.createElement("div",{style:{marginLeft:28}},external_kbnSharedDeps_React_default.a.createElement(common_["ForLastExpression"],{timeWindowSize:timeSize,timeWindowUnit:timeUnit,errors:emptyError,onChangeWindowSize:updateTimeSize,onChangeWindowUnit:updateTimeUnit})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:addExpression},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"metrics-alert-no-data-toggle",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"questionInCircle",color:"subdued"}))),checked:alertParams.alertOnNoData,onChange:e=>setAlertParams("alertOnNoData",e.target.checked)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:true,display:"rowCompressed"},alertsContext.metadata&&external_kbnSharedDeps_React_default.a.createElement(kuery_bar["a"],{derivedIndexPattern:derivedIndexPattern,onChange:debouncedOnFilterChange,onSubmit:onFilterChange,value:alertParams.filterQueryText})||external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldSearch"],{onChange:handleFieldSearchChange,value:alertParams.filterQueryText,fullWidth:true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.createAlertPerText",{defaultMessage:"Create alert per (optional)"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.createAlertPerHelpText",{defaultMessage:'Create an alert for every unique value. For example: "host.id" or "cloud.region".'}),fullWidth:true,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(group_by["a"],{onChange:onGroupByChange,fields:derivedIndexPattern.fields,options:expression_objectSpread(expression_objectSpread({},options),{},{groupBy:alertParams.groupBy||undefined})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(common["a"],{alertInterval:alertInterval,alertThrottle:alertThrottle,alertType:metrics["e"],alertParams:Object(external_kbnSharedDeps_Lodash_["pick"])(alertParams,"criteria","groupBy","filterQuery","sourceId"),showNoDataResults:alertParams.alertOnNoData,validate:validation["a"],fetch:alertsContext.http.fetch,groupByDisplayName:groupByPreviewDisplayName}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};var components_expression=__webpack_exports__["default"]=Expressions},85:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Color}));__webpack_require__.d(__webpack_exports__,"b",(function(){return colorTransformer}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__);let Color;(function(Color){Color["color0"]="color0";Color["color1"]="color1";Color["color2"]="color2";Color["color3"]="color3";Color["color4"]="color4";Color["color5"]="color5";Color["color6"]="color6";Color["color7"]="color7";Color["color8"]="color8";Color["color9"]="color9"})(Color||(Color={}));const euiPalette=Object(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["euiPaletteColorBlind"])();const defaultPalette={[Color.color0]:euiPalette[1],[Color.color1]:euiPalette[2],[Color.color2]:euiPalette[0],[Color.color3]:euiPalette[3],[Color.color4]:euiPalette[4],[Color.color5]:euiPalette[5],[Color.color6]:euiPalette[6],[Color.color7]:euiPalette[7],[Color.color8]:euiPalette[8],[Color.color9]:euiPalette[9]};const createPaletteTransformer=palette=>color=>palette[color];const colorTransformer=createPaletteTransformer(defaultPalette);const sampleColor=(usedColors=[])=>{const available=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["difference"])(Object(lodash__WEBPACK_IMPORTED_MODULE_0__["values"])(Color),usedColors);return Object(lodash__WEBPACK_IMPORTED_MODULE_0__["first"])(available)||Color.color0}},88:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return MetricsExplorerChartType}));__webpack_require__.d(__webpack_exports__,"d",(function(){return MetricsExplorerYAxisMode}));__webpack_require__.d(__webpack_exports__,"f",(function(){return metricsExplorerChartOptionsRT}));__webpack_require__.d(__webpack_exports__,"e",(function(){return metricExplorerOptionsRT}));__webpack_require__.d(__webpack_exports__,"g",(function(){return metricsExplorerTimeOptionsRT}));__webpack_require__.d(__webpack_exports__,"a",(function(){return DEFAULT_METRICS_EXPLORER_VIEW_STATE}));__webpack_require__.d(__webpack_exports__,"c",(function(){return MetricsExplorerOptionsContainer}));var io_ts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var io_ts__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(io_ts__WEBPACK_IMPORTED_MODULE_0__);var lodash__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4);var lodash__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);var constate__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(76);var constate__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(constate__WEBPACK_IMPORTED_MODULE_2__);var react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2);var react__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_3__);var _alerting_use_alert_prefill__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(104);var _common_color_palette__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(85);var _common_http_api_metrics_explorer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(93);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const metricsExplorerOptionsMetricRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([_common_http_api_metrics_explorer__WEBPACK_IMPORTED_MODULE_6__["d"],io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({rate:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"],color:io_ts__WEBPACK_IMPORTED_MODULE_0__["keyof"](Object.fromEntries(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["values"])(_common_color_palette__WEBPACK_IMPORTED_MODULE_5__["a"]).map(c=>[c,null]))),label:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]})]);let MetricsExplorerChartType;(function(MetricsExplorerChartType){MetricsExplorerChartType["line"]="line";MetricsExplorerChartType["area"]="area";MetricsExplorerChartType["bar"]="bar"})(MetricsExplorerChartType||(MetricsExplorerChartType={}));let MetricsExplorerYAxisMode;(function(MetricsExplorerYAxisMode){MetricsExplorerYAxisMode["fromZero"]="fromZero";MetricsExplorerYAxisMode["auto"]="auto"})(MetricsExplorerYAxisMode||(MetricsExplorerYAxisMode={}));const metricsExplorerChartOptionsRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({yAxisMode:io_ts__WEBPACK_IMPORTED_MODULE_0__["keyof"](Object.fromEntries(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["values"])(MetricsExplorerYAxisMode).map(v=>[v,null]))),type:io_ts__WEBPACK_IMPORTED_MODULE_0__["keyof"](Object.fromEntries(Object(lodash__WEBPACK_IMPORTED_MODULE_1__["values"])(MetricsExplorerChartType).map(v=>[v,null]))),stack:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"]});const metricExplorerOptionsRequiredRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({aggregation:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],metrics:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](metricsExplorerOptionsMetricRT)});const metricExplorerOptionsOptionalRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({limit:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],groupBy:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["string"])]),filterQuery:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],source:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],forceInterval:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"],dropLastBucket:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"]});const metricExplorerOptionsRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([metricExplorerOptionsRequiredRT,metricExplorerOptionsOptionalRT]);const metricsExplorerTimeOptionsRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({from:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],to:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],interval:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]});const DEFAULT_TIMERANGE={from:"now-1h",to:"now",interval:">=10s"};const DEFAULT_CHART_OPTIONS={type:MetricsExplorerChartType.line,yAxisMode:MetricsExplorerYAxisMode.fromZero,stack:false};const DEFAULT_METRICS=[{aggregation:"avg",field:"system.cpu.user.pct",color:_common_color_palette__WEBPACK_IMPORTED_MODULE_5__["a"].color0},{aggregation:"avg",field:"kubernetes.pod.cpu.usage.node.pct",color:_common_color_palette__WEBPACK_IMPORTED_MODULE_5__["a"].color1},{aggregation:"avg",field:"docker.cpu.total.pct",color:_common_color_palette__WEBPACK_IMPORTED_MODULE_5__["a"].color2}];const DEFAULT_OPTIONS={aggregation:"avg",metrics:DEFAULT_METRICS,source:"default"};const DEFAULT_METRICS_EXPLORER_VIEW_STATE={options:DEFAULT_OPTIONS,chartOptions:DEFAULT_CHART_OPTIONS,currentTimerange:DEFAULT_TIMERANGE};function parseJsonOrDefault(value,defaultValue){if(!value){return defaultValue}try{return JSON.parse(value)}catch(e){return defaultValue}}function useStateWithLocalStorage(key,defaultState){const storageState=localStorage.getItem(key);const _useState=Object(react__WEBPACK_IMPORTED_MODULE_3__["useState"])(parseJsonOrDefault(storageState,defaultState)),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];Object(react__WEBPACK_IMPORTED_MODULE_3__["useEffect"])(()=>{localStorage.setItem(key,JSON.stringify(state))},[key,state]);return[state,setState]}const useMetricsExplorerOptions=()=>{const _useStateWithLocalSto=useStateWithLocalStorage("MetricsExplorerOptions",DEFAULT_OPTIONS),_useStateWithLocalSto2=_slicedToArray(_useStateWithLocalSto,2),options=_useStateWithLocalSto2[0],setOptions=_useStateWithLocalSto2[1];const _useStateWithLocalSto3=useStateWithLocalStorage("MetricsExplorerTimeRange",DEFAULT_TIMERANGE),_useStateWithLocalSto4=_slicedToArray(_useStateWithLocalSto3,2),currentTimerange=_useStateWithLocalSto4[0],setTimeRange=_useStateWithLocalSto4[1];const _useStateWithLocalSto5=useStateWithLocalStorage("MetricsExplorerChartOptions",DEFAULT_CHART_OPTIONS),_useStateWithLocalSto6=_slicedToArray(_useStateWithLocalSto5,2),chartOptions=_useStateWithLocalSto6[0],setChartOptions=_useStateWithLocalSto6[1];const _useState3=Object(react__WEBPACK_IMPORTED_MODULE_3__["useState"])(false),_useState4=_slicedToArray(_useState3,2),isAutoReloading=_useState4[0],setAutoReloading=_useState4[1];const _useAlertPrefillConte=Object(_alerting_use_alert_prefill__WEBPACK_IMPORTED_MODULE_4__["b"])(),metricThresholdPrefill=_useAlertPrefillConte.metricThresholdPrefill;const prefillContext=Object(react__WEBPACK_IMPORTED_MODULE_3__["useMemo"])(()=>metricThresholdPrefill,[metricThresholdPrefill]);Object(react__WEBPACK_IMPORTED_MODULE_3__["useEffect"])(()=>{if(prefillContext){const setPrefillOptions=prefillContext.setPrefillOptions;const metrics=options.metrics,groupBy=options.groupBy,filterQuery=options.filterQuery;setPrefillOptions({metrics:metrics,groupBy:groupBy,filterQuery:filterQuery})}},[options,prefillContext]);return{defaultViewState:{options:DEFAULT_OPTIONS,chartOptions:DEFAULT_CHART_OPTIONS,currentTimerange:DEFAULT_TIMERANGE},options:options,chartOptions:chartOptions,setChartOptions:setChartOptions,currentTimerange:currentTimerange,isAutoReloading:isAutoReloading,setOptions:setOptions,setTimeRange:setTimeRange,startAutoReload:()=>setAutoReloading(true),stopAutoReload:()=>setAutoReloading(false)}};const MetricsExplorerOptionsContainer=constate__WEBPACK_IMPORTED_MODULE_2___default()(useMetricsExplorerOptions)},95:function(module,exports,__webpack_require__){const moment=__webpack_require__(58);const unitsMap={ms:{weight:1,type:"fixed",base:1},s:{weight:2,type:"fixed",base:1e3},m:{weight:3,type:"mixed",base:1e3*60},h:{weight:4,type:"mixed",base:1e3*60*60},d:{weight:5,type:"mixed",base:1e3*60*60*24},w:{weight:6,type:"calendar",base:NaN},M:{weight:7,type:"calendar",base:NaN},y:{weight:9,type:"calendar",base:NaN}};const units=Object.keys(unitsMap).sort((a,b)=>unitsMap[b].weight-unitsMap[a].weight);const unitsDesc=[...units];const unitsAsc=[...units].reverse();const isDate=d=>Object.prototype.toString.call(d)==="[object Date]";const isValidDate=d=>isDate(d)&&!isNaN(d.valueOf());function parse(text,{roundUp:roundUp=false,momentInstance:momentInstance=moment,forceNow:forceNow}={}){if(!text)return undefined;if(momentInstance.isMoment(text))return text;if(isDate(text))return momentInstance(text);if(forceNow!==undefined&&!isValidDate(forceNow)){throw new Error("forceNow must be a valid Date")}let time;let mathString="";let index;let parseString;if(text.substring(0,3)==="now"){time=momentInstance(forceNow);mathString=text.substring("now".length)}else{index=text.indexOf("||");if(index===-1){parseString=text;mathString=""}else{parseString=text.substring(0,index);mathString=text.substring(index+2)}time=momentInstance(parseString)}if(!mathString.length){return time}return parseDateMath(mathString,time,roundUp)}function parseDateMath(mathString,time,roundUp){const dateTime=time;const len=mathString.length;let i=0;while(i<len){const c=mathString.charAt(i++);let type;let num;let unit;if(c==="/"){type=0}else if(c==="+"){type=1}else if(c==="-"){type=2}else{return}if(isNaN(mathString.charAt(i))){num=1}else if(mathString.length===2){num=mathString.charAt(i)}else{const numFrom=i;while(!isNaN(mathString.charAt(i))){i++;if(i>=len)return}num=parseInt(mathString.substring(numFrom,i),10)}if(type===0){if(num!==1){return}}unit=mathString.charAt(i++);for(let j=i;j<len;j++){const unitChar=mathString.charAt(i);if(/[a-z]/i.test(unitChar)){unit+=unitChar;i++}else{break}}if(units.indexOf(unit)===-1){return}else{if(type===0){if(roundUp)dateTime.endOf(unit);else dateTime.startOf(unit)}else if(type===1){dateTime.add(num,unit)}else if(type===2){dateTime.subtract(num,unit)}}}return dateTime}module.exports={parse:parse,unitsMap:Object.freeze(unitsMap),units:Object.freeze(units),unitsAsc:Object.freeze(unitsAsc),unitsDesc:Object.freeze(unitsDesc)}},99:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return convertKueryToElasticSearchQuery}));var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(62);var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__);const convertKueryToElasticSearchQuery=(kueryExpression,indexPattern)=>{try{return kueryExpression?JSON.stringify(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["esKuery"].toElasticsearchQuery(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["esKuery"].fromKueryExpression(kueryExpression),indexPattern)):""}catch(err){return""}}}}]);