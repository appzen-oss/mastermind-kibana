/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["infra_bundle_jsonpfunction"]=window["infra_bundle_jsonpfunction"]||[]).push([[13],{118:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return MetricsAPITimerangeRT}));__webpack_require__.d(__webpack_exports__,"a",(function(){return MetricsAPISeriesRT}));var io_ts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var io_ts__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(io_ts__WEBPACK_IMPORTED_MODULE_0__);var _inventory_models_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83);var _metrics_explorer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(93);const MetricsAPITimerangeRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({field:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],from:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],to:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],interval:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]});const groupByRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"],io_ts__WEBPACK_IMPORTED_MODULE_0__["undefined"]]);const MetricsAPIMetricRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({id:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],aggregations:_inventory_models_types__WEBPACK_IMPORTED_MODULE_1__["d"]});const MetricsAPIRequestRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({timerange:MetricsAPITimerangeRT,indexPattern:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],metrics:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](MetricsAPIMetricRT)}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({groupBy:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](groupByRT),modules:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]),afterKey:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["null"],_metrics_explorer__WEBPACK_IMPORTED_MODULE_2__["b"]]),limit:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"],io_ts__WEBPACK_IMPORTED_MODULE_0__["undefined"]]),filters:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["object"]),dropLastBucket:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"],alignDataToEnd:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"]})]);const MetricsAPIPageInfoRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({afterKey:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["null"],_metrics_explorer__WEBPACK_IMPORTED_MODULE_2__["b"],io_ts__WEBPACK_IMPORTED_MODULE_0__["undefined"]]),interval:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"]});const MetricsAPIColumnTypeRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["keyof"]({date:null,number:null,string:null});const MetricsAPIColumnRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({name:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],type:MetricsAPIColumnTypeRT});const MetricsAPIRowRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({timestamp:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"]}),io_ts__WEBPACK_IMPORTED_MODULE_0__["record"](io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"],io_ts__WEBPACK_IMPORTED_MODULE_0__["undefined"],io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["object"])]))]);const MetricsAPISeriesRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({id:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],columns:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](MetricsAPIColumnRT),rows:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](MetricsAPIRowRT)}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({keys:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["string"])})]);const MetricsAPIResponseRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({series:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](MetricsAPISeriesRT),info:MetricsAPIPageInfoRT})},132:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return METRIC_THRESHOLD_ALERT_TYPE_ID}));__webpack_require__.d(__webpack_exports__,"d",(function(){return METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID}));__webpack_require__.d(__webpack_exports__,"b",(function(){return Comparator}));__webpack_require__.d(__webpack_exports__,"a",(function(){return Aggregators}));__webpack_require__.d(__webpack_exports__,"c",(function(){return INFRA_ALERT_PREVIEW_PATH}));var lib=__webpack_require__(0);var types=__webpack_require__(83);const METRIC_THRESHOLD_ALERT_TYPE_ID="metrics.alert.threshold";const METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID="metrics.alert.inventory.threshold";let Comparator;(function(Comparator){Comparator["GT"]=">";Comparator["LT"]="<";Comparator["GT_OR_EQ"]=">=";Comparator["LT_OR_EQ"]="<=";Comparator["BETWEEN"]="between";Comparator["OUTSIDE_RANGE"]="outside"})(Comparator||(Comparator={}));let Aggregators;(function(Aggregators){Aggregators["COUNT"]="count";Aggregators["AVERAGE"]="avg";Aggregators["SUM"]="sum";Aggregators["MIN"]="min";Aggregators["MAX"]="max";Aggregators["RATE"]="rate";Aggregators["CARDINALITY"]="cardinality";Aggregators["P95"]="p95";Aggregators["P99"]="p99"})(Aggregators||(Aggregators={}));const baseAlertRequestParamsRT=lib["intersection"]([lib["partial"]({filterQuery:lib["union"]([lib["string"],lib["undefined"]]),sourceId:lib["string"]}),lib["type"]({lookback:lib["union"]([lib["literal"]("ms"),lib["literal"]("s"),lib["literal"]("m"),lib["literal"]("h"),lib["literal"]("d"),lib["literal"]("w"),lib["literal"]("M"),lib["literal"]("y")]),criteria:lib["array"](lib["any"]),alertInterval:lib["string"],alertThrottle:lib["string"],alertOnNoData:lib["boolean"]})]);const metricThresholdAlertPreviewRequestParamsRT=lib["intersection"]([baseAlertRequestParamsRT,lib["partial"]({groupBy:lib["union"]([lib["string"],lib["array"](lib["string"]),lib["undefined"]])}),lib["type"]({alertType:lib["literal"](METRIC_THRESHOLD_ALERT_TYPE_ID)})]);const inventoryAlertPreviewRequestParamsRT=lib["intersection"]([baseAlertRequestParamsRT,lib["type"]({nodeType:types["c"],alertType:lib["literal"](METRIC_INVENTORY_THRESHOLD_ALERT_TYPE_ID)})]);const alertPreviewRequestParamsRT=lib["union"]([metricThresholdAlertPreviewRequestParamsRT,inventoryAlertPreviewRequestParamsRT]);const alertPreviewSuccessResponsePayloadRT=lib["type"]({numberOfGroups:lib["number"],resultTotals:lib["type"]({fired:lib["number"],noData:lib["number"],error:lib["number"],notifications:lib["number"]})});const INFRA_ALERT_PREVIEW_PATH="/api/infra/alerting/preview";const TOO_MANY_BUCKETS_PREVIEW_EXCEPTION="TOO_MANY_BUCKETS_PREVIEW_EXCEPTION";const isTooManyBucketsPreviewException=value=>Boolean(value&&value.TOO_MANY_BUCKETS_PREVIEW_EXCEPTION)},205:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AlertPreview}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var external_kbnSharedDeps_Lodash_=__webpack_require__(4);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(7);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(12);var formatters=__webpack_require__(25);var get_interval_in_seconds=__webpack_require__(201);var metrics=__webpack_require__(132);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function getAlertPreview(_x){return _getAlertPreview.apply(this,arguments)}function _getAlertPreview(){_getAlertPreview=_asyncToGenerator(regeneratorRuntime.mark((function _callee({fetch:fetch,params:params,alertType:alertType}){return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return fetch("".concat(metrics["c"]),{method:"POST",body:JSON.stringify(_objectSpread(_objectSpread({},params),{},{alertType:alertType}))});case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}}),_callee)})));return _getAlertPreview.apply(this,arguments)}function alert_preview_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function alert_preview_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){alert_preview_ownKeys(Object(source),true).forEach((function(key){alert_preview_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{alert_preview_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function alert_preview_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function alert_preview_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){alert_preview_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const AlertPreview=props=>{var _previewOptions$find,_previewError$body;const alertParams=props.alertParams,alertInterval=props.alertInterval,alertThrottle=props.alertThrottle,fetch=props.fetch,alertType=props.alertType,validate=props.validate,showNoDataResults=props.showNoDataResults,groupByDisplayName=props.groupByDisplayName;const _useState=Object(external_kbnSharedDeps_React_["useState"])("h"),_useState2=_slicedToArray(_useState,2),previewLookbackInterval=_useState2[0],setPreviewLookbackInterval=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])(false),_useState4=_slicedToArray(_useState3,2),isPreviewLoading=_useState4[0],setIsPreviewLoading=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(false),_useState6=_slicedToArray(_useState5,2),previewError=_useState6[0],setPreviewError=_useState6[1];const _useState7=Object(external_kbnSharedDeps_React_["useState"])(null),_useState8=_slicedToArray(_useState7,2),previewResult=_useState8[0],setPreviewResult=_useState8[1];const onSelectPreviewLookbackInterval=Object(external_kbnSharedDeps_React_["useCallback"])(e=>{setPreviewLookbackInterval(e.target.value)},[]);const onClickPreview=Object(external_kbnSharedDeps_React_["useCallback"])(alert_preview_asyncToGenerator(regeneratorRuntime.mark((function _callee(){var result;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setIsPreviewLoading(true);setPreviewResult(null);setPreviewError(false);_context.prev=3;_context.next=6;return getAlertPreview({fetch:fetch,params:alert_preview_objectSpread(alert_preview_objectSpread({},alertParams),{},{lookback:previewLookbackInterval,alertInterval:alertInterval,alertThrottle:alertThrottle,alertOnNoData:showNoDataResults!==null&&showNoDataResults!==void 0?showNoDataResults:false}),alertType:alertType});case 6:result=_context.sent;setPreviewResult(alert_preview_objectSpread(alert_preview_objectSpread({},result),{},{groupByDisplayName:groupByDisplayName,previewLookbackInterval:previewLookbackInterval,alertThrottle:alertThrottle}));_context.next=13;break;case 10:_context.prev=10;_context.t0=_context["catch"](3);setPreviewError(_context.t0);case 13:_context.prev=13;setIsPreviewLoading(false);return _context.finish(13);case 16:case"end":return _context.stop()}}),_callee,null,[[3,10,13,16]])}))),[alertParams,alertInterval,fetch,alertType,groupByDisplayName,previewLookbackInterval,alertThrottle,showNoDataResults]);const previewIntervalError=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const intervalInSeconds=Object(get_interval_in_seconds["a"])(alertInterval);const lookbackInSeconds=Object(get_interval_in_seconds["a"])("1".concat(previewLookbackInterval));if(intervalInSeconds>=lookbackInSeconds){return true}return false},[previewLookbackInterval,alertInterval]);const isPreviewDisabled=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const validationResult=validate({criteria:alertParams.criteria});const hasValidationErrors=Object.values(validationResult.errors).some(result=>Object.values(result).some(arr=>Array.isArray(arr)&&arr.length));return hasValidationErrors||previewIntervalError},[alertParams.criteria,previewIntervalError,validate]);const showNumberOfNotifications=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(!previewResult)return false;const _previewResult$result=previewResult.resultTotals,notifications=_previewResult$result.notifications,fired=_previewResult$result.fired,noData=_previewResult$result.noData,error=_previewResult$result.error;const unthrottledNotifications=fired+(showNoDataResults?noData+error:0);return unthrottledNotifications>notifications},[previewResult,showNoDataResults]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.previewLabel",{defaultMessage:"Preview"}),fullWidth:true,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{id:"selectPreviewLookbackInterval",value:previewLookbackInterval,onChange:onSelectPreviewLookbackInterval,options:previewDOMOptions})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isLoading:isPreviewLoading,isDisabled:isPreviewDisabled,onClick:onClickPreview},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.testAlertCondition",{defaultMessage:"Test alert condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),previewResult&&!previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewResult",defaultMessage:"There were {firedTimes}",values:{firedTimes:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.firedTimes",defaultMessage:"{fired, plural, one {# instance} other {# instances}}",values:{fired:previewResult.resultTotals.fired}}))}})," ",previewResult.groupByDisplayName?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroupsAcross",defaultMessage:"across"})," ",external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewGroups",defaultMessage:"{numberOfGroups, plural, one {# {groupName}} other {# {groupName}s}}",values:{numberOfGroups:previewResult.numberOfGroups,groupName:previewResult.groupByDisplayName}}))," "):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewResultLookback",defaultMessage:"that satisfied the conditions of this alert in the last {lookback}.",values:{lookback:(_previewOptions$find=previewOptions.find(e=>e.value===previewResult.previewLookbackInterval))===null||_previewOptions$find===void 0?void 0:_previewOptions$find.shortText}}))},showNoDataResults&&previewResult.resultTotals.noData?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewNoDataResult",defaultMessage:"There {boldedResultsNumber} of no data.",values:{boldedResultsNumber:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertPreviewNoDataResultNumber",{defaultMessage:"{noData, plural, one {was # result} other {were # results}}",values:{noData:previewResult.resultTotals.noData}}))}}):null," ",previewResult.resultTotals.error?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorResult",defaultMessage:"An error occurred when trying to evaluate some of the data."}):null,showNumberOfNotifications?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewTotalNotifications",defaultMessage:'As a result, this alert would have sent {notifications} based on the selected "notify every" setting of "{alertThrottle}."',values:{alertThrottle:previewResult.alertThrottle,notifications:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertPreviewTotalNotificationsNumber",{defaultMessage:"{notifs, plural, one {# notification} other {# notifications}}",values:{notifs:previewResult.resultTotals.notifications}}))}})):null," ")),previewIntervalError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortTitle",defaultMessage:"Not enough data"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.previewIntervalTooShortDescription",defaultMessage:"Try selecting a longer preview length, or increase the amount of time in the {checkEvery} field.",values:{checkEvery:external_kbnSharedDeps_React_default.a.createElement("strong",null,"check every")}}))),previewError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),((_previewError$body=previewError.body)===null||_previewError$body===void 0?void 0:_previewError$body.statusCode)===508?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorTitle",defaultMessage:"Too much data (>{maxBuckets} results)",values:{maxBuckets:formatters["a"].number(previewError.body.message)}}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.tooManyBucketsErrorDescription",defaultMessage:"Try selecting a shorter preview length, or increase the amount of time in the {forTheLast} field.",values:{forTheLast:external_kbnSharedDeps_React_default.a.createElement("strong",null,"FOR THE LAST")}})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewError",defaultMessage:"An error occurred when trying to preview this alert condition"}),color:"danger",iconType:"alert"},previewError.body&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.alertPreviewErrorDesc",defaultMessage:"Please try again later or see details for more information."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"alertErrorDetailsAccordion",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.errorDetails",defaultMessage:"Details"})))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],null,previewError.body.message)))))))};const previewOptions=[{value:"h",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"})},{value:"d",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"})},{value:"w",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"})},{value:"M",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})}];const previewDOMOptions=previewOptions.map(o=>Object(external_kbnSharedDeps_Lodash_["omit"])(o,"shortText"));const common_previewOptions=[{value:"h",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastHourLabel",{defaultMessage:"Last hour"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.hourLabel",{defaultMessage:"hour"})},{value:"d",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastDayLabel",{defaultMessage:"Last day"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.dayLabel",{defaultMessage:"day"})},{value:"w",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastWeekLabel",{defaultMessage:"Last week"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.weekLabel",{defaultMessage:"week"})},{value:"M",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.lastMonthLabel",{defaultMessage:"Last month"}),shortText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.monthLabel",{defaultMessage:"month"})}]},498:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"defaultExpression",(function(){return defaultExpression}));__webpack_require__.d(__webpack_exports__,"Expressions",(function(){return Expressions}));__webpack_require__.d(__webpack_exports__,"ExpressionRow",(function(){return ExpressionRow}));__webpack_require__.d(__webpack_exports__,"nodeTypes",(function(){return nodeTypes}));var external_kbnSharedDeps_Lodash_=__webpack_require__(4);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(7);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(12);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var snapshot_metric_i18n=__webpack_require__(200);var common=__webpack_require__(205);var alerting_metrics=__webpack_require__(132);var types=__webpack_require__(15);var public_=__webpack_require__(57);var common_=__webpack_require__(66);var kuery_bar=__webpack_require__(197);var use_source_via_http=__webpack_require__(170);var toolbar_items=__webpack_require__(277);var aws_ec2_toolbar_items=__webpack_require__(274);var aws_s3_toolbar_items=__webpack_require__(275);var aws_rds_toolbar_items=__webpack_require__(276);var host_toolbar_items=__webpack_require__(271);var container_toolbar_items=__webpack_require__(272);var pod_toolbar_items=__webpack_require__(273);var inventory_models=__webpack_require__(98);var inventory_models_types=__webpack_require__(83);var get_custom_metric_label=__webpack_require__(161);var snapshot_api=__webpack_require__(87);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const AGGREGATION_LABELS={["avg"]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.aggregationLables.avg",{defaultMessage:"Average"}),["max"]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.aggregationLables.max",{defaultMessage:"Max"}),["min"]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.aggregationLables.min",{defaultMessage:"Min"}),["rate"]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.aggregationLables.rate",{defaultMessage:"Rate"})};const aggregationOptions=snapshot_api["b"].map(k=>({text:AGGREGATION_LABELS[k],value:k}));const MetricExpression=({metric:metric,metrics:metrics,customMetric:customMetric,fields:fields,errors:errors,onChange:_onChange,onChangeCustom:onChangeCustom,popupPosition:popupPosition})=>{var _errors$metric;const _useState=Object(external_kbnSharedDeps_React_["useState"])(false),_useState2=_slicedToArray(_useState,2),popoverOpen=_useState2[0],setPopoverOpen=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])((metric===null||metric===void 0?void 0:metric.value)==="custom"),_useState4=_slicedToArray(_useState3,2),customMetricTabOpen=_useState4[0],setCustomMetricTabOpen=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(metric===null||metric===void 0?void 0:metric.value),_useState6=_slicedToArray(_useState5,2),selectedOption=_useState6[0],setSelectedOption=_useState6[1];const _useState7=Object(external_kbnSharedDeps_React_["useState"])(customMetric===null||customMetric===void 0?void 0:customMetric.label),_useState8=_slicedToArray(_useState7,2),fieldDisplayedCustomLabel=_useState8[0],setFieldDisplayedCustomLabel=_useState8[1];const firstFieldOption={text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.expression.metric.selectFieldLabel",{defaultMessage:"Select a metric"}),value:""};const fieldOptions=Object(external_kbnSharedDeps_React_["useMemo"])(()=>fields.filter(f=>f.aggregatable&&f.type==="number"&&!((customMetric===null||customMetric===void 0?void 0:customMetric.field)===f.name)).map(f=>({label:f.name})),[fields,customMetric===null||customMetric===void 0?void 0:customMetric.field]);const expressionDisplayValue=Object(external_kbnSharedDeps_React_["useMemo"])(()=>customMetricTabOpen?(customMetric===null||customMetric===void 0?void 0:customMetric.field)&&Object(get_custom_metric_label["a"])(customMetric):(metric===null||metric===void 0?void 0:metric.text)||firstFieldOption.text,[customMetricTabOpen,metric,customMetric,firstFieldOption]);const onChangeTab=Object(external_kbnSharedDeps_React_["useCallback"])(id=>{if(id==="metric-popover-custom"){setCustomMetricTabOpen(true);_onChange("custom")}else{setCustomMetricTabOpen(false);_onChange(selectedOption)}},[setCustomMetricTabOpen,_onChange,selectedOption]);const onAggregationChange=Object(external_kbnSharedDeps_React_["useCallback"])(e=>{const value=e.target.value;const aggValue=snapshot_api["c"].is(value)?value:"avg";const newCustomMetric=_objectSpread(_objectSpread({},customMetric),{},{aggregation:aggValue});if(snapshot_api["d"].is(newCustomMetric))onChangeCustom(newCustomMetric)},[customMetric,onChangeCustom]);const onFieldChange=Object(external_kbnSharedDeps_React_["useCallback"])(selectedOptions=>{const newCustomMetric=_objectSpread(_objectSpread({},customMetric),{},{field:selectedOptions[0].label});if(snapshot_api["d"].is(newCustomMetric))onChangeCustom(newCustomMetric)},[customMetric,onChangeCustom]);const debouncedOnChangeCustom=Object(external_kbnSharedDeps_Lodash_["debounce"])(onChangeCustom,500);const onLabelChange=Object(external_kbnSharedDeps_React_["useCallback"])(e=>{setFieldDisplayedCustomLabel(e.target.value);const newCustomMetric=_objectSpread(_objectSpread({},customMetric),{},{label:e.target.value});if(snapshot_api["d"].is(newCustomMetric))debouncedOnChangeCustom(newCustomMetric)},[customMetric,debouncedOnChangeCustom]);const availablefieldsOptions=metrics.map(m=>({label:m.text,value:m.value}),[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"metricPopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.expression.metric.whenLabel",{defaultMessage:"When"}),value:expressionDisplayValue,isActive:Boolean(popoverOpen||errors.metric&&errors.metric.length>0),onClick:()=>{setPopoverOpen(true)},color:((_errors$metric=errors.metric)===null||_errors$metric===void 0?void 0:_errors$metric.length)?"danger":"secondary"}),isOpen:popoverOpen,closePopover:()=>{setPopoverOpen(false)},anchorPosition:popupPosition!==null&&popupPosition!==void 0?popupPosition:"downRight",zIndex:8e3},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:620}},external_kbnSharedDeps_React_default.a.createElement(ClosablePopoverTitle,{onClose:()=>setPopoverOpen(false)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.expression.metric.popoverTitle",defaultMessage:"Metric"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{isFullWidth:true,buttonSize:"compressed",legend:"Metric type",options:[{id:"metric-popover-default",label:"Default metric"},{id:"metric-popover-custom",label:"Custom metric"}],idSelected:customMetricTabOpen?"metric-popover-custom":"metric-popover-default",onChange:onChangeTab}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),customMetricTabOpen?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{onChange:onAggregationChange,value:(customMetric===null||customMetric===void 0?void 0:customMetric.aggregation)||"avg",options:aggregationOptions,fullWidth:true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.of",{defaultMessage:"of"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{fullWidth:true,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.fieldPlaceholder",{defaultMessage:"Select a field"}),singleSelection:{asPlainText:true},selectedOptions:(customMetric===null||customMetric===void 0?void 0:customMetric.field)?[{label:customMetric.field}]:[],options:fieldOptions,onChange:onFieldChange,isClearable:false,isInvalid:errors.metric.length>0})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.alerting.customMetrics.labelLabel",{defaultMessage:"Metric name (optional)"}),display:"rowCompressed",fullWidth:true,helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.alerting.customMetrics.helpText",{defaultMessage:'Choose a name to help identify your custom metric. Defaults to "<function> of <field name>".'})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"label",placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.waffle.customMetrics.labelPlaceholder",{defaultMessage:'Choose a name to appear in the "Metric" dropdown'}),value:fieldDisplayedCustomLabel,fullWidth:true,onChange:onLabelChange}))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"actOf__metricContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{fullWidth:true,singleSelection:{asPlainText:true},"data-test-subj":"availablefieldsOptionsComboBox",isInvalid:errors.metric.length>0,placeholder:firstFieldOption.text,options:availablefieldsOptions,noSuggestions:!availablefieldsOptions.length,selectedOptions:metric?availablefieldsOptions.filter(a=>a.value===metric.value):[],renderOption:o=>o.label,onChange:selectedOptions=>{if(selectedOptions.length>0){_onChange(selectedOptions[0].value);setSelectedOption(selectedOptions[0].value)}else{_onChange()}}}))))))};const ClosablePopoverTitle=({children:children,onClose:onClose})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"cross",color:"danger","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>onClose()}))));function node_type_slicedToArray(arr,i){return node_type_arrayWithHoles(arr)||node_type_iterableToArrayLimit(arr,i)||node_type_unsupportedIterableToArray(arr,i)||node_type_nonIterableRest()}function node_type_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function node_type_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return node_type_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return node_type_arrayLikeToArray(o,minLen)}function node_type_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function node_type_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function node_type_arrayWithHoles(arr){if(Array.isArray(arr))return arr}const NodeTypeExpression=({value:value,options:options,onChange:_onChange,popupPosition:popupPosition})=>{const _useState=Object(external_kbnSharedDeps_React_["useState"])(false),_useState2=node_type_slicedToArray(_useState,2),aggTypePopoverOpen=_useState2[0],setAggTypePopoverOpen=_useState2[1];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{"data-test-subj":"nodeTypeExpression",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.expression.for.descriptionLabel",{defaultMessage:"For"}),value:options[value].text,isActive:aggTypePopoverOpen,onClick:()=>{setAggTypePopoverOpen(true)}}),isOpen:aggTypePopoverOpen,closePopover:()=>{setAggTypePopoverOpen(false)},ownFocus:true,anchorPosition:popupPosition!==null&&popupPosition!==void 0?popupPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(node_type_ClosablePopoverTitle,{onClose:()=>setAggTypePopoverOpen(false)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.expression.for.popoverTitle",defaultMessage:"Inventory Type"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"data-test-subj":"forExpressionSelect",value:value,fullWidth:true,onChange:e=>{_onChange(e.target.value);setAggTypePopoverOpen(false)},options:Object.values(options).map(o=>o)})))};const node_type_ClosablePopoverTitle=({children:children,onClose:onClose})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"cross",color:"danger","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.expressionItems.components.closablePopoverTitle.closeLabel",{defaultMessage:"Close"}),onClick:()=>onClose()}))));var kuery=__webpack_require__(99);var validation=__webpack_require__(33);function _templateObject2(){const data=_taggedTemplateLiteral(["\n  padding: 0 4px;\n"]);_templateObject2=function _templateObject2(){return data};return data}function _templateObject(){const data=_taggedTemplateLiteral(["\n  display: flex;\n  flex-wrap: wrap;\n  margin: 0 -4px;\n"]);_templateObject=function _templateObject(){return data};return data}function _taggedTemplateLiteral(strings,raw){if(!raw){raw=strings.slice(0)}return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}function expression_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function expression_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){expression_ownKeys(Object(source),true).forEach((function(key){expression_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{expression_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function expression_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function expression_slicedToArray(arr,i){return expression_arrayWithHoles(arr)||expression_iterableToArrayLimit(arr,i)||expression_unsupportedIterableToArray(arr,i)||expression_nonIterableRest()}function expression_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function expression_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return expression_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return expression_arrayLikeToArray(o,minLen)}function expression_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function expression_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function expression_arrayWithHoles(arr){if(Array.isArray(arr))return arr}const FILTER_TYPING_DEBOUNCE_MS=500;const defaultExpression={metric:"cpu",comparator:types["a"].GT,threshold:[],timeSize:1,timeUnit:"m",customMetric:{type:"custom",id:"alert-custom-metric",field:"",aggregation:"avg"}};const Expressions=props=>{const setAlertParams=props.setAlertParams,alertParams=props.alertParams,errors=props.errors,alertsContext=props.alertsContext,alertInterval=props.alertInterval,alertThrottle=props.alertThrottle;const _useSourceViaHttp=Object(use_source_via_http["a"])({sourceId:"default",type:"metrics",fetch:alertsContext.http.fetch,toastWarning:alertsContext.toastNotifications.addWarning}),source=_useSourceViaHttp.source,createDerivedIndexPattern=_useSourceViaHttp.createDerivedIndexPattern;const _useState=Object(external_kbnSharedDeps_React_["useState"])(1),_useState2=expression_slicedToArray(_useState,2),timeSize=_useState2[0],setTimeSize=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])("m"),_useState4=expression_slicedToArray(_useState3,2),timeUnit=_useState4[0],setTimeUnit=_useState4[1];const derivedIndexPattern=Object(external_kbnSharedDeps_React_["useMemo"])(()=>createDerivedIndexPattern("metrics"),[createDerivedIndexPattern]);const updateParams=Object(external_kbnSharedDeps_React_["useCallback"])((id,e)=>{const exp=alertParams.criteria?alertParams.criteria.slice():[];exp[id]=expression_objectSpread(expression_objectSpread({},exp[id]),e);setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria]);const addExpression=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{var _alertParams$criteria;const exp=((_alertParams$criteria=alertParams.criteria)===null||_alertParams$criteria===void 0?void 0:_alertParams$criteria.slice())||[];exp.push(expression_objectSpread(expression_objectSpread({},defaultExpression),{},{timeSize:timeSize!==null&&timeSize!==void 0?timeSize:defaultExpression.timeSize,timeUnit:timeUnit!==null&&timeUnit!==void 0?timeUnit:defaultExpression.timeUnit}));setAlertParams("criteria",exp)},[setAlertParams,alertParams.criteria,timeSize,timeUnit]);const removeExpression=Object(external_kbnSharedDeps_React_["useCallback"])(id=>{const exp=alertParams.criteria.slice();if(exp.length>1){exp.splice(id,1);setAlertParams("criteria",exp)}},[setAlertParams,alertParams.criteria]);const onFilterChange=Object(external_kbnSharedDeps_React_["useCallback"])(filter=>{setAlertParams("filterQueryText",filter||"");setAlertParams("filterQuery",Object(kuery["a"])(filter,derivedIndexPattern)||"")},[derivedIndexPattern,setAlertParams]);const debouncedOnFilterChange=Object(external_kbnSharedDeps_React_["useCallback"])(Object(external_kbnSharedDeps_Lodash_["debounce"])(onFilterChange,FILTER_TYPING_DEBOUNCE_MS),[onFilterChange]);const emptyError=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({aggField:[],timeSizeUnit:[],timeWindowSize:[]}),[]);const updateTimeSize=Object(external_kbnSharedDeps_React_["useCallback"])(ts=>{const criteria=alertParams.criteria.map(c=>expression_objectSpread(expression_objectSpread({},c),{},{timeSize:ts}));setTimeSize(ts||undefined);setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]);const updateTimeUnit=Object(external_kbnSharedDeps_React_["useCallback"])(tu=>{const criteria=alertParams.criteria.map(c=>expression_objectSpread(expression_objectSpread({},c),{},{timeUnit:tu}));setTimeUnit(tu);setAlertParams("criteria",criteria)},[alertParams.criteria,setAlertParams]);const updateNodeType=Object(external_kbnSharedDeps_React_["useCallback"])(nt=>{setAlertParams("nodeType",nt)},[setAlertParams]);const handleFieldSearchChange=Object(external_kbnSharedDeps_React_["useCallback"])(e=>onFilterChange(e.target.value),[onFilterChange]);const preFillAlertCriteria=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const md=alertsContext.metadata;if(md&&md.options){setAlertParams("criteria",[expression_objectSpread(expression_objectSpread({},defaultExpression),{},{metric:md.options.metric.type,customMetric:snapshot_api["d"].is(md.options.metric)?md.options.metric:defaultExpression.customMetric})])}else{setAlertParams("criteria",[defaultExpression])}},[alertsContext.metadata,setAlertParams]);const preFillAlertFilter=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const md=alertsContext.metadata;if(md&&md.filter){setAlertParams("filterQueryText",md.filter);setAlertParams("filterQuery",Object(kuery["a"])(md.filter,derivedIndexPattern)||"")}},[alertsContext.metadata,derivedIndexPattern,setAlertParams]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const md=alertsContext.metadata;if(!alertParams.nodeType){if(md&&md.nodeType){setAlertParams("nodeType",md.nodeType)}else{setAlertParams("nodeType","host")}}if(alertParams.criteria&&alertParams.criteria.length){setTimeSize(alertParams.criteria[0].timeSize);setTimeUnit(alertParams.criteria[0].timeUnit)}else{preFillAlertCriteria()}if(!alertParams.filterQuery){preFillAlertFilter()}if(!alertParams.sourceId){setAlertParams("sourceId",(source===null||source===void 0?void 0:source.id)||"default")}},[alertsContext.metadata,derivedIndexPattern,defaultExpression,source]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.conditions",defaultMessage:"Conditions"}))),external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(NodeTypeExpression,{options:nodeTypes,value:alertParams.nodeType||"host",onChange:updateNodeType}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),alertParams.criteria&&alertParams.criteria.map((e,idx)=>external_kbnSharedDeps_React_default.a.createElement(ExpressionRow,{nodeType:alertParams.nodeType,canDelete:alertParams.criteria.length>1,remove:removeExpression,addExpression:addExpression,key:idx,expressionId:idx,setAlertParams:updateParams,errors:errors[idx]||emptyError,expression:e||{},alertsContextMetadata:alertsContext.metadata,fields:derivedIndexPattern.fields})),external_kbnSharedDeps_React_default.a.createElement(common_["ForLastExpression"],{timeWindowSize:timeSize,timeWindowUnit:timeUnit,errors:emptyError,onChangeWindowSize:updateTimeSize,onChangeWindowUnit:updateTimeUnit}),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"primary",iconSide:"left",flush:"left",iconType:"plusInCircleFilled",onClick:addExpression},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.infra.metrics.alertFlyout.addCondition",defaultMessage:"Add condition"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"metrics-alert-no-data-toggle",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.alertOnNoData",{defaultMessage:"Alert me if there's no data"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.noDataHelpText",{defaultMessage:"Enable this to trigger the action if the metric(s) do not report any data over the expected time period, or if the alert fails to query Elasticsearch"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"questionInCircle",color:"subdued"}))),checked:alertParams.alertOnNoData,onChange:e=>setAlertParams("alertOnNoData",e.target.checked)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.filterLabel",{defaultMessage:"Filter (optional)"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.filterHelpText",{defaultMessage:"Use a KQL expression to limit the scope of your alert trigger."}),fullWidth:true,display:"rowCompressed"},alertsContext.metadata&&external_kbnSharedDeps_React_default.a.createElement(kuery_bar["a"],{derivedIndexPattern:derivedIndexPattern,onSubmit:onFilterChange,onChange:debouncedOnFilterChange,value:alertParams.filterQueryText})||external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldSearch"],{onChange:handleFieldSearchChange,value:alertParams.filterQueryText,fullWidth:true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(common["a"],{alertInterval:alertInterval,alertThrottle:alertThrottle,alertType:alerting_metrics["d"],alertParams:Object(external_kbnSharedDeps_Lodash_["pick"])(alertParams,"criteria","nodeType","sourceId","filterQuery"),validate:validation["a"],fetch:alertsContext.http.fetch,groupByDisplayName:alertParams.nodeType,showNoDataResults:alertParams.alertOnNoData}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};var components_expression=__webpack_exports__["default"]=Expressions;const StyledExpressionRow=Object(public_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"])(_templateObject());const StyledExpression=public_["euiStyled"].div(_templateObject2());const ExpressionRow=props=>{var _ofFields$find,_metricUnit$metric;const setAlertParams=props.setAlertParams,expression=props.expression,errors=props.errors,expressionId=props.expressionId,remove=props.remove,canDelete=props.canDelete,fields=props.fields;const metric=expression.metric,_expression$comparato=expression.comparator,comparator=_expression$comparato===void 0?types["a"].GT:_expression$comparato,_expression$threshold=expression.threshold,threshold=_expression$threshold===void 0?[]:_expression$threshold,customMetric=expression.customMetric;const updateMetric=Object(external_kbnSharedDeps_React_["useCallback"])(m=>{const newMetric=inventory_models_types["e"].is(m)?m:Boolean(m)?"custom":undefined;const newAlertParams=expression_objectSpread(expression_objectSpread({},expression),{},{metric:newMetric});setAlertParams(expressionId,newAlertParams)},[expressionId,expression,setAlertParams]);const updateCustomMetric=Object(external_kbnSharedDeps_React_["useCallback"])(cm=>{if(snapshot_api["d"].is(cm)){setAlertParams(expressionId,expression_objectSpread(expression_objectSpread({},expression),{},{customMetric:cm}))}},[expressionId,expression,setAlertParams]);const updateComparator=Object(external_kbnSharedDeps_React_["useCallback"])(c=>{setAlertParams(expressionId,expression_objectSpread(expression_objectSpread({},expression),{},{comparator:c}))},[expressionId,expression,setAlertParams]);const updateThreshold=Object(external_kbnSharedDeps_React_["useCallback"])(t=>{if(t.join()!==expression.threshold.join()){setAlertParams(expressionId,expression_objectSpread(expression_objectSpread({},expression),{},{threshold:t}))}},[expressionId,expression,setAlertParams]);const ofFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{let myMetrics=host_toolbar_items["b"];switch(props.nodeType){case"awsEC2":myMetrics=aws_ec2_toolbar_items["b"];break;case"awsRDS":myMetrics=aws_rds_toolbar_items["b"];break;case"awsS3":myMetrics=aws_s3_toolbar_items["b"];break;case"awsSQS":myMetrics=toolbar_items["b"];break;case"host":myMetrics=host_toolbar_items["b"];break;case"pod":myMetrics=pod_toolbar_items["b"];break;case"container":myMetrics=container_toolbar_items["b"];break}return myMetrics.map(snapshot_metric_i18n["a"])},[props.nodeType]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true},external_kbnSharedDeps_React_default.a.createElement(StyledExpressionRow,null,external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(MetricExpression,{metric:{value:metric,text:((_ofFields$find=ofFields.find(v=>(v===null||v===void 0?void 0:v.value)===metric))===null||_ofFields$find===void 0?void 0:_ofFields$find.text)||""},metrics:ofFields.filter(m=>m!==undefined&&m.value!==undefined),onChange:updateMetric,onChangeCustom:updateCustomMetric,errors:errors,customMetric:customMetric,fields:fields})),external_kbnSharedDeps_React_default.a.createElement(StyledExpression,null,external_kbnSharedDeps_React_default.a.createElement(common_["ThresholdExpression"],{thresholdComparator:comparator||types["a"].GT,threshold:threshold,onChangeSelectedThresholdComparator:updateComparator,onChangeSelectedThreshold:updateThreshold,errors:errors})),metric&&external_kbnSharedDeps_React_default.a.createElement("div",{style:{alignSelf:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},((_metricUnit$metric=metricUnit[metric])===null||_metricUnit$metric===void 0?void 0:_metricUnit$metric.label)||"")))),canDelete&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.infra.metrics.alertFlyout.removeCondition",{defaultMessage:"Remove condition"}),color:"danger",iconType:"trash",onClick:()=>remove(expressionId)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))};const getDisplayNameForType=type=>{const inventoryModel=Object(inventory_models["b"])(type);return inventoryModel.displayName};const nodeTypes={host:{text:getDisplayNameForType("host"),value:"host"},pod:{text:getDisplayNameForType("pod"),value:"pod"},container:{text:getDisplayNameForType("container"),value:"container"},awsEC2:{text:getDisplayNameForType("awsEC2"),value:"awsEC2"},awsS3:{text:getDisplayNameForType("awsS3"),value:"awsS3"},awsRDS:{text:getDisplayNameForType("awsRDS"),value:"awsRDS"},awsSQS:{text:getDisplayNameForType("awsSQS"),value:"awsSQS"}};const metricUnit={count:{label:""},cpu:{label:"%"},memory:{label:"%"},rx:{label:"bits/s"},tx:{label:"bits/s"},logRate:{label:"/s"},diskIOReadBytes:{label:"bytes/s"},diskIOWriteBytes:{label:"bytes/s"},s3BucketSize:{label:"bytes"},s3TotalRequests:{label:""},s3NumberOfObjects:{label:""},s3UploadBytes:{label:"bytes"},s3DownloadBytes:{label:"bytes"},sqsOldestMessage:{label:"seconds"},rdsLatency:{label:"ms"},custom:{label:""}}},87:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"g",(function(){return SnapshotNodeResponseRT}));__webpack_require__.d(__webpack_exports__,"a",(function(){return InfraTimerangeInputRT}));__webpack_require__.d(__webpack_exports__,"e",(function(){return SnapshotGroupByRT}));__webpack_require__.d(__webpack_exports__,"b",(function(){return SNAPSHOT_CUSTOM_AGGREGATIONS}));__webpack_require__.d(__webpack_exports__,"c",(function(){return SnapshotCustomAggregationRT}));__webpack_require__.d(__webpack_exports__,"d",(function(){return SnapshotCustomMetricInputRT}));__webpack_require__.d(__webpack_exports__,"f",(function(){return SnapshotMetricInputRT}));var io_ts__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var io_ts__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(io_ts__WEBPACK_IMPORTED_MODULE_0__);var _inventory_models_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83);var _metrics_api__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(118);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const SnapshotNodePathRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({value:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],label:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({ip:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]])})]);const SnapshotNodeMetricOptionalRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({value:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),avg:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),max:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),timeseries:_metrics_api__WEBPACK_IMPORTED_MODULE_2__["a"]});const SnapshotNodeMetricRequiredRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({name:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([_inventory_models_types__WEBPACK_IMPORTED_MODULE_1__["e"],io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]])});const SnapshotNodeMetricRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([SnapshotNodeMetricRequiredRT,SnapshotNodeMetricOptionalRT]);const SnapshotNodeRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({metrics:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](SnapshotNodeMetricRT),path:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](SnapshotNodePathRT),name:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]});const SnapshotNodeResponseRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({nodes:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](SnapshotNodeRT),interval:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]});const InfraTimerangeInputRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({interval:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],to:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],from:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"]}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({lookbackSize:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"],ignoreLookback:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"],forceInterval:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"]})]);const SnapshotGroupByRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({label:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),field:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]])}));const SnapshotNamedMetricInputRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({type:_inventory_models_types__WEBPACK_IMPORTED_MODULE_1__["e"]});const SNAPSHOT_CUSTOM_AGGREGATIONS=["avg","max","min","rate"];const snapshotCustomAggregationKeys=SNAPSHOT_CUSTOM_AGGREGATIONS.reduce((acc,agg)=>_objectSpread(_objectSpread({},acc),{},{[agg]:null}),{});const SnapshotCustomAggregationRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["keyof"](snapshotCustomAggregationKeys);const SnapshotCustomMetricInputRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({type:io_ts__WEBPACK_IMPORTED_MODULE_0__["literal"]("custom"),field:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],aggregation:SnapshotCustomAggregationRT,id:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({label:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]})]);const SnapshotMetricInputRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([SnapshotNamedMetricInputRT,SnapshotCustomMetricInputRT]);const SnapshotRequestRT=io_ts__WEBPACK_IMPORTED_MODULE_0__["intersection"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["type"]({timerange:InfraTimerangeInputRT,metrics:io_ts__WEBPACK_IMPORTED_MODULE_0__["array"](SnapshotMetricInputRT),groupBy:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([SnapshotGroupByRT,io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),nodeType:_inventory_models_types__WEBPACK_IMPORTED_MODULE_1__["c"],sourceId:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"]}),io_ts__WEBPACK_IMPORTED_MODULE_0__["partial"]({accountId:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],region:io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],filterQuery:io_ts__WEBPACK_IMPORTED_MODULE_0__["union"]([io_ts__WEBPACK_IMPORTED_MODULE_0__["string"],io_ts__WEBPACK_IMPORTED_MODULE_0__["null"]]),includeTimeseries:io_ts__WEBPACK_IMPORTED_MODULE_0__["boolean"],overrideCompositeSize:io_ts__WEBPACK_IMPORTED_MODULE_0__["number"]})])}}]);