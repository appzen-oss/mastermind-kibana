/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["ml_bundle_jsonpfunction"]=window["ml_bundle_jsonpfunction"]||[]).push([[19],{747:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"EmbeddableSwimLaneContainer",(function(){return EmbeddableSwimLaneContainer}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(26);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(27);var external_kbnSharedDeps_Rxjs_=__webpack_require__(17);var external_kbnSharedDeps_Lodash_=__webpack_require__(7);var external_kbnSharedDeps_RxjsOperators_=__webpack_require__(18);var time_buckets=__webpack_require__(83);var explorer_constants=__webpack_require__(60);var public_=__webpack_require__(30);var parse_interval=__webpack_require__(66);var swimlane_container=__webpack_require__(160);var embeddable_public_=__webpack_require__(36);var apply_influencer_filters_action=__webpack_require__(112);function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e3){didErr=true;err=_e3},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const FETCH_RESULTS_DEBOUNCE_MS=500;function getJobsObservable(embeddableInput,anomalyDetectorService){return embeddableInput.pipe(Object(external_kbnSharedDeps_RxjsOperators_["pluck"])("jobIds"),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])(external_kbnSharedDeps_Lodash_["isEqual"]),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(jobsIds=>anomalyDetectorService.getJobs$(jobsIds)))}function useSwimlaneInputResolver(embeddableInput,onInputChange,refresh,services,chartWidth,fromPage){const _services=_slicedToArray(services,3),uiSettings=_services[0].uiSettings,_services$=_services[2],anomalyTimelineService=_services$.anomalyTimelineService,anomalyDetectorService=_services$.anomalyDetectorService;const _useState=Object(external_kbnSharedDeps_React_["useState"])(),_useState2=_slicedToArray(_useState,2),swimlaneData=_useState2[0],setSwimlaneData=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])(),_useState4=_slicedToArray(_useState3,2),swimlaneType=_useState4[0],setSwimlaneType=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];const _useState7=Object(external_kbnSharedDeps_React_["useState"])(),_useState8=_slicedToArray(_useState7,2),perPage=_useState8[0],setPerPage=_useState8[1];const _useState9=Object(external_kbnSharedDeps_React_["useState"])(false),_useState10=_slicedToArray(_useState9,2),isLoading=_useState10[0],setIsLoading=_useState10[1];const chartWidth$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new external_kbnSharedDeps_Rxjs_["Subject"],[]);const fromPage$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new external_kbnSharedDeps_Rxjs_["Subject"],[]);const perPage$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new external_kbnSharedDeps_Rxjs_["Subject"],[]);const timeBuckets=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new time_buckets["a"]({"histogram:maxBars":uiSettings.get(public_["UI_SETTINGS"].HISTOGRAM_MAX_BARS),"histogram:barTarget":uiSettings.get(public_["UI_SETTINGS"].HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")}),[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=Object(external_kbnSharedDeps_Rxjs_["combineLatest"])([getJobsObservable(embeddableInput,anomalyDetectorService),embeddableInput,chartWidth$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["skipWhile"])(v=>!v)),fromPage$,perPage$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["startWith"])(undefined),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])((prev,curr)=>prev===undefined&&curr===explorer_constants["i"])),refresh.pipe(Object(external_kbnSharedDeps_RxjsOperators_["startWith"])(null))]).pipe(Object(external_kbnSharedDeps_RxjsOperators_["tap"])(setIsLoading.bind(null,true)),Object(external_kbnSharedDeps_RxjsOperators_["debounceTime"])(FETCH_RESULTS_DEBOUNCE_MS),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(([jobs,input,swimlaneContainerWidth,fromPageInput,perPageFromState])=>{const viewBy=input.viewBy,swimlaneTypeInput=input.swimlaneType,perPageInput=input.perPage,timeRange=input.timeRange,filters=input.filters,query=input.query,viewMode=input.viewMode;anomalyTimelineService.setTimeRange(timeRange);if(!swimlaneType){setSwimlaneType(swimlaneTypeInput)}const explorerJobs=jobs.map(job=>{const bucketSpan=Object(parse_interval["a"])(job.analysis_config.bucket_span);return{id:job.job_id,selected:true,bucketSpanSeconds:bucketSpan.asSeconds()}});let appliedFilters;try{appliedFilters=processFilters(filters,query)}catch(e){setError(e);return Object(external_kbnSharedDeps_Rxjs_["of"])(undefined)}return Object(external_kbnSharedDeps_Rxjs_["from"])(anomalyTimelineService.loadOverallData(explorerJobs,swimlaneContainerWidth)).pipe(Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(overallSwimlaneData=>{const earliest=overallSwimlaneData.earliest,latest=overallSwimlaneData.latest;if(overallSwimlaneData&&swimlaneTypeInput===explorer_constants["h"].VIEW_BY){var _ref;if(perPageFromState===undefined){setPerPage(perPageInput!==null&&perPageInput!==void 0?perPageInput:explorer_constants["i"])}if(viewMode===embeddable_public_["ViewMode"].EDIT&&perPageFromState!==perPageInput){onInputChange({perPage:perPageFromState})}return Object(external_kbnSharedDeps_Rxjs_["from"])(anomalyTimelineService.loadViewBySwimlane([],{earliest:earliest,latest:latest},explorerJobs,viewBy,Object(swimlane_container["b"])(swimlaneData)?swimlaneData.cardinality:explorer_constants["a"],(_ref=perPageFromState!==null&&perPageFromState!==void 0?perPageFromState:perPageInput)!==null&&_ref!==void 0?_ref:explorer_constants["i"],fromPageInput,swimlaneContainerWidth,appliedFilters)).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(viewBySwimlaneData=>_objectSpread(_objectSpread({},viewBySwimlaneData),{},{earliest:earliest,latest:latest})))}return Object(external_kbnSharedDeps_Rxjs_["of"])(overallSwimlaneData)}))}),Object(external_kbnSharedDeps_RxjsOperators_["catchError"])(e=>{setError(e.body);return Object(external_kbnSharedDeps_Rxjs_["of"])(undefined)})).subscribe(data=>{if(data!==undefined){setError(null);setSwimlaneData(data);setIsLoading(false)}});return()=>{subscription.unsubscribe()}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fromPage$.next(fromPage)},[fromPage]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(perPage===undefined)return;perPage$.next(perPage)},[perPage]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{chartWidth$.next(chartWidth)},[chartWidth]);return[swimlaneType,swimlaneData,perPage!==null&&perPage!==void 0?perPage:explorer_constants["i"],setPerPage,timeBuckets,isLoading,error]}function processFilters(filters,query){const inputQuery=query.language==="kuery"?public_["esKuery"].toElasticsearchQuery(public_["esKuery"].fromKueryExpression(query.query)):query.query;const must=[inputQuery];const mustNot=[];var _iterator=_createForOfIteratorHelper(filters),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){const filter=_step.value;if(filter.meta.disabled||filter.meta.controlledBy===apply_influencer_filters_action["a"])continue;const _filter$meta=filter.meta,negate=_filter$meta.negate,type=_filter$meta.type,fieldName=_filter$meta.key;let filterQuery=filter.query;if(filterQuery===undefined&&type==="exists"){filterQuery={exists:{field:fieldName}}}if(negate){mustNot.push(filterQuery)}else{must.push(filterQuery)}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return{bool:{must:must,must_not:mustNot}}}var ui_actions=__webpack_require__(139);function _objectDestructuringEmpty(obj){if(obj==null)throw new TypeError("Cannot destructure undefined")}function embeddable_swim_lane_container_slicedToArray(arr,i){return embeddable_swim_lane_container_arrayWithHoles(arr)||embeddable_swim_lane_container_iterableToArrayLimit(arr,i)||embeddable_swim_lane_container_unsupportedIterableToArray(arr,i)||embeddable_swim_lane_container_nonIterableRest()}function embeddable_swim_lane_container_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function embeddable_swim_lane_container_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return embeddable_swim_lane_container_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return embeddable_swim_lane_container_arrayLikeToArray(o,minLen)}function embeddable_swim_lane_container_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function embeddable_swim_lane_container_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function embeddable_swim_lane_container_arrayWithHoles(arr){if(Array.isArray(arr))return arr}const EmbeddableSwimLaneContainer=({id:id,embeddableContext:embeddableContext,embeddableInput:embeddableInput,services:services,refresh:refresh,onInputChange:onInputChange,onOutputChange:onOutputChange})=>{const _useState=Object(external_kbnSharedDeps_React_["useState"])(0),_useState2=embeddable_swim_lane_container_slicedToArray(_useState,2),chartWidth=_useState2[0],setChartWidth=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])(1),_useState4=embeddable_swim_lane_container_slicedToArray(_useState3,2),fromPage=_useState4[0],setFromPage=_useState4[1];const _services=embeddable_swim_lane_container_slicedToArray(services,2);_objectDestructuringEmpty(_services[0]);const uiActions=_services[1].uiActions;const _useState5=Object(external_kbnSharedDeps_React_["useState"])(),_useState6=embeddable_swim_lane_container_slicedToArray(_useState5,2),selectedCells=_useState6[0],setSelectedCells=_useState6[1];const _useSwimlaneInputReso=useSwimlaneInputResolver(embeddableInput,onInputChange,refresh,services,chartWidth,fromPage),_useSwimlaneInputReso2=embeddable_swim_lane_container_slicedToArray(_useSwimlaneInputReso,7),swimlaneType=_useSwimlaneInputReso2[0],swimlaneData=_useSwimlaneInputReso2[1],perPage=_useSwimlaneInputReso2[2],setPerPage=_useSwimlaneInputReso2[3],timeBuckets=_useSwimlaneInputReso2[4],isLoading=_useSwimlaneInputReso2[5],error=_useSwimlaneInputReso2[6];Object(external_kbnSharedDeps_React_["useEffect"])(()=>{onOutputChange({perPage:perPage,fromPage:fromPage,interval:swimlaneData===null||swimlaneData===void 0?void 0:swimlaneData.interval})},[perPage,fromPage,swimlaneData]);const onCellsSelection=Object(external_kbnSharedDeps_React_["useCallback"])(update=>{setSelectedCells(update);if(update){uiActions.getTrigger(ui_actions["a"]).exec({embeddable:embeddableContext,data:update,updateCallback:setSelectedCells.bind(null,undefined)})}},[swimlaneData,perPage,fromPage,setSelectedCells]);if(error){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.errorMessage",defaultMessage:"Unable to load the ML swim lane data"}),color:"danger",iconType:"alert",style:{width:"100%"}},external_kbnSharedDeps_React_default.a.createElement("p",null,error.message))}return external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"100%",padding:"8px"},"data-test-subj":"mlAnomalySwimlaneEmbeddableWrapper"},external_kbnSharedDeps_React_default.a.createElement(swimlane_container["a"],{id:id,"data-test-subj":"mlSwimLaneEmbeddable_".concat(embeddableContext.id),timeBuckets:timeBuckets,swimlaneData:swimlaneData,swimlaneType:swimlaneType,fromPage:fromPage,perPage:perPage,swimlaneLimit:Object(swimlane_container["b"])(swimlaneData)?swimlaneData.cardinality:undefined,onResize:setChartWidth,selection:selectedCells,onCellsSelection:onCellsSelection,onPaginationChange:update=>{if(update.fromPage){setFromPage(update.fromPage)}if(update.perPage){setFromPage(1);setPerPage(update.perPage)}},isLoading:isLoading,noDataWarning:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.noDataFound",defaultMessage:"No anomalies found"})}))};var embeddable_swim_lane_container=__webpack_exports__["default"]=EmbeddableSwimLaneContainer}}]);