/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["ml_bundle_jsonpfunction"]=window["ml_bundle_jsonpfunction"]||[]).push([[9,17],{347:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"AnomalyDetectorService",(function(){return AnomalyDetectorService}));var rxjs_operators__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(18);var rxjs_operators__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(rxjs_operators__WEBPACK_IMPORTED_MODULE_0__);var _ml_api_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(50);function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class AnomalyDetectorService{constructor(httpService){this.httpService=httpService;_defineProperty(this,"apiBasePath",Object(_ml_api_service__WEBPACK_IMPORTED_MODULE_1__["basePath"])()+"/anomaly_detectors")}getJobById$(jobId){return this.httpService.http$({path:"".concat(this.apiBasePath,"/").concat(jobId)}).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_0__["map"])(response=>response.jobs[0]))}getJobs$(jobIds){return this.httpService.http$({path:"".concat(this.apiBasePath,"/").concat(jobIds.join(","))}).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_0__["map"])(response=>response.jobs))}extractInfluencers(jobs){if(!Array.isArray(jobs)){jobs=[jobs]}const influencers=new Set;var _iterator=_createForOfIteratorHelper(jobs),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){const job=_step.value;var _iterator2=_createForOfIteratorHelper(job.analysis_config.influencers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){const influencer=_step2.value;influencers.add(influencer)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return Array.from(influencers)}}},746:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"resolveAnomalySwimlaneUserInput",(function(){return resolveAnomalySwimlaneUserInput}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_Moment_=__webpack_require__(28);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);var external_kbnSharedDeps_RxjsOperators_=__webpack_require__(18);var external_kbnSharedDeps_Rxjs_=__webpack_require__(17);var explorer_constants=__webpack_require__(60);var public_=__webpack_require__(29);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(26);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(27);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}const AnomalySwimlaneInitializer=({defaultTitle:defaultTitle,influencers:influencers,onCreate:onCreate,onCancel:onCancel,initialInput:initialInput})=>{var _initialInput$swimlan;const _useState=Object(external_kbnSharedDeps_React_["useState"])(defaultTitle),_useState2=_slicedToArray(_useState,2),panelTitle=_useState2[0],setPanelTitle=_useState2[1];const _useState3=Object(external_kbnSharedDeps_React_["useState"])((_initialInput$swimlan=initialInput===null||initialInput===void 0?void 0:initialInput.swimlaneType)!==null&&_initialInput$swimlan!==void 0?_initialInput$swimlan:explorer_constants["h"].OVERALL),_useState4=_slicedToArray(_useState3,2),swimlaneType=_useState4[0],setSwimlaneType=_useState4[1];const _useState5=Object(external_kbnSharedDeps_React_["useState"])(initialInput===null||initialInput===void 0?void 0:initialInput.viewBy),_useState6=_slicedToArray(_useState5,2),viewBySwimlaneFieldName=_useState6[0],setViewBySwimlaneFieldName=_useState6[1];const swimlaneTypeOptions=[{id:explorer_constants["h"].OVERALL,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"})},{id:explorer_constants["h"].VIEW_BY,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.viewByLabel",{defaultMessage:"View by"})}];const viewBySwimlaneOptions=["",...influencers].map(influencer=>({value:influencer,text:influencer}));const isPanelTitleValid=panelTitle.length>0;const isFormValid=isPanelTitleValid&&(swimlaneType===explorer_constants["h"].OVERALL||swimlaneType===explorer_constants["h"].VIEW_BY&&!!viewBySwimlaneFieldName);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{initialFocus:"[name=panelTitle]",onClose:onCancel},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.setupModal.title",defaultMessage:"Anomaly swim lane configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.panelTitleLabel",defaultMessage:"Panel title"}),isInvalid:!isPanelTitleValid},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{id:"panelTitle",name:"panelTitle",value:panelTitle,onChange:e=>setPanelTitle(e.target.value),isInvalid:!isPanelTitleValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",defaultMessage:"Swim lane type"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{id:"selectSwimlaneType",name:"selectSwimlaneType",color:"primary",isFullWidth:true,legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.swimlaneEmbeddable.setupModal.swimlaneTypeLabel",{defaultMessage:"Swim lane type"}),options:swimlaneTypeOptions,idSelected:swimlaneType,onChange:id=>setSwimlaneType(id)})),swimlaneType===explorer_constants["h"].VIEW_BY&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.viewByLabel",defaultMessage:"View by"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{id:"selectViewBy",name:"selectViewBy",options:viewBySwimlaneOptions,value:viewBySwimlaneFieldName,onChange:e=>setViewBySwimlaneFieldName(e.target.value)}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onCancel},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.setupModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:!isFormValid,onClick:onCreate.bind(null,{panelTitle:panelTitle,swimlaneType:swimlaneType,viewBy:viewBySwimlaneFieldName}),fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.swimlaneEmbeddable.setupModal.confirmButtonLabel",defaultMessage:"Confirm"}))))};var job_selector_flyout=__webpack_require__(351);var anomaly_detector_service=__webpack_require__(347);var job_selector=__webpack_require__(237);var anomaly_swimlane_embeddable=__webpack_require__(239);var app=__webpack_require__(348);var http_service=__webpack_require__(87);var dashboard_public_=__webpack_require__(44);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function resolveAnomalySwimlaneUserInput(_x,_x2){return _resolveAnomalySwimlaneUserInput.apply(this,arguments)}function _resolveAnomalySwimlaneUserInput(){_resolveAnomalySwimlaneUserInput=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(coreStart,input){var http,uiSettings,overlays,currentAppId$,anomalyDetectorService;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:http=coreStart.http,uiSettings=coreStart.uiSettings,overlays=coreStart.overlays,currentAppId$=coreStart.application.currentAppId$;anomalyDetectorService=new anomaly_detector_service["AnomalyDetectorService"](new http_service["a"](http));return _context3.abrupt("return",new Promise(function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(resolve,reject){var maps,tzConfig,dateFormatTz,selectedIds,flyoutSession;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:maps={groupsMap:Object(job_selector["b"])([]),jobsMap:{}};tzConfig=uiSettings.get("dateFormat:tz");dateFormatTz=tzConfig!=="Browser"?tzConfig:external_kbnSharedDeps_Moment_default.a.tz.guess();selectedIds=input===null||input===void 0?void 0:input.jobIds;flyoutSession=coreStart.overlays.openFlyout(Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement(public_["KibanaContextProvider"],{services:_objectSpread(_objectSpread({},coreStart),{},{mlServices:Object(app["getMlGlobalServices"])(http)})},external_kbnSharedDeps_React_default.a.createElement(job_selector_flyout["b"],{selectedIds:selectedIds,withTimeRangeSelector:false,dateFormatTz:dateFormatTz,singleSelection:false,timeseriesOnly:true,onFlyoutClose:()=>{flyoutSession.close();reject()},onSelectionConfirmed:function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee({jobIds:jobIds,groups:groups}){var _input$title;var title,jobs,influencers,modalSession;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:title=(_input$title=input===null||input===void 0?void 0:input.title)!==null&&_input$title!==void 0?_input$title:Object(anomaly_swimlane_embeddable["getDefaultPanelTitle"])(jobIds);_context.next=3;return anomalyDetectorService.getJobs$(jobIds).toPromise();case 3:jobs=_context.sent;influencers=anomalyDetectorService.extractInfluencers(jobs);influencers.push(explorer_constants["j"]);_context.next=8;return flyoutSession.close();case 8:modalSession=overlays.openModal(Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement(AnomalySwimlaneInitializer,{defaultTitle:title,influencers:influencers,initialInput:input,onCreate:({panelTitle:panelTitle,viewBy:viewBy,swimlaneType:swimlaneType})=>{modalSession.close();resolve({jobIds:jobIds,title:panelTitle,swimlaneType:swimlaneType,viewBy:viewBy})},onCancel:()=>{modalSession.close();reject()}})));case 9:case"end":return _context.stop()}}),_callee)})));return function(_x5){return _ref2.apply(this,arguments)}}(),maps:maps}))),{"data-test-subj":"mlFlyoutJobSelector",ownFocus:true,closeButtonAriaLabel:"jobSelectorFlyout"});currentAppId$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["takeUntil"])(Object(external_kbnSharedDeps_Rxjs_["from"])(flyoutSession.onClose))).subscribe(appId=>{if(appId!==dashboard_public_["DashboardConstants"].DASHBOARDS_ID){flyoutSession.close()}});case 6:case"end":return _context2.stop()}}),_callee2)})));return function(_x3,_x4){return _ref.apply(this,arguments)}}()));case 3:case"end":return _context3.stop()}}),_callee3)})));return _resolveAnomalySwimlaneUserInput.apply(this,arguments)}}}]);