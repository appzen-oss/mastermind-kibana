/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
(window["ml_bundle_jsonpfunction"]=window["ml_bundle_jsonpfunction"]||[]).push([[15],{113:function(module,exports,__webpack_require__){const moment=__webpack_require__(28);const unitsMap={ms:{weight:1,type:"fixed",base:1},s:{weight:2,type:"fixed",base:1e3},m:{weight:3,type:"mixed",base:1e3*60},h:{weight:4,type:"mixed",base:1e3*60*60},d:{weight:5,type:"mixed",base:1e3*60*60*24},w:{weight:6,type:"calendar",base:NaN},M:{weight:7,type:"calendar",base:NaN},y:{weight:9,type:"calendar",base:NaN}};const units=Object.keys(unitsMap).sort((a,b)=>unitsMap[b].weight-unitsMap[a].weight);const unitsDesc=[...units];const unitsAsc=[...units].reverse();const isDate=d=>Object.prototype.toString.call(d)==="[object Date]";const isValidDate=d=>isDate(d)&&!isNaN(d.valueOf());function parse(text,{roundUp:roundUp=false,momentInstance:momentInstance=moment,forceNow:forceNow}={}){if(!text)return undefined;if(momentInstance.isMoment(text))return text;if(isDate(text))return momentInstance(text);if(forceNow!==undefined&&!isValidDate(forceNow)){throw new Error("forceNow must be a valid Date")}let time;let mathString="";let index;let parseString;if(text.substring(0,3)==="now"){time=momentInstance(forceNow);mathString=text.substring("now".length)}else{index=text.indexOf("||");if(index===-1){parseString=text;mathString=""}else{parseString=text.substring(0,index);mathString=text.substring(index+2)}time=momentInstance(parseString)}if(!mathString.length){return time}return parseDateMath(mathString,time,roundUp)}function parseDateMath(mathString,time,roundUp){const dateTime=time;const len=mathString.length;let i=0;while(i<len){const c=mathString.charAt(i++);let type;let num;let unit;if(c==="/"){type=0}else if(c==="+"){type=1}else if(c==="-"){type=2}else{return}if(isNaN(mathString.charAt(i))){num=1}else if(mathString.length===2){num=mathString.charAt(i)}else{const numFrom=i;while(!isNaN(mathString.charAt(i))){i++;if(i>=len)return}num=parseInt(mathString.substring(numFrom,i),10)}if(type===0){if(num!==1){return}}unit=mathString.charAt(i++);for(let j=i;j<len;j++){const unitChar=mathString.charAt(i);if(/[a-z]/i.test(unitChar)){unit+=unitChar;i++}else{break}}if(units.indexOf(unit)===-1){return}else{if(type===0){if(roundUp)dateTime.endOf(unit);else dateTime.startOf(unit)}else if(type===1){dateTime.add(num,unit)}else if(type===2){dateTime.subtract(num,unit)}}}return dateTime}module.exports={parse:parse,unitsMap:Object.freeze(unitsMap),units:Object.freeze(units),unitsAsc:Object.freeze(unitsAsc),unitsDesc:Object.freeze(unitsDesc)}},346:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"AnomalyTimelineService",(function(){return AnomalyTimelineService}));var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(30);var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__);var _util_time_buckets__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83);var _explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(60);function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class AnomalyTimelineService{constructor(timeFilter,uiSettings,mlResultsService){this.timeFilter=timeFilter;this.mlResultsService=mlResultsService;_defineProperty(this,"timeBuckets",void 0);_defineProperty(this,"_customTimeRange",void 0);this.timeBuckets=new _util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["a"]({"histogram:maxBars":uiSettings.get(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["UI_SETTINGS"].HISTOGRAM_MAX_BARS),"histogram:barTarget":uiSettings.get(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["UI_SETTINGS"].HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")});this.timeFilter.enableTimeRangeSelector()}setTimeRange(timeRange){this._customTimeRange=timeRange}getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth){const bounds=this.getTimeBounds();if(bounds===undefined){throw new Error("timeRangeSelectorEnabled has to be enabled")}this.timeBuckets.setInterval("auto");this.timeBuckets.setBounds(bounds);const intervalSeconds=this.timeBuckets.getInterval().asSeconds();const timerangeSeconds=(bounds.max.valueOf()-bounds.min.valueOf())/1e3;const numBuckets=timerangeSeconds/intervalSeconds;const cellWidth=Math.floor(swimlaneContainerWidth/numBuckets*100)/100;if(cellWidth<8){this.timeBuckets.setInterval(intervalSeconds*2+"s")}const maxBucketSpanSeconds=selectedJobs.reduce((memo,job)=>Math.max(memo,job.bucketSpanSeconds),0);if(maxBucketSpanSeconds>intervalSeconds){this.timeBuckets.setInterval(maxBucketSpanSeconds+"s");this.timeBuckets.setBounds(bounds)}return this.timeBuckets.getInterval()}loadOverallData(selectedJobs,chartWidth){var _this=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee(){var interval,bounds,searchBounds,selectedJobIds,overallBucketsBounds,resp,overallSwimlaneData;return regeneratorRuntime.wrap((function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:interval=_this.getSwimlaneBucketInterval(selectedJobs,chartWidth);if(!(!selectedJobs||!selectedJobs.length)){_context.next=3;break}throw new Error("Explorer jobs collection is required");case 3:bounds=_this.getTimeBounds();searchBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(bounds,interval,false);selectedJobIds=selectedJobs.map(d=>d.id);overallBucketsBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(bounds,interval,true);_context.next=9;return _this.mlResultsService.getOverallBucketScores(selectedJobIds,1,overallBucketsBounds.min.valueOf(),overallBucketsBounds.max.valueOf(),interval.asSeconds()+"s");case 9:resp=_context.sent;overallSwimlaneData=_this.processOverallResults(resp.results,searchBounds,interval.asSeconds());console.log("Explorer overall swim lane data set:",overallSwimlaneData);return _context.abrupt("return",overallSwimlaneData);case 13:case"end":return _context.stop()}}),_callee)})))()}loadViewBySwimlane(fieldValues,bounds,selectedJobs,viewBySwimlaneFieldName,swimlaneLimit,perPage,fromPage,swimlaneContainerWidth,influencersFilterQuery){var _this2=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee2(){var timefilterBounds,swimlaneBucketInterval,searchBounds,selectedJobIds,intervalMs,response,jobIds,viewBySwimlaneData;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:timefilterBounds=_this2.getTimeBounds();if(!(timefilterBounds===undefined)){_context2.next=3;break}throw new Error("timeRangeSelectorEnabled has to be enabled");case 3:swimlaneBucketInterval=_this2.getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth);searchBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(timefilterBounds,swimlaneBucketInterval,false);selectedJobIds=selectedJobs.map(d=>d.id);intervalMs=swimlaneBucketInterval.asMilliseconds();if(!(viewBySwimlaneFieldName===_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["j"])){_context2.next=14;break}jobIds=fieldValues!==undefined&&fieldValues.length>0?fieldValues:selectedJobIds;_context2.next=11;return _this2.mlResultsService.getScoresByBucket(jobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),intervalMs,perPage,fromPage);case 11:response=_context2.sent;_context2.next=17;break;case 14:_context2.next=16;return _this2.mlResultsService.getInfluencerValueMaxScoreByTime(selectedJobIds,viewBySwimlaneFieldName,fieldValues,searchBounds.min.valueOf(),searchBounds.max.valueOf(),intervalMs,swimlaneLimit,perPage,fromPage,influencersFilterQuery);case 16:response=_context2.sent;case 17:if(!(response===undefined)){_context2.next=19;break}return _context2.abrupt("return");case 19:viewBySwimlaneData=_this2.processViewByResults(response.results,response.cardinality,fieldValues,bounds,viewBySwimlaneFieldName,swimlaneBucketInterval.asSeconds());console.log("Explorer view by swim lane data set:",viewBySwimlaneData);return _context2.abrupt("return",viewBySwimlaneData);case 22:case"end":return _context2.stop()}}),_callee2)})))()}loadViewByTopFieldValuesForSelectedTime(earliestMs,latestMs,selectedJobs,viewBySwimlaneFieldName,swimlaneLimit,perPage,fromPage,swimlaneContainerWidth){var _this3=this;return _asyncToGenerator(regeneratorRuntime.mark((function _callee3(){var selectedJobIds,resp,topFieldValues,topInfluencers;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:selectedJobIds=selectedJobs.map(d=>d.id);if(!(viewBySwimlaneFieldName!==_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["j"])){_context3.next=13;break}_context3.next=4;return _this3.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,swimlaneLimit,perPage,fromPage);case 4:resp=_context3.sent;if(!(resp.influencers[viewBySwimlaneFieldName]===undefined)){_context3.next=7;break}return _context3.abrupt("return",[]);case 7:topFieldValues=[];topInfluencers=resp.influencers[viewBySwimlaneFieldName];if(Array.isArray(topInfluencers)){topInfluencers.forEach(influencerData=>{if(influencerData.maxAnomalyScore>0){topFieldValues.push(influencerData.influencerFieldValue)}})}return _context3.abrupt("return",topFieldValues);case 13:_context3.next=15;return _this3.mlResultsService.getScoresByBucket(selectedJobIds,earliestMs,latestMs,_this3.getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth).asMilliseconds(),swimlaneLimit);case 15:resp=_context3.sent;return _context3.abrupt("return",Object.keys(resp.results));case 17:case"end":return _context3.stop()}}),_callee3)})))()}getTimeBounds(){return this._customTimeRange!==undefined?this.timeFilter.calculateBounds(this._customTimeRange):this.timeFilter.getBounds()}processOverallResults(scoresByTime,searchBounds,interval){const overallLabel=_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["g"];const dataset={laneLabels:[overallLabel],points:[],interval:interval,earliest:searchBounds.min.valueOf()/1e3,latest:searchBounds.max.valueOf()/1e3};Object.entries(scoresByTime).forEach(([timeMs,score])=>{const time=+timeMs/1e3;dataset.points.push({laneLabel:overallLabel,time:time,value:score});dataset.earliest=Math.min(time,dataset.earliest);dataset.latest=Math.max(time+dataset.interval,dataset.latest)});return dataset}processViewByResults(scoresByInfluencerAndTime,cardinality,sortedLaneValues,bounds,viewBySwimlaneFieldName,interval){const dataset={fieldName:viewBySwimlaneFieldName,points:[],laneLabels:[],interval:interval,earliest:bounds.earliest,latest:bounds.latest,cardinality:cardinality};const maxScoreByLaneLabel={};Object.entries(scoresByInfluencerAndTime).forEach(([influencerFieldValue,influencerData])=>{dataset.laneLabels.push(influencerFieldValue);maxScoreByLaneLabel[influencerFieldValue]=0;Object.entries(influencerData).forEach(([timeMs,anomalyScore])=>{const time=+timeMs/1e3;dataset.points.push({laneLabel:influencerFieldValue,time:time,value:anomalyScore});maxScoreByLaneLabel[influencerFieldValue]=Math.max(maxScoreByLaneLabel[influencerFieldValue],anomalyScore)})});const sortValuesLength=sortedLaneValues.length;if(sortValuesLength===0){dataset.laneLabels=dataset.laneLabels.sort((a,b)=>maxScoreByLaneLabel[b]-maxScoreByLaneLabel[a])}else{dataset.laneLabels=dataset.laneLabels.sort((a,b)=>{let aIndex=sortedLaneValues.indexOf(a);let bIndex=sortedLaneValues.indexOf(b);aIndex=aIndex>-1?aIndex:sortValuesLength;bIndex=bIndex>-1?bIndex:sortValuesLength;return aIndex-bIndex})}return dataset}}},66:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return parseInterval}));var moment__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(28);var moment__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_0__);var _elastic_datemath__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(113);var _elastic_datemath__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_datemath__WEBPACK_IMPORTED_MODULE_1__);const INTERVAL_STRING_RE=new RegExp("^([0-9]*)\\s*("+_elastic_datemath__WEBPACK_IMPORTED_MODULE_1___default.a.units.join("|")+")$");const SUPPORT_ZERO_DURATION_UNITS=["ms","s","m","h"];const SUPPORT_ES_DURATION_UNITS=["ms","s","m","h","d"];function parseInterval(interval,checkValidEsUnit=false){const matches=String(interval).trim().match(INTERVAL_STRING_RE);if(!Array.isArray(matches)||matches.length<3){return null}try{const value=parseInt(matches[1],10);const unit=matches[2];if(isNaN(value)||value<1&&SUPPORT_ZERO_DURATION_UNITS.indexOf(unit)===-1||checkValidEsUnit===true&&SUPPORT_ES_DURATION_UNITS.indexOf(unit)===-1){return null}return Object(moment__WEBPACK_IMPORTED_MODULE_0__["duration"])(value,unit)}catch(e){return null}}},83:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return getTimeBucketsFromCache}));__webpack_require__.d(__webpack_exports__,"a",(function(){return TimeBuckets}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getBoundsRoundedToInterval}));var external_kbnSharedDeps_Lodash_=__webpack_require__(7);var external_kbnSharedDeps_Moment_=__webpack_require__(28);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);var elastic_datemath=__webpack_require__(113);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);const d=external_kbnSharedDeps_Moment_default.a.duration;function timeBucketsCalcAutoIntervalProvider(){const roundingRules=[[d(500,"ms"),d(100,"ms")],[d(5,"second"),d(1,"second")],[d(10,"second"),d(5,"second")],[d(15,"second"),d(10,"second")],[d(30,"second"),d(15,"second")],[d(1,"minute"),d(30,"second")],[d(5,"minute"),d(1,"minute")],[d(10,"minute"),d(5,"minute")],[d(15,"minute"),d(10,"minute")],[d(30,"minute"),d(10,"minute")],[d(1,"hour"),d(30,"minute")],[d(2,"hour"),d(1,"hour")],[d(4,"hour"),d(2,"hour")],[d(6,"hour"),d(4,"hour")],[d(8,"hour"),d(6,"hour")],[d(12,"hour"),d(8,"hour")],[d(24,"hour"),d(12,"hour")],[d(2,"d"),d(1,"d")],[d(4,"d"),d(2,"d")],[d(1,"week"),d(4,"d")],[d(1,"month"),d(1,"week")],[d(1,"year"),d(1,"month")],[Infinity,d(1,"year")]];const revRoundingRules=roundingRules.slice(0).reverse();function find(rules,check,last){function pick(buckets,duration){const target=duration/buckets;let lastResp;for(let i=0;i<rules.length;i++){const rule=rules[i];const resp=check(rule[0],rule[1],target);if(resp==null){if(!last){continue}if(lastResp){return lastResp}break}if(!last){return resp}lastResp=resp}const ms=Math.max(Math.floor(target),1);return external_kbnSharedDeps_Moment_default.a.duration(ms,"ms")}return function(buckets,duration){const interval=pick(buckets,duration);if(interval){return external_kbnSharedDeps_Moment_default.a.duration(interval._data)}}}return{near:find(revRoundingRules,(function near(upperBound,lowerBound,target){if(upperBound>target){if(upperBound===Infinity){return lowerBound}const boundMs=upperBound.asMilliseconds();const intervalMs=lowerBound.asMilliseconds();const retInterval=Math.abs(boundMs-target)<=Math.abs(intervalMs)?upperBound:lowerBound;return retInterval}}),true),lessThan:find(revRoundingRules,(function(upperBound,lowerBound,target){if(lowerBound<target){return upperBound!==Infinity?upperBound:lowerBound}})),atLeast:find(revRoundingRules,(function atLeast(upperBound,lowerBound,target){if(lowerBound<=target){return lowerBound}}))}}var parse_interval=__webpack_require__(66);var dependency_cache=__webpack_require__(16);var public_=__webpack_require__(30);const unitsDesc=elastic_datemath_default.a.unitsDesc;const timeUnitsMaxSupportedIndex=unitsDesc.indexOf("w");const calcAuto=timeBucketsCalcAutoIntervalProvider();function getTimeBucketsFromCache(){const uiSettings=Object(dependency_cache["m"])();return new TimeBuckets({[public_["UI_SETTINGS"].HISTOGRAM_MAX_BARS]:uiSettings.get(public_["UI_SETTINGS"].HISTOGRAM_MAX_BARS),[public_["UI_SETTINGS"].HISTOGRAM_BAR_TARGET]:uiSettings.get(public_["UI_SETTINGS"].HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")})}function TimeBuckets(timeBucketsConfig){this._timeBucketsConfig=timeBucketsConfig;this.barTarget=this._timeBucketsConfig[public_["UI_SETTINGS"].HISTOGRAM_BAR_TARGET];this.maxBars=this._timeBucketsConfig[public_["UI_SETTINGS"].HISTOGRAM_MAX_BARS]}TimeBuckets.prototype.setBarTarget=function(bt){this.barTarget=bt};TimeBuckets.prototype.setMaxBars=function(mb){this.maxBars=mb};TimeBuckets.prototype.setBounds=function(input){if(!input)return this.clearBounds();let bounds;if(Object(external_kbnSharedDeps_Lodash_["isPlainObject"])(input)){bounds=[input.min,input.max]}else{bounds=Array.isArray(input)?input:[]}const moments=Object(external_kbnSharedDeps_Lodash_["sortBy"])(bounds.map(Object(external_kbnSharedDeps_Lodash_["ary"])(external_kbnSharedDeps_Moment_default.a,1)),Number);const valid=moments.length===2&&moments.every(isValidMoment);if(!valid){this.clearBounds();throw new Error("invalid bounds set: "+input)}this._lb=moments.shift();this._ub=moments.pop();if(this.getDuration().asSeconds()<0){throw new TypeError("Intervals must be positive")}};TimeBuckets.prototype.clearBounds=function(){this._lb=this._ub=null};TimeBuckets.prototype.hasBounds=function(){return isValidMoment(this._ub)&&isValidMoment(this._lb)};TimeBuckets.prototype.getBounds=function(){if(!this.hasBounds())return;return{min:this._lb,max:this._ub}};TimeBuckets.prototype.getDuration=function(){if(!this.hasBounds())return;return external_kbnSharedDeps_Moment_default.a.duration(this._ub-this._lb,"ms")};TimeBuckets.prototype.setInterval=function(input){this.originalInterval=input;let interval=input;if(!interval||interval==="auto"){this._i="auto";return}if(Object(external_kbnSharedDeps_Lodash_["isString"])(interval)){input=interval;interval=Object(parse_interval["a"])(interval);if(+interval===0){interval=null}}if(!external_kbnSharedDeps_Moment_default.a.isDuration(interval)){throw new TypeError('"'+input+'" is not a valid interval.')}this._i=interval};TimeBuckets.prototype.getInterval=function(){const self=this;const duration=self.getDuration();return decorateInterval(maybeScaleInterval(readInterval()),duration);function readInterval(){const interval=self._i;if(external_kbnSharedDeps_Moment_default.a.isDuration(interval))return interval;return calcAuto.near(self.barTarget,duration)}function maybeScaleInterval(interval){if(!self.hasBounds())return interval;const maxLength=self.maxBars;const approxLen=duration/interval;let scaled;if(approxLen>maxLength){scaled=calcAuto.lessThan(maxLength,duration)}else{return interval}if(+scaled===+interval)return interval;decorateInterval(interval,duration);return Object(external_kbnSharedDeps_Lodash_["assign"])(scaled,{preScaled:interval,scale:interval/scaled,scaled:true})}};TimeBuckets.prototype.getIntervalToNearestMultiple=function(divisorSecs){const interval=this.getInterval();const intervalSecs=interval.asSeconds();const remainder=intervalSecs%divisorSecs;if(remainder===0){return interval}let nearestMultiple=remainder>divisorSecs/2?intervalSecs+divisorSecs-remainder:intervalSecs-remainder;nearestMultiple=nearestMultiple===0?divisorSecs:nearestMultiple;const nearestMultipleInt=external_kbnSharedDeps_Moment_default.a.duration(nearestMultiple,"seconds");decorateInterval(nearestMultipleInt,this.getDuration());const preScaled=interval.preScaled;if(preScaled!==undefined&&preScaled<nearestMultipleInt){nearestMultipleInt.preScaled=preScaled;nearestMultipleInt.scale=preScaled/nearestMultipleInt;nearestMultipleInt.scaled=true}return nearestMultipleInt};TimeBuckets.prototype.getScaledDateFormat=function(){const interval=this.getInterval();const rules=this._timeBucketsConfig["dateFormat:scaled"];for(let i=rules.length-1;i>=0;i--){const rule=rules[i];if(!rule[0]||interval>=external_kbnSharedDeps_Moment_default.a.duration(rule[0])){return rule[1]}}return this._timeBucketsConfig.dateFormat};TimeBuckets.prototype.getScaledDateFormatter=function(){const fieldFormats=Object(dependency_cache["e"])();const DateFieldFormat=fieldFormats.getType(public_["FIELD_FORMAT_IDS"].DATE);return new DateFieldFormat({pattern:this.getScaledDateFormat()},this._timeBucketsConfig)};function decorateInterval(interval,originalDuration){const esInterval=calcEsInterval(interval);interval.esValue=esInterval.value;interval.esUnit=esInterval.unit;interval.expression=esInterval.expression;interval.overflow=originalDuration>interval?external_kbnSharedDeps_Moment_default.a.duration(interval-originalDuration):false;const prettyUnits=external_kbnSharedDeps_Moment_default.a.normalizeUnits(esInterval.unit);if(esInterval.value===1){interval.description=prettyUnits}else{interval.description="".concat(esInterval.value," ").concat(prettyUnits,"s")}return interval}function isValidMoment(m){return m&&"isValid"in m&&m.isValid()}function getBoundsRoundedToInterval(bounds,interval,inclusiveEnd=false){const intervalMs=interval.asMilliseconds();const adjustedMinMs=Math.floor(bounds.min.valueOf()/intervalMs)*intervalMs;let adjustedMaxMs=Math.ceil(bounds.max.valueOf()/intervalMs)*intervalMs;if(inclusiveEnd===false){adjustedMaxMs=adjustedMaxMs-1}return{min:external_kbnSharedDeps_Moment_default()(adjustedMinMs),max:external_kbnSharedDeps_Moment_default()(adjustedMaxMs)}}function calcEsInterval(duration){for(let i=0;i<unitsDesc.length;i++){const unit=unitsDesc[i];const val=duration.as(unit);if(val>=1&&Math.floor(val)===val){if(i<=timeUnitsMaxSupportedIndex){continue}return{value:val,unit:unit,expression:val+unit}}}const ms=duration.as("ms");return{value:ms,unit:"ms",expression:ms+"ms"}}}}]);